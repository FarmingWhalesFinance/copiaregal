{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rober\\\\Documents\\\\swaps-client\\\\src\\\\components\\\\Exchange\\\\PositionEditor.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport useSWR from \"swr\";\nimport { ethers } from \"ethers\";\nimport { BsArrowRight } from \"react-icons/bs\";\nimport { USD_DECIMALS, BASIS_POINTS_DIVISOR, DEPOSIT_FEE, DUST_BNB, helperToast, formatAmount, bigNumberify, usePrevious, formatAmountFree, fetcher, parseValue, expandDecimals, shouldRaiseGasError, getTokenInfo, getLiquidationPrice, approveTokens, getUserTokenBalances } from \"../../Helpers\";\nimport { getAnalyticsEventStage } from \"../../utils/analytics\";\nimport { getContract } from \"../../Addresses\";\nimport Tab from \"../Tab/Tab\";\nimport Modal from \"../Modal/Modal\";\nimport { callContract } from \"../../Api\";\nimport PositionRouter from \"../../abis/PositionRouter.json\";\nimport Token from \"../../abis/Token.json\";\nimport { convertStringToFloat } from \"../../utils/common\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DEPOSIT = \"Deposit\";\nconst WITHDRAW = \"Withdraw\";\nconst EDIT_OPTIONS = [DEPOSIT, WITHDRAW];\nconst {\n  AddressZero\n} = ethers.constants;\nexport default function PositionEditor(props) {\n  _s();\n\n  const {\n    pendingPositions,\n    setPendingPositions,\n    positionsMap,\n    positionKey,\n    isVisible,\n    setIsVisible,\n    infoTokens,\n    active,\n    account,\n    library,\n    collateralTokenAddress,\n    pendingTxns,\n    setPendingTxns,\n    getUsd,\n    getLeverage,\n    savedIsPnlInLeverage,\n    positionRouterApproved,\n    isWaitingForPositionRouterApproval,\n    isPositionRouterApproving,\n    approvePositionRouter,\n    chainId,\n    trackAction\n  } = props;\n  const nativeTokenAddress = getContract(chainId, \"NATIVE_TOKEN\");\n  const position = positionsMap && positionKey ? positionsMap[positionKey] : undefined;\n  const [option, setOption] = useState(DEPOSIT);\n  const [fromValue, setFromValue] = useState(\"\");\n  const [isApproving, setIsApproving] = useState(false);\n  const [isSwapping, setIsSwapping] = useState(false);\n  const prevIsVisible = usePrevious(isVisible);\n  const routerAddress = getContract(chainId, \"Router\");\n  const positionRouterAddress = getContract(chainId, \"PositionRouter\");\n  const {\n    data: tokenAllowance\n  } = useSWR([active, chainId, collateralTokenAddress, \"allowance\", account, routerAddress], {\n    fetcher: fetcher(library, Token)\n  });\n  const {\n    data: minExecutionFee\n  } = useSWR([active, chainId, positionRouterAddress, \"minExecutionFee\"], {\n    fetcher: fetcher(library, PositionRouter)\n  });\n  const isDeposit = option === DEPOSIT;\n  const isWithdrawal = option === WITHDRAW;\n  const needPositionRouterApproval = !positionRouterApproved;\n  let collateralToken;\n  let maxAmount;\n  let maxAmountFormatted;\n  let maxAmountFormattedFree;\n  let fromAmount;\n  let needApproval;\n  let convertedAmount;\n  let convertedAmountFormatted;\n  let nextLeverage;\n  let nextLeverageExcludingPnl;\n  let liquidationPrice;\n  let nextLiquidationPrice;\n  let nextCollateral;\n  let title;\n  let collateralDelta;\n\n  if (position) {\n    title = `Edit ${position.isLong ? \"Long\" : \"Short\"} ${position.indexToken.symbol}`;\n    collateralToken = position.collateralToken;\n    liquidationPrice = getLiquidationPrice(position);\n\n    if (isDeposit) {\n      fromAmount = parseValue(fromValue, collateralToken.decimals);\n      maxAmount = collateralToken ? collateralToken.balance : bigNumberify(0);\n      maxAmountFormatted = formatAmount(maxAmount, collateralToken.decimals, 4, true);\n      maxAmountFormattedFree = formatAmountFree(maxAmount, collateralToken.decimals, 8);\n\n      if (fromAmount) {\n        convertedAmount = getUsd(fromAmount, position.collateralToken.address, false, infoTokens);\n        convertedAmountFormatted = formatAmount(convertedAmount, USD_DECIMALS, 2);\n      }\n    } else {\n      fromAmount = parseValue(fromValue, USD_DECIMALS);\n      maxAmount = position.collateral;\n      maxAmountFormatted = formatAmount(maxAmount, USD_DECIMALS, 2, true);\n      maxAmountFormattedFree = formatAmountFree(maxAmount, USD_DECIMALS, 2);\n\n      if (fromAmount) {\n        convertedAmount = fromAmount.mul(expandDecimals(1, collateralToken.decimals)).div(collateralToken.maxPrice);\n        convertedAmountFormatted = formatAmount(convertedAmount, collateralToken.decimals, 4, true);\n      }\n    }\n\n    needApproval = isDeposit && tokenAllowance && fromAmount && fromAmount.gt(tokenAllowance);\n\n    if (fromAmount) {\n      collateralDelta = isDeposit ? convertedAmount : fromAmount;\n\n      if (position.isLong) {\n        collateralDelta = collateralDelta.mul(BASIS_POINTS_DIVISOR - DEPOSIT_FEE).div(BASIS_POINTS_DIVISOR);\n      }\n\n      nextLeverage = getLeverage({\n        size: position.size,\n        collateral: position.collateral,\n        collateralDelta,\n        increaseCollateral: isDeposit,\n        entryFundingRate: position.entryFundingRate,\n        cumulativeFundingRate: position.cumulativeFundingRate,\n        hasProfit: position.hasProfit,\n        delta: position.delta,\n        includeDelta: savedIsPnlInLeverage\n      });\n      nextLeverageExcludingPnl = getLeverage({\n        size: position.size,\n        collateral: position.collateral,\n        collateralDelta,\n        increaseCollateral: isDeposit,\n        entryFundingRate: position.entryFundingRate,\n        cumulativeFundingRate: position.cumulativeFundingRate,\n        hasProfit: position.hasProfit,\n        delta: position.delta,\n        includeDelta: false\n      });\n      nextLiquidationPrice = getLiquidationPrice({\n        isLong: position.isLong,\n        size: position.size,\n        collateral: position.collateral,\n        averagePrice: position.averagePrice,\n        entryFundingRate: position.entryFundingRate,\n        cumulativeFundingRate: position.cumulativeFundingRate,\n        collateralDelta,\n        increaseCollateral: isDeposit\n      });\n      nextCollateral = isDeposit ? position.collateral.add(collateralDelta) : position.collateral.sub(collateralDelta);\n    }\n  }\n\n  const getError = () => {\n    if (!fromAmount) {\n      return \"Enter an amount\";\n    }\n\n    if (nextLeverage && nextLeverage.eq(0)) {\n      return \"Enter an amount\";\n    }\n\n    if (!isDeposit && fromAmount) {\n      if (fromAmount.gte(position.collateral)) {\n        return \"Min order: 10 USD\";\n      }\n\n      if (position.collateral.sub(fromAmount).lt(expandDecimals(10, USD_DECIMALS))) {\n        return \"Min order: 10 USD\";\n      }\n    }\n\n    if (!isDeposit && fromAmount && nextLiquidationPrice) {\n      if (position.isLong && position.markPrice.lt(nextLiquidationPrice)) {\n        return \"Invalid liq. price\";\n      }\n\n      if (!position.isLong && position.markPrice.gt(nextLiquidationPrice)) {\n        return \"Invalid liq. price\";\n      }\n    }\n\n    if (nextLeverageExcludingPnl && nextLeverageExcludingPnl.lt(1.1 * BASIS_POINTS_DIVISOR)) {\n      return \"Min leverage: 1.1x\";\n    }\n\n    if (nextLeverageExcludingPnl && nextLeverageExcludingPnl.gt(30.5 * BASIS_POINTS_DIVISOR)) {\n      return \"Max leverage: 30x\";\n    }\n  };\n\n  const isPrimaryEnabled = () => {\n    const error = getError();\n\n    if (error) {\n      return false;\n    }\n\n    if (isSwapping) {\n      return false;\n    }\n\n    if (needPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      return false;\n    }\n\n    if (isPositionRouterApproving) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const getPrimaryText = () => {\n    const error = getError();\n\n    if (error) {\n      return error;\n    }\n\n    if (isSwapping) {\n      if (isDeposit) {\n        return \"Depositing...\";\n      }\n\n      return \"Withdrawing...\";\n    }\n\n    if (isApproving) {\n      return `Approving ${position.collateralToken.symbol}...`;\n    }\n\n    if (needApproval) {\n      return `Approve ${position.collateralToken.symbol}`;\n    }\n\n    if (needPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      return \"Enabling Leverage\";\n    }\n\n    if (isPositionRouterApproving) {\n      return \"Enabling Leverage...\";\n    }\n\n    if (needPositionRouterApproval) {\n      return \"Enable Leverage\";\n    }\n\n    if (isDeposit) {\n      return \"Deposit\";\n    }\n\n    return \"Withdraw\";\n  };\n\n  const resetForm = () => {\n    setFromValue(\"\");\n  };\n\n  useEffect(() => {\n    if (prevIsVisible !== isVisible) {\n      resetForm();\n    }\n  }, [prevIsVisible, isVisible]);\n\n  const depositCollateral = async () => {\n    setIsSwapping(true);\n    const tokenAddress0 = collateralTokenAddress === AddressZero ? nativeTokenAddress : collateralTokenAddress;\n    const path = [tokenAddress0];\n    const indexTokenAddress = position.indexToken.address === AddressZero ? nativeTokenAddress : position.indexToken.address;\n    const priceBasisPoints = position.isLong ? 11000 : 9000;\n    const priceLimit = position.indexToken.maxPrice.mul(priceBasisPoints).div(10000);\n    const referralCode = ethers.constants.HashZero;\n    let params = [path, // _path\n    indexTokenAddress, // _indexToken\n    fromAmount, // _amountIn\n    0, // _minOut\n    0, // _sizeDelta\n    position.isLong, // _isLong\n    priceLimit, // _acceptablePrice\n    minExecutionFee, // _executionFee\n    referralCode // _referralCode\n    ];\n    let method = \"createIncreasePosition\";\n    let value = minExecutionFee;\n\n    if (collateralTokenAddress === AddressZero) {\n      method = \"createIncreasePositionETH\";\n      value = fromAmount.add(minExecutionFee);\n      params = [path, // _path\n      indexTokenAddress, // _indexToken\n      0, // _minOut\n      0, // _sizeDelta\n      position.isLong, // _isLong\n      priceLimit, // _acceptablePrice\n      minExecutionFee, // _executionFee\n      referralCode // _referralCode\n      ];\n    }\n\n    if (shouldRaiseGasError(getTokenInfo(infoTokens, collateralTokenAddress), fromAmount)) {\n      setIsSwapping(false);\n      helperToast.error(`Leave at least ${formatAmount(DUST_BNB, 18, 3)} ETH for gas`);\n      return;\n    }\n\n    const contract = new ethers.Contract(positionRouterAddress, PositionRouter.abi, library.getSigner());\n    callContract(chainId, contract, method, params, {\n      value,\n      sentMsg: \"Deposit submitted.\",\n      successMsg: `Requested deposit of ${formatAmount(fromAmount, position.collateralToken.decimals, 4)} ${position.collateralToken.symbol} into ${position.indexToken.symbol} ${position.isLong ? \"Long\" : \"Short\"}.`,\n      failMsg: \"Deposit failed.\",\n      setPendingTxns\n    }).then(async res => {\n      setFromValue(\"\");\n      setIsVisible(false);\n      pendingPositions[position.key] = {\n        updatedAt: Date.now(),\n        pendingChanges: {\n          collateralSnapshot: position.collateral,\n          expectingCollateralChange: true\n        }\n      };\n      setPendingPositions({ ...pendingPositions\n      });\n    }).finally(() => {\n      setIsSwapping(false);\n      trackEditPosition(3);\n    });\n  };\n\n  const withdrawCollateral = async () => {\n    setIsSwapping(true);\n    const tokenAddress0 = collateralTokenAddress === AddressZero ? nativeTokenAddress : collateralTokenAddress;\n    const indexTokenAddress = position.indexToken.address === AddressZero ? nativeTokenAddress : position.indexToken.address;\n    const priceBasisPoints = position.isLong ? 9000 : 11000;\n    const priceLimit = position.indexToken.maxPrice.mul(priceBasisPoints).div(10000);\n    const withdrawETH = collateralTokenAddress === AddressZero || collateralTokenAddress === nativeTokenAddress;\n    const params = [[tokenAddress0], // _path\n    indexTokenAddress, // _indexToken\n    fromAmount, // _collateralDelta\n    0, // _sizeDelta\n    position.isLong, // _isLong\n    account, // _receiver\n    priceLimit, // _acceptablePrice\n    0, // _minOut\n    minExecutionFee, // _executionFee\n    withdrawETH // _withdrawETH\n    ];\n    const method = \"createDecreasePosition\";\n    const contract = new ethers.Contract(positionRouterAddress, PositionRouter.abi, library.getSigner());\n    callContract(chainId, contract, method, params, {\n      value: minExecutionFee,\n      sentMsg: \"Withdrawal submitted.\",\n      successMsg: `Requested withdrawal of ${formatAmount(fromAmount, USD_DECIMALS, 2)} USD from ${position.indexToken.symbol} ${position.isLong ? \"Long\" : \"Short\"}.`,\n      failMsg: \"Withdrawal failed.\",\n      setPendingTxns\n    }).then(async res => {\n      setFromValue(\"\");\n      setIsVisible(false);\n      pendingPositions[position.key] = {\n        updatedAt: Date.now(),\n        pendingChanges: {\n          collateralSnapshot: position.collateral,\n          expectingCollateralChange: true\n        }\n      };\n    }).finally(() => {\n      setIsSwapping(false);\n      trackEditPosition(3);\n    });\n  };\n\n  const onClickPrimary = () => {\n    if (needApproval) {\n      approveTokens({\n        setIsApproving,\n        library,\n        tokenAddress: collateralTokenAddress,\n        spender: routerAddress,\n        chainId: chainId,\n        infoTokens,\n        getTokenInfo,\n        pendingTxns,\n        setPendingTxns\n      });\n      return;\n    }\n\n    if (needPositionRouterApproval) {\n      approvePositionRouter({\n        sentMsg: isDeposit ? \"Enable deposit sent.\" : \"Enable withdraw sent.\",\n        failMsg: isDeposit ? \"Enable deposit failed.\" : \"Enable withdraw failed.\"\n      });\n      return;\n    }\n\n    if (isDeposit) {\n      depositCollateral();\n      return;\n    }\n\n    withdrawCollateral();\n  };\n\n  const trackEditPosition = stage => {\n    const eventName = getAnalyticsEventStage(stage);\n\n    try {\n      const size = convertStringToFloat(formatAmount(position.size, USD_DECIMALS, 2, true));\n      const collateral = convertStringToFloat(formatAmount(position.collateral, USD_DECIMALS, 2, true));\n      const nextCollateralValue = nextCollateral ? convertStringToFloat(formatAmount(nextCollateral, USD_DECIMALS, 2, true)) : 0;\n      const leverage = convertStringToFloat(formatAmount(position.leverage, 4, 2, true));\n      const nextLeverageValue = nextLeverage ? convertStringToFloat(formatAmount(nextLeverage, 4, 2, true)) : 0;\n      const markPrice = convertStringToFloat(formatAmount(position.markPrice, USD_DECIMALS, 2, true));\n      const liqPrice = convertStringToFloat(formatAmount(liquidationPrice, USD_DECIMALS, 2, true));\n      const nextLiqPriceValue = nextLiquidationPrice ? convertStringToFloat(formatAmount(nextLiquidationPrice, USD_DECIMALS, 2, true)) : 0;\n      const amountToPay = convertedAmountFormatted;\n      const tokenToPay = isDeposit ? \"USD\" : position.collateralToken.symbol;\n      const [userBalances, tokenPrices, poolBalances] = getUserTokenBalances(infoTokens);\n      const traits = {\n        actionType: \"Edit\",\n        positionType: position.isLong ? \"Long\" : \"Short\",\n        transactionType: isDeposit ? \"Buy\" : \"Sell\",\n        size: size,\n        collateral: collateral,\n        nextCollateral: nextCollateralValue,\n        leverage: leverage,\n        nextLeverage: nextLeverageValue,\n        markPrice: markPrice,\n        liqPrice: liqPrice,\n        nextLiqPrice: nextLiqPriceValue,\n        amountToPay: amountToPay,\n        tokenToPay: tokenToPay,\n        ...userBalances,\n        ...tokenPrices,\n        ...poolBalances\n      };\n      trackAction && trackAction(eventName, traits);\n    } catch (err) {\n      console.error(`Unable to track ${eventName} event`, err);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"PositionEditor\",\n    children: position && /*#__PURE__*/_jsxDEV(Modal, {\n      isVisible: isVisible,\n      setIsVisible: setIsVisible,\n      label: title,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(Tab, {\n          options: EDIT_OPTIONS,\n          option: option,\n          setOption: setOption,\n          onChange: resetForm\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 489,\n          columnNumber: 13\n        }, this), (isDeposit || isWithdrawal) && /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-swap-section-top\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"muted\",\n                children: [convertedAmountFormatted && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"Exchange-swap-usd\",\n                  children: [isDeposit ? \"Deposit\" : \"Withdraw\", \": \", convertedAmountFormatted, \" \", isDeposit ? \"USD\" : position.collateralToken.symbol]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 496,\n                  columnNumber: 25\n                }, this), !convertedAmountFormatted && `${isDeposit ? \"Deposit\" : \"Withdraw\"}`]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 494,\n                columnNumber: 21\n              }, this), maxAmount && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"muted align-right clickable\",\n                onClick: () => setFromValue(maxAmountFormattedFree),\n                children: [\"Max: \", maxAmountFormatted]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 504,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 493,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-swap-section-bottom\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-swap-input-container\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  min: \"0\",\n                  placeholder: \"0.0\",\n                  className: \"Exchange-swap-input\",\n                  value: fromValue,\n                  onChange: e => setFromValue(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 511,\n                  columnNumber: 23\n                }, this), fromValue !== maxAmountFormattedFree && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"Exchange-swap-max\",\n                  onClick: () => {\n                    setFromValue(maxAmountFormattedFree);\n                  },\n                  children: \"MAX\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 520,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 510,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"PositionEditor-token-symbol\",\n                children: isDeposit ? position.collateralToken.symbol : \"USD\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 530,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 509,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 492,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"PositionEditor-info-box\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-info-label\",\n                children: \"Size\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 537,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"align-right\",\n                children: [formatAmount(position.size, USD_DECIMALS, 2, true), \" USD\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 538,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 536,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-info-label\",\n                children: \"Collateral\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 541,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"align-right\",\n                children: [!nextCollateral && /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [\"$\", formatAmount(position.collateral, USD_DECIMALS, 2, true)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 543,\n                  columnNumber: 43\n                }, this), nextCollateral && /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"inline-block muted\",\n                    children: [\"$\", formatAmount(position.collateral, USD_DECIMALS, 2, true), /*#__PURE__*/_jsxDEV(BsArrowRight, {\n                      className: \"transition-arrow\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 548,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 546,\n                    columnNumber: 27\n                  }, this), \"$\", formatAmount(nextCollateral, USD_DECIMALS, 2, true)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 545,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 542,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 540,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-info-label\",\n                children: \"Leverage\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 556,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"align-right\",\n                children: [!nextLeverage && /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [formatAmount(position.leverage, 4, 2, true), \"x\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 558,\n                  columnNumber: 41\n                }, this), nextLeverage && /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"inline-block muted\",\n                    children: [formatAmount(position.leverage, 4, 2, true), \"x\", /*#__PURE__*/_jsxDEV(BsArrowRight, {\n                      className: \"transition-arrow\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 563,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 561,\n                    columnNumber: 27\n                  }, this), formatAmount(nextLeverage, 4, 2, true), \"x\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 560,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 557,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 555,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-info-label\",\n                children: \"Mark Price\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 571,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"align-right\",\n                children: [\"$\", formatAmount(position.markPrice, USD_DECIMALS, 2, true)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 572,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 570,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-info-label\",\n                children: \"Liq. Price\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 575,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"align-right\",\n                children: [!nextLiquidationPrice && /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [!fromAmount && `$${formatAmount(liquidationPrice, USD_DECIMALS, 2, true)}`, fromAmount && \"-\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 578,\n                  columnNumber: 25\n                }, this), nextLiquidationPrice && /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"inline-block muted\",\n                    children: [\"$\", formatAmount(liquidationPrice, USD_DECIMALS, 2, true), /*#__PURE__*/_jsxDEV(BsArrowRight, {\n                      className: \"transition-arrow\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 587,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 585,\n                    columnNumber: 27\n                  }, this), \"$\", formatAmount(nextLiquidationPrice, USD_DECIMALS, 2, true)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 584,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 576,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 574,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 535,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-button-container\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"App-cta Exchange-swap-button\",\n              onClick: () => {\n                const stage = getPrimaryText() === \"Approve\" ? 1 : 2;\n                trackEditPosition(stage);\n                onClickPrimary();\n              },\n              disabled: !isPrimaryEnabled(),\n              children: getPrimaryText()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 597,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 596,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 491,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 487,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 485,\n    columnNumber: 5\n  }, this);\n}\n\n_s(PositionEditor, \"Mk6z7emfWKiDF1PKpIAh2VGBFBA=\", false, function () {\n  return [usePrevious, useSWR, useSWR];\n});\n\n_c = PositionEditor;\n\nvar _c;\n\n$RefreshReg$(_c, \"PositionEditor\");","map":{"version":3,"names":["React","useEffect","useState","useSWR","ethers","BsArrowRight","USD_DECIMALS","BASIS_POINTS_DIVISOR","DEPOSIT_FEE","DUST_BNB","helperToast","formatAmount","bigNumberify","usePrevious","formatAmountFree","fetcher","parseValue","expandDecimals","shouldRaiseGasError","getTokenInfo","getLiquidationPrice","approveTokens","getUserTokenBalances","getAnalyticsEventStage","getContract","Tab","Modal","callContract","PositionRouter","Token","convertStringToFloat","DEPOSIT","WITHDRAW","EDIT_OPTIONS","AddressZero","constants","PositionEditor","props","pendingPositions","setPendingPositions","positionsMap","positionKey","isVisible","setIsVisible","infoTokens","active","account","library","collateralTokenAddress","pendingTxns","setPendingTxns","getUsd","getLeverage","savedIsPnlInLeverage","positionRouterApproved","isWaitingForPositionRouterApproval","isPositionRouterApproving","approvePositionRouter","chainId","trackAction","nativeTokenAddress","position","undefined","option","setOption","fromValue","setFromValue","isApproving","setIsApproving","isSwapping","setIsSwapping","prevIsVisible","routerAddress","positionRouterAddress","data","tokenAllowance","minExecutionFee","isDeposit","isWithdrawal","needPositionRouterApproval","collateralToken","maxAmount","maxAmountFormatted","maxAmountFormattedFree","fromAmount","needApproval","convertedAmount","convertedAmountFormatted","nextLeverage","nextLeverageExcludingPnl","liquidationPrice","nextLiquidationPrice","nextCollateral","title","collateralDelta","isLong","indexToken","symbol","decimals","balance","address","collateral","mul","div","maxPrice","gt","size","increaseCollateral","entryFundingRate","cumulativeFundingRate","hasProfit","delta","includeDelta","averagePrice","add","sub","getError","eq","gte","lt","markPrice","isPrimaryEnabled","error","getPrimaryText","resetForm","depositCollateral","tokenAddress0","path","indexTokenAddress","priceBasisPoints","priceLimit","referralCode","HashZero","params","method","value","contract","Contract","abi","getSigner","sentMsg","successMsg","failMsg","then","res","key","updatedAt","Date","now","pendingChanges","collateralSnapshot","expectingCollateralChange","finally","trackEditPosition","withdrawCollateral","withdrawETH","onClickPrimary","tokenAddress","spender","stage","eventName","nextCollateralValue","leverage","nextLeverageValue","liqPrice","nextLiqPriceValue","amountToPay","tokenToPay","userBalances","tokenPrices","poolBalances","traits","actionType","positionType","transactionType","nextLiqPrice","err","console","e","target"],"sources":["C:/Users/rober/Documents/swaps-client/src/components/Exchange/PositionEditor.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport useSWR from \"swr\";\nimport { ethers } from \"ethers\";\nimport { BsArrowRight } from \"react-icons/bs\";\n\nimport {\n  USD_DECIMALS,\n  BASIS_POINTS_DIVISOR,\n  DEPOSIT_FEE,\n  DUST_BNB,\n  helperToast,\n  formatAmount,\n  bigNumberify,\n  usePrevious,\n  formatAmountFree,\n  fetcher,\n  parseValue,\n  expandDecimals,\n  shouldRaiseGasError,\n  getTokenInfo,\n  getLiquidationPrice,\n  approveTokens,\n  getUserTokenBalances,\n} from \"../../Helpers\";\nimport { getAnalyticsEventStage } from \"../../utils/analytics\";\nimport { getContract } from \"../../Addresses\";\nimport Tab from \"../Tab/Tab\";\nimport Modal from \"../Modal/Modal\";\nimport { callContract } from \"../../Api\";\n\nimport PositionRouter from \"../../abis/PositionRouter.json\";\nimport Token from \"../../abis/Token.json\";\nimport { convertStringToFloat } from \"../../utils/common\";\n\nconst DEPOSIT = \"Deposit\";\nconst WITHDRAW = \"Withdraw\";\nconst EDIT_OPTIONS = [DEPOSIT, WITHDRAW];\nconst { AddressZero } = ethers.constants;\n\nexport default function PositionEditor(props) {\n  const {\n    pendingPositions,\n    setPendingPositions,\n    positionsMap,\n    positionKey,\n    isVisible,\n    setIsVisible,\n    infoTokens,\n    active,\n    account,\n    library,\n    collateralTokenAddress,\n    pendingTxns,\n    setPendingTxns,\n    getUsd,\n    getLeverage,\n    savedIsPnlInLeverage,\n    positionRouterApproved,\n    isWaitingForPositionRouterApproval,\n    isPositionRouterApproving,\n    approvePositionRouter,\n    chainId,\n    trackAction,\n  } = props;\n  const nativeTokenAddress = getContract(chainId, \"NATIVE_TOKEN\");\n  const position = positionsMap && positionKey ? positionsMap[positionKey] : undefined;\n  const [option, setOption] = useState(DEPOSIT);\n  const [fromValue, setFromValue] = useState(\"\");\n  const [isApproving, setIsApproving] = useState(false);\n  const [isSwapping, setIsSwapping] = useState(false);\n  const prevIsVisible = usePrevious(isVisible);\n\n  const routerAddress = getContract(chainId, \"Router\");\n  const positionRouterAddress = getContract(chainId, \"PositionRouter\");\n\n  const { data: tokenAllowance } = useSWR(\n    [active, chainId, collateralTokenAddress, \"allowance\", account, routerAddress],\n    {\n      fetcher: fetcher(library, Token),\n    }\n  );\n\n  const { data: minExecutionFee } = useSWR([active, chainId, positionRouterAddress, \"minExecutionFee\"], {\n    fetcher: fetcher(library, PositionRouter),\n  });\n\n  const isDeposit = option === DEPOSIT;\n  const isWithdrawal = option === WITHDRAW;\n\n  const needPositionRouterApproval = !positionRouterApproved;\n\n  let collateralToken;\n  let maxAmount;\n  let maxAmountFormatted;\n  let maxAmountFormattedFree;\n  let fromAmount;\n  let needApproval;\n\n  let convertedAmount;\n  let convertedAmountFormatted;\n\n  let nextLeverage;\n  let nextLeverageExcludingPnl;\n  let liquidationPrice;\n  let nextLiquidationPrice;\n  let nextCollateral;\n\n  let title;\n  let collateralDelta;\n  if (position) {\n    title = `Edit ${position.isLong ? \"Long\" : \"Short\"} ${position.indexToken.symbol}`;\n    collateralToken = position.collateralToken;\n    liquidationPrice = getLiquidationPrice(position);\n\n    if (isDeposit) {\n      fromAmount = parseValue(fromValue, collateralToken.decimals);\n      maxAmount = collateralToken ? collateralToken.balance : bigNumberify(0);\n      maxAmountFormatted = formatAmount(maxAmount, collateralToken.decimals, 4, true);\n      maxAmountFormattedFree = formatAmountFree(maxAmount, collateralToken.decimals, 8);\n      if (fromAmount) {\n        convertedAmount = getUsd(fromAmount, position.collateralToken.address, false, infoTokens);\n        convertedAmountFormatted = formatAmount(convertedAmount, USD_DECIMALS, 2);\n      }\n    } else {\n      fromAmount = parseValue(fromValue, USD_DECIMALS);\n      maxAmount = position.collateral;\n      maxAmountFormatted = formatAmount(maxAmount, USD_DECIMALS, 2, true);\n      maxAmountFormattedFree = formatAmountFree(maxAmount, USD_DECIMALS, 2);\n      if (fromAmount) {\n        convertedAmount = fromAmount.mul(expandDecimals(1, collateralToken.decimals)).div(collateralToken.maxPrice);\n        convertedAmountFormatted = formatAmount(convertedAmount, collateralToken.decimals, 4, true);\n      }\n    }\n    needApproval = isDeposit && tokenAllowance && fromAmount && fromAmount.gt(tokenAllowance);\n\n    if (fromAmount) {\n      collateralDelta = isDeposit ? convertedAmount : fromAmount;\n      if (position.isLong) {\n        collateralDelta = collateralDelta.mul(BASIS_POINTS_DIVISOR - DEPOSIT_FEE).div(BASIS_POINTS_DIVISOR);\n      }\n      nextLeverage = getLeverage({\n        size: position.size,\n        collateral: position.collateral,\n        collateralDelta,\n        increaseCollateral: isDeposit,\n        entryFundingRate: position.entryFundingRate,\n        cumulativeFundingRate: position.cumulativeFundingRate,\n        hasProfit: position.hasProfit,\n        delta: position.delta,\n        includeDelta: savedIsPnlInLeverage,\n      });\n      nextLeverageExcludingPnl = getLeverage({\n        size: position.size,\n        collateral: position.collateral,\n        collateralDelta,\n        increaseCollateral: isDeposit,\n        entryFundingRate: position.entryFundingRate,\n        cumulativeFundingRate: position.cumulativeFundingRate,\n        hasProfit: position.hasProfit,\n        delta: position.delta,\n        includeDelta: false,\n      });\n\n      nextLiquidationPrice = getLiquidationPrice({\n        isLong: position.isLong,\n        size: position.size,\n        collateral: position.collateral,\n        averagePrice: position.averagePrice,\n        entryFundingRate: position.entryFundingRate,\n        cumulativeFundingRate: position.cumulativeFundingRate,\n        collateralDelta,\n        increaseCollateral: isDeposit,\n      });\n\n      nextCollateral = isDeposit ? position.collateral.add(collateralDelta) : position.collateral.sub(collateralDelta);\n    }\n  }\n\n  const getError = () => {\n    if (!fromAmount) {\n      return \"Enter an amount\";\n    }\n    if (nextLeverage && nextLeverage.eq(0)) {\n      return \"Enter an amount\";\n    }\n\n    if (!isDeposit && fromAmount) {\n      if (fromAmount.gte(position.collateral)) {\n        return \"Min order: 10 USD\";\n      }\n      if (position.collateral.sub(fromAmount).lt(expandDecimals(10, USD_DECIMALS))) {\n        return \"Min order: 10 USD\";\n      }\n    }\n\n    if (!isDeposit && fromAmount && nextLiquidationPrice) {\n      if (position.isLong && position.markPrice.lt(nextLiquidationPrice)) {\n        return \"Invalid liq. price\";\n      }\n      if (!position.isLong && position.markPrice.gt(nextLiquidationPrice)) {\n        return \"Invalid liq. price\";\n      }\n    }\n\n    if (nextLeverageExcludingPnl && nextLeverageExcludingPnl.lt(1.1 * BASIS_POINTS_DIVISOR)) {\n      return \"Min leverage: 1.1x\";\n    }\n\n    if (nextLeverageExcludingPnl && nextLeverageExcludingPnl.gt(30.5 * BASIS_POINTS_DIVISOR)) {\n      return \"Max leverage: 30x\";\n    }\n  };\n\n  const isPrimaryEnabled = () => {\n    const error = getError();\n    if (error) {\n      return false;\n    }\n    if (isSwapping) {\n      return false;\n    }\n    if (needPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      return false;\n    }\n    if (isPositionRouterApproving) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const getPrimaryText = () => {\n    const error = getError();\n    if (error) {\n      return error;\n    }\n    if (isSwapping) {\n      if (isDeposit) {\n        return \"Depositing...\";\n      }\n      return \"Withdrawing...\";\n    }\n\n    if (isApproving) {\n      return `Approving ${position.collateralToken.symbol}...`;\n    }\n    if (needApproval) {\n      return `Approve ${position.collateralToken.symbol}`;\n    }\n\n    if (needPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      return \"Enabling Leverage\";\n    }\n\n    if (isPositionRouterApproving) {\n      return \"Enabling Leverage...\";\n    }\n\n    if (needPositionRouterApproval) {\n      return \"Enable Leverage\";\n    }\n\n    if (isDeposit) {\n      return \"Deposit\";\n    }\n\n    return \"Withdraw\";\n  };\n\n  const resetForm = () => {\n    setFromValue(\"\");\n  };\n\n  useEffect(() => {\n    if (prevIsVisible !== isVisible) {\n      resetForm();\n    }\n  }, [prevIsVisible, isVisible]);\n\n  const depositCollateral = async () => {\n    setIsSwapping(true);\n    const tokenAddress0 = collateralTokenAddress === AddressZero ? nativeTokenAddress : collateralTokenAddress;\n    const path = [tokenAddress0];\n    const indexTokenAddress =\n      position.indexToken.address === AddressZero ? nativeTokenAddress : position.indexToken.address;\n\n    const priceBasisPoints = position.isLong ? 11000 : 9000;\n    const priceLimit = position.indexToken.maxPrice.mul(priceBasisPoints).div(10000);\n\n    const referralCode = ethers.constants.HashZero;\n    let params = [\n      path, // _path\n      indexTokenAddress, // _indexToken\n      fromAmount, // _amountIn\n      0, // _minOut\n      0, // _sizeDelta\n      position.isLong, // _isLong\n      priceLimit, // _acceptablePrice\n      minExecutionFee, // _executionFee\n      referralCode, // _referralCode\n    ];\n\n    let method = \"createIncreasePosition\";\n    let value = minExecutionFee;\n    if (collateralTokenAddress === AddressZero) {\n      method = \"createIncreasePositionETH\";\n      value = fromAmount.add(minExecutionFee);\n      params = [\n        path, // _path\n        indexTokenAddress, // _indexToken\n        0, // _minOut\n        0, // _sizeDelta\n        position.isLong, // _isLong\n        priceLimit, // _acceptablePrice\n        minExecutionFee, // _executionFee\n        referralCode, // _referralCode\n      ];\n    }\n\n    if (shouldRaiseGasError(getTokenInfo(infoTokens, collateralTokenAddress), fromAmount)) {\n      setIsSwapping(false);\n      helperToast.error(`Leave at least ${formatAmount(DUST_BNB, 18, 3)} ETH for gas`);\n      return;\n    }\n\n    const contract = new ethers.Contract(positionRouterAddress, PositionRouter.abi, library.getSigner());\n    callContract(chainId, contract, method, params, {\n      value,\n      sentMsg: \"Deposit submitted.\",\n      successMsg: `Requested deposit of ${formatAmount(fromAmount, position.collateralToken.decimals, 4)} ${\n        position.collateralToken.symbol\n      } into ${position.indexToken.symbol} ${position.isLong ? \"Long\" : \"Short\"}.`,\n      failMsg: \"Deposit failed.\",\n      setPendingTxns,\n    })\n      .then(async (res) => {\n        setFromValue(\"\");\n        setIsVisible(false);\n\n        pendingPositions[position.key] = {\n          updatedAt: Date.now(),\n          pendingChanges: {\n            collateralSnapshot: position.collateral,\n            expectingCollateralChange: true,\n          },\n        };\n\n        setPendingPositions({ ...pendingPositions });\n      })\n      .finally(() => {\n        setIsSwapping(false);\n        trackEditPosition(3);\n      });\n  };\n\n  const withdrawCollateral = async () => {\n    setIsSwapping(true);\n    const tokenAddress0 = collateralTokenAddress === AddressZero ? nativeTokenAddress : collateralTokenAddress;\n    const indexTokenAddress =\n      position.indexToken.address === AddressZero ? nativeTokenAddress : position.indexToken.address;\n    const priceBasisPoints = position.isLong ? 9000 : 11000;\n    const priceLimit = position.indexToken.maxPrice.mul(priceBasisPoints).div(10000);\n\n    const withdrawETH = collateralTokenAddress === AddressZero || collateralTokenAddress === nativeTokenAddress;\n    const params = [\n      [tokenAddress0], // _path\n      indexTokenAddress, // _indexToken\n      fromAmount, // _collateralDelta\n      0, // _sizeDelta\n      position.isLong, // _isLong\n      account, // _receiver\n      priceLimit, // _acceptablePrice\n      0, // _minOut\n      minExecutionFee, // _executionFee\n      withdrawETH, // _withdrawETH\n    ];\n\n    const method = \"createDecreasePosition\";\n\n    const contract = new ethers.Contract(positionRouterAddress, PositionRouter.abi, library.getSigner());\n    callContract(chainId, contract, method, params, {\n      value: minExecutionFee,\n      sentMsg: \"Withdrawal submitted.\",\n      successMsg: `Requested withdrawal of ${formatAmount(fromAmount, USD_DECIMALS, 2)} USD from ${\n        position.indexToken.symbol\n      } ${position.isLong ? \"Long\" : \"Short\"}.`,\n      failMsg: \"Withdrawal failed.\",\n      setPendingTxns,\n    })\n      .then(async (res) => {\n        setFromValue(\"\");\n        setIsVisible(false);\n\n        pendingPositions[position.key] = {\n          updatedAt: Date.now(),\n          pendingChanges: {\n            collateralSnapshot: position.collateral,\n            expectingCollateralChange: true,\n          },\n        };\n      })\n      .finally(() => {\n        setIsSwapping(false);\n        trackEditPosition(3);\n      });\n  };\n\n  const onClickPrimary = () => {\n    if (needApproval) {\n      approveTokens({\n        setIsApproving,\n        library,\n        tokenAddress: collateralTokenAddress,\n        spender: routerAddress,\n        chainId: chainId,\n        infoTokens,\n        getTokenInfo,\n        pendingTxns,\n        setPendingTxns,\n      });\n      return;\n    }\n\n    if (needPositionRouterApproval) {\n      approvePositionRouter({\n        sentMsg: isDeposit ? \"Enable deposit sent.\" : \"Enable withdraw sent.\",\n        failMsg: isDeposit ? \"Enable deposit failed.\" : \"Enable withdraw failed.\",\n      });\n      return;\n    }\n\n    if (isDeposit) {\n      depositCollateral();\n      return;\n    }\n\n    withdrawCollateral();\n  };\n\n  const trackEditPosition = (stage) => {\n    const eventName = getAnalyticsEventStage(stage);\n    try {\n      const size = convertStringToFloat(formatAmount(position.size, USD_DECIMALS, 2, true));\n      const collateral = convertStringToFloat(formatAmount(position.collateral, USD_DECIMALS, 2, true));\n      const nextCollateralValue = nextCollateral\n        ? convertStringToFloat(formatAmount(nextCollateral, USD_DECIMALS, 2, true))\n        : 0;\n      const leverage = convertStringToFloat(formatAmount(position.leverage, 4, 2, true));\n      const nextLeverageValue = nextLeverage ? convertStringToFloat(formatAmount(nextLeverage, 4, 2, true)) : 0;\n      const markPrice = convertStringToFloat(formatAmount(position.markPrice, USD_DECIMALS, 2, true));\n      const liqPrice = convertStringToFloat(formatAmount(liquidationPrice, USD_DECIMALS, 2, true));\n      const nextLiqPriceValue = nextLiquidationPrice\n        ? convertStringToFloat(formatAmount(nextLiquidationPrice, USD_DECIMALS, 2, true))\n        : 0;\n      const amountToPay = convertedAmountFormatted;\n      const tokenToPay = isDeposit ? \"USD\" : position.collateralToken.symbol;\n\n      const [userBalances, tokenPrices, poolBalances] = getUserTokenBalances(infoTokens);\n\n      const traits = {\n        actionType: \"Edit\",\n        positionType: position.isLong ? \"Long\" : \"Short\",\n        transactionType: isDeposit ? \"Buy\" : \"Sell\",\n        size: size,\n        collateral: collateral,\n        nextCollateral: nextCollateralValue,\n        leverage: leverage,\n        nextLeverage: nextLeverageValue,\n        markPrice: markPrice,\n        liqPrice: liqPrice,\n        nextLiqPrice: nextLiqPriceValue,\n        amountToPay: amountToPay,\n        tokenToPay: tokenToPay,\n        ...userBalances,\n        ...tokenPrices,\n        ...poolBalances,\n      };\n      trackAction && trackAction(eventName, traits);\n    } catch (err) {\n      console.error(`Unable to track ${eventName} event`, err);\n    }\n  };\n\n  return (\n    <div className=\"PositionEditor\">\n      {position && (\n        <Modal isVisible={isVisible} setIsVisible={setIsVisible} label={title}>\n          <div>\n            <Tab options={EDIT_OPTIONS} option={option} setOption={setOption} onChange={resetForm} />\n            {(isDeposit || isWithdrawal) && (\n              <div>\n                <div className=\"Exchange-swap-section\">\n                  <div className=\"Exchange-swap-section-top\">\n                    <div className=\"muted\">\n                      {convertedAmountFormatted && (\n                        <div className=\"Exchange-swap-usd\">\n                          {isDeposit ? \"Deposit\" : \"Withdraw\"}: {convertedAmountFormatted}{\" \"}\n                          {isDeposit ? \"USD\" : position.collateralToken.symbol}\n                        </div>\n                      )}\n                      {!convertedAmountFormatted && `${isDeposit ? \"Deposit\" : \"Withdraw\"}`}\n                    </div>\n                    {maxAmount && (\n                      <div className=\"muted align-right clickable\" onClick={() => setFromValue(maxAmountFormattedFree)}>\n                        Max: {maxAmountFormatted}\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"Exchange-swap-section-bottom\">\n                    <div className=\"Exchange-swap-input-container\">\n                      <input\n                        type=\"number\"\n                        min=\"0\"\n                        placeholder=\"0.0\"\n                        className=\"Exchange-swap-input\"\n                        value={fromValue}\n                        onChange={(e) => setFromValue(e.target.value)}\n                      />\n                      {fromValue !== maxAmountFormattedFree && (\n                        <div\n                          className=\"Exchange-swap-max\"\n                          onClick={() => {\n                            setFromValue(maxAmountFormattedFree);\n                          }}\n                        >\n                          MAX\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"PositionEditor-token-symbol\">\n                      {isDeposit ? position.collateralToken.symbol : \"USD\"}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"PositionEditor-info-box\">\n                  <div className=\"Exchange-info-row\">\n                    <div className=\"Exchange-info-label\">Size</div>\n                    <div className=\"align-right\">{formatAmount(position.size, USD_DECIMALS, 2, true)} USD</div>\n                  </div>\n                  <div className=\"Exchange-info-row\">\n                    <div className=\"Exchange-info-label\">Collateral</div>\n                    <div className=\"align-right\">\n                      {!nextCollateral && <div>${formatAmount(position.collateral, USD_DECIMALS, 2, true)}</div>}\n                      {nextCollateral && (\n                        <div>\n                          <div className=\"inline-block muted\">\n                            ${formatAmount(position.collateral, USD_DECIMALS, 2, true)}\n                            <BsArrowRight className=\"transition-arrow\" />\n                          </div>\n                          ${formatAmount(nextCollateral, USD_DECIMALS, 2, true)}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"Exchange-info-row\">\n                    <div className=\"Exchange-info-label\">Leverage</div>\n                    <div className=\"align-right\">\n                      {!nextLeverage && <div>{formatAmount(position.leverage, 4, 2, true)}x</div>}\n                      {nextLeverage && (\n                        <div>\n                          <div className=\"inline-block muted\">\n                            {formatAmount(position.leverage, 4, 2, true)}x\n                            <BsArrowRight className=\"transition-arrow\" />\n                          </div>\n                          {formatAmount(nextLeverage, 4, 2, true)}x\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"Exchange-info-row\">\n                    <div className=\"Exchange-info-label\">Mark Price</div>\n                    <div className=\"align-right\">${formatAmount(position.markPrice, USD_DECIMALS, 2, true)}</div>\n                  </div>\n                  <div className=\"Exchange-info-row\">\n                    <div className=\"Exchange-info-label\">Liq. Price</div>\n                    <div className=\"align-right\">\n                      {!nextLiquidationPrice && (\n                        <div>\n                          {!fromAmount && `$${formatAmount(liquidationPrice, USD_DECIMALS, 2, true)}`}\n                          {fromAmount && \"-\"}\n                        </div>\n                      )}\n                      {nextLiquidationPrice && (\n                        <div>\n                          <div className=\"inline-block muted\">\n                            ${formatAmount(liquidationPrice, USD_DECIMALS, 2, true)}\n                            <BsArrowRight className=\"transition-arrow\" />\n                          </div>\n                          ${formatAmount(nextLiquidationPrice, USD_DECIMALS, 2, true)}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"Exchange-swap-button-container\">\n                  <button\n                    className=\"App-cta Exchange-swap-button\"\n                    onClick={() => {\n                      const stage = getPrimaryText() === \"Approve\" ? 1 : 2;\n                      trackEditPosition(stage);\n                      onClickPrimary();\n                    }}\n                    disabled={!isPrimaryEnabled()}\n                  >\n                    {getPrimaryText()}\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}