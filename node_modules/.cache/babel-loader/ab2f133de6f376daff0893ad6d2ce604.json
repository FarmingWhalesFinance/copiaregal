{"ast":null,"code":"import { __assign, __awaiter, __extends, __generator, __spreadArray } from \"tslib\";\nimport { resolveAliasArguments, resolveArguments, resolvePageArguments, resolveUserArguments } from '../arguments-resolver';\nimport { invokeCallback } from '../callback';\nimport { isOffline } from '../connection';\nimport { Context } from '../context';\nimport { Emitter } from '@segment/analytics-core';\nimport { EventFactory } from '../events';\nimport { EventQueue } from '../queue/event-queue';\nimport { Group, User } from '../user';\nimport autoBind from '../../lib/bind-all';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { version } from '../../generated/version';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { getGlobal } from '../../lib/get-global';\nimport { inspectorHost } from '../inspector';\nvar deprecationWarning = 'This is being deprecated and will be not be available in future releases of Analytics JS'; // reference any pre-existing \"analytics\" object so a user can restore the reference\n\nvar global = getGlobal();\n\nvar _analytics = global === null || global === void 0 ? void 0 : global.analytics;\n\nfunction createDefaultQueue(retryQueue, disablePersistance) {\n  if (retryQueue === void 0) {\n    retryQueue = false;\n  }\n\n  if (disablePersistance === void 0) {\n    disablePersistance = false;\n  }\n\n  var maxAttempts = retryQueue ? 4 : 1;\n  var priorityQueue = disablePersistance ? new PriorityQueue(maxAttempts, []) : new PersistedPriorityQueue(maxAttempts, 'event-queue');\n  return new EventQueue(priorityQueue);\n}\n/* analytics-classic stubs */\n\n\nfunction _stub() {\n  console.warn(deprecationWarning);\n}\n\nvar Analytics =\n/** @class */\nfunction (_super) {\n  __extends(Analytics, _super);\n\n  function Analytics(settings, options, queue, user, group) {\n    var _this = this;\n\n    var _a, _b, _c;\n\n    _this = _super.call(this) || this;\n    _this._debug = false;\n    _this.initialized = false;\n\n    _this.user = function () {\n      return _this._user;\n    };\n\n    _this.init = _this.initialize.bind(_this);\n    _this.log = _stub;\n    _this.addIntegrationMiddleware = _stub;\n    _this.listeners = _stub;\n    _this.addEventListener = _stub;\n    _this.removeAllListeners = _stub;\n    _this.removeListener = _stub;\n    _this.removeEventListener = _stub;\n    _this.hasListeners = _stub;\n    _this.add = _stub;\n    _this.addIntegration = _stub;\n    var cookieOptions = options === null || options === void 0 ? void 0 : options.cookie;\n    var disablePersistance = (_a = options === null || options === void 0 ? void 0 : options.disableClientPersistence) !== null && _a !== void 0 ? _a : false;\n    _this.settings = settings;\n    _this.settings.timeout = (_b = _this.settings.timeout) !== null && _b !== void 0 ? _b : 300;\n    _this.queue = queue !== null && queue !== void 0 ? queue : createDefaultQueue(options === null || options === void 0 ? void 0 : options.retryQueue, disablePersistance);\n    _this._user = user !== null && user !== void 0 ? user : new User(disablePersistance ? __assign(__assign({}, options === null || options === void 0 ? void 0 : options.user), {\n      persist: false\n    }) : options === null || options === void 0 ? void 0 : options.user, cookieOptions).load();\n    _this._group = group !== null && group !== void 0 ? group : new Group(disablePersistance ? __assign(__assign({}, options === null || options === void 0 ? void 0 : options.group), {\n      persist: false\n    }) : options === null || options === void 0 ? void 0 : options.group, cookieOptions).load();\n    _this.eventFactory = new EventFactory(_this._user);\n    _this.integrations = (_c = options === null || options === void 0 ? void 0 : options.integrations) !== null && _c !== void 0 ? _c : {};\n    _this.options = options !== null && options !== void 0 ? options : {};\n    autoBind(_this);\n    return _this;\n  }\n\n  Analytics.prototype.track = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, name, data, opts, cb, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolveArguments.apply(void 0, args), name = _a[0], data = _a[1], opts = _a[2], cb = _a[3];\n        segmentEvent = this.eventFactory.track(name, data, opts, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, cb).then(function (ctx) {\n          _this.emit('track', name, ctx.event.properties, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.page = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, category, page, properties, options, callback, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolvePageArguments.apply(void 0, args), category = _a[0], page = _a[1], properties = _a[2], options = _a[3], callback = _a[4];\n        segmentEvent = this.eventFactory.page(category, page, properties, options, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('page', category, page, ctx.event.properties, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.identify = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, id, _traits, options, callback, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolveUserArguments(this._user).apply(void 0, args), id = _a[0], _traits = _a[1], options = _a[2], callback = _a[3];\n\n        this._user.identify(id, _traits);\n\n        segmentEvent = this.eventFactory.identify(this._user.id(), this._user.traits(), options, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('identify', ctx.event.userId, ctx.event.traits, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.group = function () {\n    var _this = this;\n\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (args.length === 0) {\n      return this._group;\n    }\n\n    var _a = resolveUserArguments(this._group).apply(void 0, args),\n        id = _a[0],\n        _traits = _a[1],\n        options = _a[2],\n        callback = _a[3];\n\n    this._group.identify(id, _traits);\n\n    var groupId = this._group.id();\n\n    var groupTraits = this._group.traits();\n\n    var segmentEvent = this.eventFactory.group(groupId, groupTraits, options, this.integrations);\n    return this.dispatch(segmentEvent, callback).then(function (ctx) {\n      _this.emit('group', ctx.event.groupId, ctx.event.traits, ctx.event.options);\n\n      return ctx;\n    });\n  };\n\n  Analytics.prototype.alias = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, to, from, options, callback, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolveAliasArguments.apply(void 0, args), to = _a[0], from = _a[1], options = _a[2], callback = _a[3];\n        segmentEvent = this.eventFactory.alias(to, from, options, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('alias', to, from, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.screen = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, category, page, properties, options, callback, segmentEvent;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        _a = resolvePageArguments.apply(void 0, args), category = _a[0], page = _a[1], properties = _a[2], options = _a[3], callback = _a[4];\n        segmentEvent = this.eventFactory.screen(category, page, properties, options, this.integrations);\n        return [2\n        /*return*/\n        , this.dispatch(segmentEvent, callback).then(function (ctx) {\n          _this.emit('screen', category, page, ctx.event.properties, ctx.event.options);\n\n          return ctx;\n        })];\n      });\n    });\n  };\n\n  Analytics.prototype.trackClick = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"auto-track\" */\n            '../auto-track')];\n\n          case 1:\n            autotrack = _b.sent();\n            return [2\n            /*return*/\n            , (_a = autotrack.link).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.trackLink = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"auto-track\" */\n            '../auto-track')];\n\n          case 1:\n            autotrack = _b.sent();\n            return [2\n            /*return*/\n            , (_a = autotrack.link).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.trackSubmit = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"auto-track\" */\n            '../auto-track')];\n\n          case 1:\n            autotrack = _b.sent();\n            return [2\n            /*return*/\n            , (_a = autotrack.form).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.trackForm = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var autotrack;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"auto-track\" */\n            '../auto-track')];\n\n          case 1:\n            autotrack = _b.sent();\n            return [2\n            /*return*/\n            , (_a = autotrack.form).call.apply(_a, __spreadArray([this], args, false))];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.register = function () {\n    var plugins = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      plugins[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx, registrations;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            ctx = Context.system();\n            registrations = plugins.map(function (xt) {\n              return _this.queue.register(ctx, xt, _this);\n            });\n            return [4\n            /*yield*/\n            , Promise.all(registrations)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , ctx];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.deregister = function () {\n    var plugins = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      plugins[_i] = arguments[_i];\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx, deregistrations;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            ctx = Context.system();\n            deregistrations = plugins.map(function (pl) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var plugin;\n                return __generator(this, function (_a) {\n                  plugin = this.queue.plugins.find(function (p) {\n                    return p.name === pl;\n                  });\n\n                  if (plugin) {\n                    return [2\n                    /*return*/\n                    , this.queue.deregister(ctx, plugin, this)];\n                  } else {\n                    ctx.log('warn', \"plugin \".concat(pl, \" not found\"));\n                  }\n\n                  return [2\n                  /*return*/\n                  ];\n                });\n              });\n            });\n            return [4\n            /*yield*/\n            , Promise.all(deregistrations)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , ctx];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.debug = function (toggle) {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug');\n    }\n\n    this._debug = toggle;\n    return this;\n  };\n\n  Analytics.prototype.reset = function () {\n    this._user.reset();\n  };\n\n  Analytics.prototype.timeout = function (timeout) {\n    this.settings.timeout = timeout;\n  };\n\n  Analytics.prototype.dispatch = function (event, callback) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var ctx, startTime, dispatched, elapsedTime, timeoutInMs;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            ctx = new Context(event);\n            (_a = inspectorHost.triggered) === null || _a === void 0 ? void 0 : _a.call(inspectorHost, ctx);\n\n            if (isOffline() && !this.options.retryQueue) {\n              return [2\n              /*return*/\n              , ctx];\n            }\n\n            startTime = Date.now();\n            if (!this.queue.isEmpty()) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.queue.dispatchSingle(ctx)];\n\n          case 1:\n            dispatched = _b.sent();\n            return [3\n            /*break*/\n            , 4];\n\n          case 2:\n            return [4\n            /*yield*/\n            , this.queue.dispatch(ctx)];\n\n          case 3:\n            dispatched = _b.sent();\n            _b.label = 4;\n\n          case 4:\n            elapsedTime = Date.now() - startTime;\n            timeoutInMs = this.settings.timeout;\n            if (!callback) return [3\n            /*break*/\n            , 6];\n            return [4\n            /*yield*/\n            , invokeCallback(dispatched, callback, Math.max((timeoutInMs !== null && timeoutInMs !== void 0 ? timeoutInMs : 300) - elapsedTime, 0), timeoutInMs)];\n\n          case 5:\n            dispatched = _b.sent();\n            _b.label = 6;\n\n          case 6:\n            if (this._debug) {\n              dispatched.flush();\n            }\n\n            return [2\n            /*return*/\n            , dispatched];\n        }\n      });\n    });\n  };\n\n  Analytics.prototype.addSourceMiddleware = function (fn) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.queue.criticalTasks.run(function () {\n              return __awaiter(_this, void 0, void 0, function () {\n                var sourceMiddlewarePlugin, integrations, plugin;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4\n                      /*yield*/\n                      , import(\n                      /* webpackChunkName: \"middleware\" */\n                      '../../plugins/middleware')];\n\n                    case 1:\n                      sourceMiddlewarePlugin = _a.sent().sourceMiddlewarePlugin;\n                      integrations = {};\n                      this.queue.plugins.forEach(function (plugin) {\n                        if (plugin.type === 'destination') {\n                          return integrations[plugin.name] = true;\n                        }\n                      });\n                      plugin = sourceMiddlewarePlugin(fn, integrations);\n                      return [4\n                      /*yield*/\n                      , this.register(plugin)];\n\n                    case 2:\n                      _a.sent();\n\n                      return [2\n                      /*return*/\n                      ];\n                  }\n                });\n              });\n            })];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , this];\n        }\n      });\n    });\n  };\n  /* TODO: This does not have to return a promise? */\n\n\n  Analytics.prototype.addDestinationMiddleware = function (integrationName) {\n    var middlewares = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      middlewares[_i - 1] = arguments[_i];\n    }\n\n    var legacyDestinations = this.queue.plugins.filter(function (xt) {\n      // xt instanceof LegacyDestination &&\n      return xt.name.toLowerCase() === integrationName.toLowerCase();\n    });\n    legacyDestinations.forEach(function (destination) {\n      destination.addMiddleware.apply(destination, middlewares);\n    });\n    return Promise.resolve(this);\n  };\n\n  Analytics.prototype.setAnonymousId = function (id) {\n    return this._user.anonymousId(id);\n  };\n\n  Analytics.prototype.queryString = function (query) {\n    return __awaiter(this, void 0, void 0, function () {\n      var queryString;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , import(\n            /* webpackChunkName: \"queryString\" */\n            '../query-string')];\n\n          case 1:\n            queryString = _a.sent().queryString;\n            return [2\n            /*return*/\n            , queryString(this, query)];\n        }\n      });\n    });\n  };\n  /**\n   * @deprecated This function does not register a destination plugin.\n   *\n   * Instantiates a legacy Analytics.js destination.\n   *\n   * This function does not register the destination as an Analytics.JS plugin,\n   * all the it does it to invoke the factory function back.\n   */\n\n\n  Analytics.prototype.use = function (legacyPluginFactory) {\n    legacyPluginFactory(this);\n    return this;\n  };\n\n  Analytics.prototype.ready = function (callback) {\n    if (callback === void 0) {\n      callback = function (res) {\n        return res;\n      };\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , Promise.all(this.queue.plugins.map(function (i) {\n          return i.ready ? i.ready() : Promise.resolve();\n        })).then(function (res) {\n          callback(res);\n          return res;\n        })];\n      });\n    });\n  }; // analytics-classic api\n\n\n  Analytics.prototype.noConflict = function () {\n    console.warn(deprecationWarning);\n    window.analytics = _analytics !== null && _analytics !== void 0 ? _analytics : this;\n    return this;\n  };\n\n  Analytics.prototype.normalize = function (msg) {\n    console.warn(deprecationWarning);\n    return this.eventFactory.normalize(msg);\n  };\n\n  Object.defineProperty(Analytics.prototype, \"failedInitializations\", {\n    get: function () {\n      console.warn(deprecationWarning);\n      return this.queue.failedInitializations;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Analytics.prototype, \"VERSION\", {\n    get: function () {\n      return version;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /* @deprecated - noop */\n\n  Analytics.prototype.initialize = function (_settings, _options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        console.warn(deprecationWarning);\n        return [2\n        /*return*/\n        , Promise.resolve(this)];\n      });\n    });\n  };\n\n  Analytics.prototype.pageview = function (url) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            console.warn(deprecationWarning);\n            return [4\n            /*yield*/\n            , this.page({\n              path: url\n            })];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , this];\n        }\n      });\n    });\n  };\n\n  Object.defineProperty(Analytics.prototype, \"plugins\", {\n    get: function () {\n      var _a;\n\n      console.warn(deprecationWarning); // @ts-expect-error\n\n      return (_a = this._plugins) !== null && _a !== void 0 ? _a : {};\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Analytics.prototype, \"Integrations\", {\n    get: function () {\n      console.warn(deprecationWarning);\n      var integrations = this.queue.plugins.filter(function (plugin) {\n        return plugin.type === 'destination';\n      }).reduce(function (acc, plugin) {\n        var name = \"\".concat(plugin.name.toLowerCase().replace('.', '').split(' ').join('-'), \"Integration\"); // @ts-expect-error\n\n        var integration = window[name];\n\n        if (!integration) {\n          return acc;\n        }\n\n        var nested = integration.Integration; // hack - Google Analytics function resides in the \"Integration\" field\n\n        if (nested) {\n          acc[plugin.name] = nested;\n          return acc;\n        }\n\n        acc[plugin.name] = integration;\n        return acc;\n      }, {});\n      return integrations;\n    },\n    enumerable: false,\n    configurable: true\n  }); // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n  Analytics.prototype.push = function (args) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var an = this;\n    var method = args.shift();\n\n    if (method) {\n      if (!an[method]) return;\n    }\n\n    an[method].apply(this, args);\n  };\n\n  return Analytics;\n}(Emitter);\n\nexport { Analytics };","map":{"version":3,"sources":["../../../../src/core/analytics/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __awaiter, __extends, __generator, __spreadArray } from \"tslib\";\nimport { resolveAliasArguments, resolveArguments, resolvePageArguments, resolveUserArguments, } from '../arguments-resolver';\nimport { invokeCallback } from '../callback';\nimport { isOffline } from '../connection';\nimport { Context } from '../context';\nimport { Emitter } from '@segment/analytics-core';\nimport { EventFactory, } from '../events';\nimport { EventQueue } from '../queue/event-queue';\nimport { Group, User } from '../user';\nimport autoBind from '../../lib/bind-all';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { version } from '../../generated/version';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { getGlobal } from '../../lib/get-global';\nimport { inspectorHost } from '../inspector';\nvar deprecationWarning = 'This is being deprecated and will be not be available in future releases of Analytics JS';\n// reference any pre-existing \"analytics\" object so a user can restore the reference\nvar global = getGlobal();\nvar _analytics = global === null || global === void 0 ? void 0 : global.analytics;\nfunction createDefaultQueue(retryQueue, disablePersistance) {\n    if (retryQueue === void 0) { retryQueue = false; }\n    if (disablePersistance === void 0) { disablePersistance = false; }\n    var maxAttempts = retryQueue ? 4 : 1;\n    var priorityQueue = disablePersistance\n        ? new PriorityQueue(maxAttempts, [])\n        : new PersistedPriorityQueue(maxAttempts, 'event-queue');\n    return new EventQueue(priorityQueue);\n}\n/* analytics-classic stubs */\nfunction _stub() {\n    console.warn(deprecationWarning);\n}\nvar Analytics = /** @class */ (function (_super) {\n    __extends(Analytics, _super);\n    function Analytics(settings, options, queue, user, group) {\n        var _this = this;\n        var _a, _b, _c;\n        _this = _super.call(this) || this;\n        _this._debug = false;\n        _this.initialized = false;\n        _this.user = function () {\n            return _this._user;\n        };\n        _this.init = _this.initialize.bind(_this);\n        _this.log = _stub;\n        _this.addIntegrationMiddleware = _stub;\n        _this.listeners = _stub;\n        _this.addEventListener = _stub;\n        _this.removeAllListeners = _stub;\n        _this.removeListener = _stub;\n        _this.removeEventListener = _stub;\n        _this.hasListeners = _stub;\n        _this.add = _stub;\n        _this.addIntegration = _stub;\n        var cookieOptions = options === null || options === void 0 ? void 0 : options.cookie;\n        var disablePersistance = (_a = options === null || options === void 0 ? void 0 : options.disableClientPersistence) !== null && _a !== void 0 ? _a : false;\n        _this.settings = settings;\n        _this.settings.timeout = (_b = _this.settings.timeout) !== null && _b !== void 0 ? _b : 300;\n        _this.queue =\n            queue !== null && queue !== void 0 ? queue : createDefaultQueue(options === null || options === void 0 ? void 0 : options.retryQueue, disablePersistance);\n        _this._user =\n            user !== null && user !== void 0 ? user : new User(disablePersistance\n                ? __assign(__assign({}, options === null || options === void 0 ? void 0 : options.user), { persist: false }) : options === null || options === void 0 ? void 0 : options.user, cookieOptions).load();\n        _this._group =\n            group !== null && group !== void 0 ? group : new Group(disablePersistance\n                ? __assign(__assign({}, options === null || options === void 0 ? void 0 : options.group), { persist: false }) : options === null || options === void 0 ? void 0 : options.group, cookieOptions).load();\n        _this.eventFactory = new EventFactory(_this._user);\n        _this.integrations = (_c = options === null || options === void 0 ? void 0 : options.integrations) !== null && _c !== void 0 ? _c : {};\n        _this.options = options !== null && options !== void 0 ? options : {};\n        autoBind(_this);\n        return _this;\n    }\n    Analytics.prototype.track = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, name, data, opts, cb, segmentEvent;\n            var _this = this;\n            return __generator(this, function (_b) {\n                _a = resolveArguments.apply(void 0, args), name = _a[0], data = _a[1], opts = _a[2], cb = _a[3];\n                segmentEvent = this.eventFactory.track(name, data, opts, this.integrations);\n                return [2 /*return*/, this.dispatch(segmentEvent, cb).then(function (ctx) {\n                        _this.emit('track', name, ctx.event.properties, ctx.event.options);\n                        return ctx;\n                    })];\n            });\n        });\n    };\n    Analytics.prototype.page = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, category, page, properties, options, callback, segmentEvent;\n            var _this = this;\n            return __generator(this, function (_b) {\n                _a = resolvePageArguments.apply(void 0, args), category = _a[0], page = _a[1], properties = _a[2], options = _a[3], callback = _a[4];\n                segmentEvent = this.eventFactory.page(category, page, properties, options, this.integrations);\n                return [2 /*return*/, this.dispatch(segmentEvent, callback).then(function (ctx) {\n                        _this.emit('page', category, page, ctx.event.properties, ctx.event.options);\n                        return ctx;\n                    })];\n            });\n        });\n    };\n    Analytics.prototype.identify = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, id, _traits, options, callback, segmentEvent;\n            var _this = this;\n            return __generator(this, function (_b) {\n                _a = resolveUserArguments(this._user).apply(void 0, args), id = _a[0], _traits = _a[1], options = _a[2], callback = _a[3];\n                this._user.identify(id, _traits);\n                segmentEvent = this.eventFactory.identify(this._user.id(), this._user.traits(), options, this.integrations);\n                return [2 /*return*/, this.dispatch(segmentEvent, callback).then(function (ctx) {\n                        _this.emit('identify', ctx.event.userId, ctx.event.traits, ctx.event.options);\n                        return ctx;\n                    })];\n            });\n        });\n    };\n    Analytics.prototype.group = function () {\n        var _this = this;\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (args.length === 0) {\n            return this._group;\n        }\n        var _a = resolveUserArguments(this._group).apply(void 0, args), id = _a[0], _traits = _a[1], options = _a[2], callback = _a[3];\n        this._group.identify(id, _traits);\n        var groupId = this._group.id();\n        var groupTraits = this._group.traits();\n        var segmentEvent = this.eventFactory.group(groupId, groupTraits, options, this.integrations);\n        return this.dispatch(segmentEvent, callback).then(function (ctx) {\n            _this.emit('group', ctx.event.groupId, ctx.event.traits, ctx.event.options);\n            return ctx;\n        });\n    };\n    Analytics.prototype.alias = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, to, from, options, callback, segmentEvent;\n            var _this = this;\n            return __generator(this, function (_b) {\n                _a = resolveAliasArguments.apply(void 0, args), to = _a[0], from = _a[1], options = _a[2], callback = _a[3];\n                segmentEvent = this.eventFactory.alias(to, from, options, this.integrations);\n                return [2 /*return*/, this.dispatch(segmentEvent, callback).then(function (ctx) {\n                        _this.emit('alias', to, from, ctx.event.options);\n                        return ctx;\n                    })];\n            });\n        });\n    };\n    Analytics.prototype.screen = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, category, page, properties, options, callback, segmentEvent;\n            var _this = this;\n            return __generator(this, function (_b) {\n                _a = resolvePageArguments.apply(void 0, args), category = _a[0], page = _a[1], properties = _a[2], options = _a[3], callback = _a[4];\n                segmentEvent = this.eventFactory.screen(category, page, properties, options, this.integrations);\n                return [2 /*return*/, this.dispatch(segmentEvent, callback).then(function (ctx) {\n                        _this.emit('screen', category, page, ctx.event.properties, ctx.event.options);\n                        return ctx;\n                    })];\n            });\n        });\n    };\n    Analytics.prototype.trackClick = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var autotrack;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, import(\n                        /* webpackChunkName: \"auto-track\" */ '../auto-track')];\n                    case 1:\n                        autotrack = _b.sent();\n                        return [2 /*return*/, (_a = autotrack.link).call.apply(_a, __spreadArray([this], args, false))];\n                }\n            });\n        });\n    };\n    Analytics.prototype.trackLink = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var autotrack;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, import(\n                        /* webpackChunkName: \"auto-track\" */ '../auto-track')];\n                    case 1:\n                        autotrack = _b.sent();\n                        return [2 /*return*/, (_a = autotrack.link).call.apply(_a, __spreadArray([this], args, false))];\n                }\n            });\n        });\n    };\n    Analytics.prototype.trackSubmit = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var autotrack;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, import(\n                        /* webpackChunkName: \"auto-track\" */ '../auto-track')];\n                    case 1:\n                        autotrack = _b.sent();\n                        return [2 /*return*/, (_a = autotrack.form).call.apply(_a, __spreadArray([this], args, false))];\n                }\n            });\n        });\n    };\n    Analytics.prototype.trackForm = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var autotrack;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, import(\n                        /* webpackChunkName: \"auto-track\" */ '../auto-track')];\n                    case 1:\n                        autotrack = _b.sent();\n                        return [2 /*return*/, (_a = autotrack.form).call.apply(_a, __spreadArray([this], args, false))];\n                }\n            });\n        });\n    };\n    Analytics.prototype.register = function () {\n        var plugins = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            plugins[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var ctx, registrations;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        ctx = Context.system();\n                        registrations = plugins.map(function (xt) {\n                            return _this.queue.register(ctx, xt, _this);\n                        });\n                        return [4 /*yield*/, Promise.all(registrations)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, ctx];\n                }\n            });\n        });\n    };\n    Analytics.prototype.deregister = function () {\n        var plugins = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            plugins[_i] = arguments[_i];\n        }\n        return __awaiter(this, void 0, void 0, function () {\n            var ctx, deregistrations;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        ctx = Context.system();\n                        deregistrations = plugins.map(function (pl) { return __awaiter(_this, void 0, void 0, function () {\n                            var plugin;\n                            return __generator(this, function (_a) {\n                                plugin = this.queue.plugins.find(function (p) { return p.name === pl; });\n                                if (plugin) {\n                                    return [2 /*return*/, this.queue.deregister(ctx, plugin, this)];\n                                }\n                                else {\n                                    ctx.log('warn', \"plugin \".concat(pl, \" not found\"));\n                                }\n                                return [2 /*return*/];\n                            });\n                        }); });\n                        return [4 /*yield*/, Promise.all(deregistrations)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, ctx];\n                }\n            });\n        });\n    };\n    Analytics.prototype.debug = function (toggle) {\n        // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n        if (toggle === false && localStorage.getItem('debug')) {\n            localStorage.removeItem('debug');\n        }\n        this._debug = toggle;\n        return this;\n    };\n    Analytics.prototype.reset = function () {\n        this._user.reset();\n    };\n    Analytics.prototype.timeout = function (timeout) {\n        this.settings.timeout = timeout;\n    };\n    Analytics.prototype.dispatch = function (event, callback) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var ctx, startTime, dispatched, elapsedTime, timeoutInMs;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        ctx = new Context(event);\n                        (_a = inspectorHost.triggered) === null || _a === void 0 ? void 0 : _a.call(inspectorHost, ctx);\n                        if (isOffline() && !this.options.retryQueue) {\n                            return [2 /*return*/, ctx];\n                        }\n                        startTime = Date.now();\n                        if (!this.queue.isEmpty()) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.queue.dispatchSingle(ctx)];\n                    case 1:\n                        dispatched = _b.sent();\n                        return [3 /*break*/, 4];\n                    case 2: return [4 /*yield*/, this.queue.dispatch(ctx)];\n                    case 3:\n                        dispatched = _b.sent();\n                        _b.label = 4;\n                    case 4:\n                        elapsedTime = Date.now() - startTime;\n                        timeoutInMs = this.settings.timeout;\n                        if (!callback) return [3 /*break*/, 6];\n                        return [4 /*yield*/, invokeCallback(dispatched, callback, Math.max((timeoutInMs !== null && timeoutInMs !== void 0 ? timeoutInMs : 300) - elapsedTime, 0), timeoutInMs)];\n                    case 5:\n                        dispatched = _b.sent();\n                        _b.label = 6;\n                    case 6:\n                        if (this._debug) {\n                            dispatched.flush();\n                        }\n                        return [2 /*return*/, dispatched];\n                }\n            });\n        });\n    };\n    Analytics.prototype.addSourceMiddleware = function (fn) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.queue.criticalTasks.run(function () { return __awaiter(_this, void 0, void 0, function () {\n                            var sourceMiddlewarePlugin, integrations, plugin;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, import(\n                                        /* webpackChunkName: \"middleware\" */ '../../plugins/middleware')];\n                                    case 1:\n                                        sourceMiddlewarePlugin = (_a.sent()).sourceMiddlewarePlugin;\n                                        integrations = {};\n                                        this.queue.plugins.forEach(function (plugin) {\n                                            if (plugin.type === 'destination') {\n                                                return (integrations[plugin.name] = true);\n                                            }\n                                        });\n                                        plugin = sourceMiddlewarePlugin(fn, integrations);\n                                        return [4 /*yield*/, this.register(plugin)];\n                                    case 2:\n                                        _a.sent();\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, this];\n                }\n            });\n        });\n    };\n    /* TODO: This does not have to return a promise? */\n    Analytics.prototype.addDestinationMiddleware = function (integrationName) {\n        var middlewares = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            middlewares[_i - 1] = arguments[_i];\n        }\n        var legacyDestinations = this.queue.plugins.filter(function (xt) {\n            // xt instanceof LegacyDestination &&\n            return xt.name.toLowerCase() === integrationName.toLowerCase();\n        });\n        legacyDestinations.forEach(function (destination) {\n            destination.addMiddleware.apply(destination, middlewares);\n        });\n        return Promise.resolve(this);\n    };\n    Analytics.prototype.setAnonymousId = function (id) {\n        return this._user.anonymousId(id);\n    };\n    Analytics.prototype.queryString = function (query) {\n        return __awaiter(this, void 0, void 0, function () {\n            var queryString;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, import(\n                        /* webpackChunkName: \"queryString\" */ '../query-string')];\n                    case 1:\n                        queryString = (_a.sent()).queryString;\n                        return [2 /*return*/, queryString(this, query)];\n                }\n            });\n        });\n    };\n    /**\n     * @deprecated This function does not register a destination plugin.\n     *\n     * Instantiates a legacy Analytics.js destination.\n     *\n     * This function does not register the destination as an Analytics.JS plugin,\n     * all the it does it to invoke the factory function back.\n     */\n    Analytics.prototype.use = function (legacyPluginFactory) {\n        legacyPluginFactory(this);\n        return this;\n    };\n    Analytics.prototype.ready = function (callback) {\n        if (callback === void 0) { callback = function (res) { return res; }; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, Promise.all(this.queue.plugins.map(function (i) { return (i.ready ? i.ready() : Promise.resolve()); })).then(function (res) {\n                        callback(res);\n                        return res;\n                    })];\n            });\n        });\n    };\n    // analytics-classic api\n    Analytics.prototype.noConflict = function () {\n        console.warn(deprecationWarning);\n        window.analytics = _analytics !== null && _analytics !== void 0 ? _analytics : this;\n        return this;\n    };\n    Analytics.prototype.normalize = function (msg) {\n        console.warn(deprecationWarning);\n        return this.eventFactory.normalize(msg);\n    };\n    Object.defineProperty(Analytics.prototype, \"failedInitializations\", {\n        get: function () {\n            console.warn(deprecationWarning);\n            return this.queue.failedInitializations;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Analytics.prototype, \"VERSION\", {\n        get: function () {\n            return version;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /* @deprecated - noop */\n    Analytics.prototype.initialize = function (_settings, _options) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                console.warn(deprecationWarning);\n                return [2 /*return*/, Promise.resolve(this)];\n            });\n        });\n    };\n    Analytics.prototype.pageview = function (url) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        console.warn(deprecationWarning);\n                        return [4 /*yield*/, this.page({ path: url })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, this];\n                }\n            });\n        });\n    };\n    Object.defineProperty(Analytics.prototype, \"plugins\", {\n        get: function () {\n            var _a;\n            console.warn(deprecationWarning);\n            // @ts-expect-error\n            return (_a = this._plugins) !== null && _a !== void 0 ? _a : {};\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Analytics.prototype, \"Integrations\", {\n        get: function () {\n            console.warn(deprecationWarning);\n            var integrations = this.queue.plugins\n                .filter(function (plugin) { return plugin.type === 'destination'; })\n                .reduce(function (acc, plugin) {\n                var name = \"\".concat(plugin.name\n                    .toLowerCase()\n                    .replace('.', '')\n                    .split(' ')\n                    .join('-'), \"Integration\");\n                // @ts-expect-error\n                var integration = window[name];\n                if (!integration) {\n                    return acc;\n                }\n                var nested = integration.Integration; // hack - Google Analytics function resides in the \"Integration\" field\n                if (nested) {\n                    acc[plugin.name] = nested;\n                    return acc;\n                }\n                acc[plugin.name] = integration;\n                return acc;\n            }, {});\n            return integrations;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    // snippet function\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Analytics.prototype.push = function (args) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var an = this;\n        var method = args.shift();\n        if (method) {\n            if (!an[method])\n                return;\n        }\n        an[method].apply(this, args);\n    };\n    return Analytics;\n}(Emitter));\nexport { Analytics };\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}