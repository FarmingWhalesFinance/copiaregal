{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rober\\\\Documents\\\\swaps-client\\\\src\\\\components\\\\Exchange\\\\SwapBox.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useMemo, useCallback } from \"react\";\nimport Tooltip from \"../Tooltip/Tooltip\";\nimport Modal from \"../Modal/Modal\";\nimport useSWR from \"swr\";\nimport { ethers } from \"ethers\";\nimport { IoMdSwap } from \"react-icons/io\";\nimport { BsArrowRight } from \"react-icons/bs\";\nimport { helperToast, formatAmount, bigNumberify, USD_DECIMALS, USDG_DECIMALS, LONG, SHORT, SWAP, MARKET, SWAP_ORDER_OPTIONS, LEVERAGE_ORDER_OPTIONS, DEFAULT_HIGHER_SLIPPAGE_AMOUNT, getPositionKey, getUsd, BASIS_POINTS_DIVISOR, MARGIN_FEE_BASIS_POINTS, PRECISION, USDG_ADDRESS, STOP, LIMIT, SWAP_OPTIONS, DUST_BNB, isTriggerRatioInverted, usePrevious, formatAmountFree, fetcher, parseValue, expandDecimals, shouldRaiseGasError, getTokenInfo, getLiquidationPrice, approveTokens, getLeverage, isSupportedChain, getExchangeRate, getExchangeRateDisplay, getNextToAmount, getNextFromAmount, getMostAbundantStableToken, useLocalStorageSerializeKey, useLocalStorageByChainId, calculatePositionDelta, replaceNativeTokenAddress, adjustForDecimals, isHashZero, NETWORK_NAME, getSpread, getUserTokenBalances } from \"../../Helpers\";\nimport { getConstant } from \"../../Constants\";\nimport * as Api from \"../../Api\";\nimport { getContract } from \"../../Addresses\";\nimport Tab from \"../Tab/Tab\";\nimport TokenSelector from \"./TokenSelector\";\nimport ExchangeInfoRow from \"./ExchangeInfoRow\";\nimport ConfirmationBox from \"./ConfirmationBox\";\nimport OrdersToa from \"./OrdersToa\";\nimport { getTokens, getWhitelistedTokens, getToken, getTokenBySymbol } from \"../../data/Tokens\";\nimport PositionRouter from \"../../abis/PositionRouter.json\";\nimport Router from \"../../abis/Router.json\";\nimport Token from \"../../abis/Token.json\";\nimport WETH from \"../../abis/WETH.json\";\nimport longImg from \"../../img/long.svg\";\nimport shortImg from \"../../img/short.svg\";\nimport swapImg from \"../../img/swap.svg\";\nimport { useUserReferralCode } from \"../../Api/referrals\";\nimport { LeverageInput } from \"./LeverageInput\";\nimport { REFERRAL_CODE_KEY } from \"../../config/localstorage\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SWAP_ICONS = {\n  [LONG]: longImg,\n  [SHORT]: shortImg,\n  [SWAP]: swapImg\n};\nconst {\n  AddressZero\n} = ethers.constants;\n\nfunction getNextAveragePrice(_ref) {\n  let {\n    size,\n    sizeDelta,\n    hasProfit,\n    delta,\n    nextPrice,\n    isLong\n  } = _ref;\n\n  if (!size || !sizeDelta || !delta || !nextPrice) {\n    return;\n  }\n\n  const nextSize = size.add(sizeDelta);\n  let divisor;\n\n  if (isLong) {\n    divisor = hasProfit ? nextSize.add(delta) : nextSize.sub(delta);\n  } else {\n    divisor = hasProfit ? nextSize.sub(delta) : nextSize.add(delta);\n  }\n\n  if (!divisor || divisor.eq(0)) {\n    return;\n  }\n\n  const nextAveragePrice = nextPrice.mul(nextSize).div(divisor);\n  return nextAveragePrice;\n}\n\nexport default function SwapBox(props) {\n  _s();\n\n  const {\n    pendingPositions,\n    setPendingPositions,\n    infoTokens,\n    active,\n    library,\n    account,\n    fromTokenAddress,\n    setFromTokenAddress,\n    toTokenAddress,\n    setToTokenAddress,\n    swapOption,\n    setSwapOption,\n    positionsMap,\n    pendingTxns,\n    setPendingTxns,\n    tokenSelection,\n    setTokenSelection,\n    setIsConfirming,\n    isConfirming,\n    isPendingConfirmation,\n    setIsPendingConfirmation,\n    flagOrdersEnabled,\n    chainId,\n    nativeTokenAddress,\n    savedSlippageAmount,\n    totalTokenWeights,\n    usdgSupply,\n    orders,\n    savedIsPnlInLeverage,\n    orderBookApproved,\n    positionRouterApproved,\n    isWaitingForPluginApproval,\n    approveOrderBook,\n    approvePositionRouter,\n    setIsWaitingForPluginApproval,\n    isWaitingForPositionRouterApproval,\n    setIsWaitingForPositionRouterApproval,\n    isPluginApproving,\n    isPositionRouterApproving,\n    trackAction\n  } = props;\n  const [fromValue, setFromValue] = useState(\"\");\n  const [toValue, setToValue] = useState(\"\");\n  const [anchorOnFromAmount, setAnchorOnFromAmount] = useState(true);\n  const [isApproving, setIsApproving] = useState(false);\n  const [isWaitingForApproval, setIsWaitingForApproval] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [modalError, setModalError] = useState(false);\n  const [isHigherSlippageAllowed, setIsHigherSlippageAllowed] = useState(false);\n  const {\n    userReferralCode\n  } = useUserReferralCode(library, chainId, account);\n  const userReferralCodeInLocalStorage = window.localStorage.getItem(REFERRAL_CODE_KEY);\n  let allowedSlippage = savedSlippageAmount;\n\n  if (isHigherSlippageAllowed) {\n    allowedSlippage = DEFAULT_HIGHER_SLIPPAGE_AMOUNT;\n  }\n\n  const defaultCollateralSymbol = getConstant(chainId, \"defaultCollateralSymbol\"); // TODO hack with useLocalStorageSerializeKey\n\n  const [shortCollateralAddress, setShortCollateralAddress] = useLocalStorageByChainId(chainId, \"Short-Collateral-Address\", getTokenBySymbol(chainId, defaultCollateralSymbol).address);\n  const isLong = swapOption === LONG;\n  const isShort = swapOption === SHORT;\n  const isSwap = swapOption === SWAP;\n\n  function getTokenLabel() {\n    switch (true) {\n      case isLong:\n        return \"Long\";\n\n      case isShort:\n        return \"Short\";\n\n      case isSwap:\n        return \"Receive\";\n\n      default:\n        return \"\";\n    }\n  }\n\n  const [leverageOption, setLeverageOption] = useLocalStorageSerializeKey([chainId, \"Exchange-swap-leverage-option\"], \"2\");\n  const hasLeverageOption = !isNaN(parseFloat(leverageOption));\n  const [ordersToaOpen, setOrdersToaOpen] = useState(false);\n  let [orderOption, setOrderOption] = useLocalStorageSerializeKey([chainId, \"Order-option\"], MARKET);\n\n  if (!flagOrdersEnabled) {\n    orderOption = MARKET;\n  }\n\n  const onOrderOptionChange = option => {\n    // limits disabled\n    if (typeof option === \"string\") {\n      setOrderOption(option);\n    }\n  };\n\n  const [sellValue, setSellValue] = useState(\"\");\n\n  const onSellChange = evt => {\n    setSellValue(evt.target.value || \"\");\n  };\n\n  const isMarketOrder = orderOption === MARKET;\n  const orderOptions = isSwap ? SWAP_ORDER_OPTIONS : LEVERAGE_ORDER_OPTIONS;\n  const [triggerPriceValue, setTriggerPriceValue] = useState(\"\");\n  const triggerPriceUsd = isMarketOrder ? 0 : parseValue(triggerPriceValue, USD_DECIMALS);\n\n  const onTriggerPriceChange = evt => {\n    setTriggerPriceValue(evt.target.value || \"\");\n  };\n\n  const onTriggerRatioChange = evt => {\n    setTriggerRatioValue(evt.target.value || \"\");\n  };\n\n  let positionKey;\n\n  if (isLong) {\n    positionKey = getPositionKey(account, toTokenAddress, toTokenAddress, true, nativeTokenAddress);\n  }\n\n  if (isShort) {\n    positionKey = getPositionKey(account, shortCollateralAddress, toTokenAddress, false, nativeTokenAddress);\n  }\n\n  const existingPosition = positionKey ? positionsMap[positionKey] : undefined;\n  const hasExistingPosition = existingPosition && existingPosition.size && existingPosition.size.gt(0);\n  const whitelistedTokens = getWhitelistedTokens(chainId);\n  const tokens = getTokens(chainId);\n  const fromTokens = tokens;\n  const stableTokens = tokens.filter(token => token.isStable);\n  const indexTokens = whitelistedTokens.filter(token => !token.isStable && !token.isWrapped);\n  const shortableTokens = indexTokens.filter(token => token.isShortable);\n  let toTokens = tokens;\n\n  if (isLong) {\n    toTokens = indexTokens;\n  }\n\n  if (isShort) {\n    toTokens = shortableTokens;\n  }\n\n  const needOrderBookApproval = !isMarketOrder && !orderBookApproved;\n  const prevNeedOrderBookApproval = usePrevious(needOrderBookApproval);\n  const needPositionRouterApproval = (isLong || isShort) && isMarketOrder && !positionRouterApproved;\n  const prevNeedPositionRouterApproval = usePrevious(needPositionRouterApproval);\n  useEffect(() => {\n    if (!needOrderBookApproval && prevNeedOrderBookApproval && isWaitingForPluginApproval) {\n      setIsWaitingForPluginApproval(false);\n      helperToast.success( /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Orders enabled!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 27\n      }, this));\n    }\n  }, [needOrderBookApproval, prevNeedOrderBookApproval, setIsWaitingForPluginApproval, isWaitingForPluginApproval]);\n  useEffect(() => {\n    if (!needPositionRouterApproval && prevNeedPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      setIsWaitingForPositionRouterApproval(false);\n      helperToast.success( /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Leverage enabled!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 27\n      }, this));\n    }\n  }, [needPositionRouterApproval, prevNeedPositionRouterApproval, setIsWaitingForPositionRouterApproval, isWaitingForPositionRouterApproval]);\n  useEffect(() => {\n    if (!needOrderBookApproval && prevNeedOrderBookApproval && isWaitingForPluginApproval) {\n      setIsWaitingForPluginApproval(false);\n      helperToast.success( /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Orders enabled!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 27\n      }, this));\n    }\n  }, [needOrderBookApproval, prevNeedOrderBookApproval, setIsWaitingForPluginApproval, isWaitingForPluginApproval]);\n  const routerAddress = getContract(chainId, \"Router\");\n  const tokenAllowanceAddress = fromTokenAddress === AddressZero ? nativeTokenAddress : fromTokenAddress;\n  const {\n    data: tokenAllowance\n  } = useSWR(active && [active, chainId, tokenAllowanceAddress, \"allowance\", account, routerAddress], {\n    fetcher: fetcher(library, Token)\n  });\n  const positionRouterAddress = getContract(chainId, \"PositionRouter\");\n  const {\n    data: minExecutionFee\n  } = useSWR([active, chainId, positionRouterAddress, \"minExecutionFee\"], {\n    fetcher: fetcher(library, PositionRouter)\n  });\n  const {\n    data: hasOutdatedUi\n  } = Api.useHasOutdatedUi();\n  const fromToken = getToken(chainId, fromTokenAddress);\n  const toToken = getToken(chainId, toTokenAddress);\n  const shortCollateralToken = getTokenInfo(infoTokens, shortCollateralAddress);\n  const fromTokenInfo = getTokenInfo(infoTokens, fromTokenAddress);\n  const toTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n  const toTokenAvailableUsd = toTokenInfo.availableUsd;\n\n  const renderAvailableLongLiquidity = () => {\n    if (!isLong) {\n      return null;\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Exchange-info-row\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-info-label\",\n        children: \"Available Liquidity\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"align-right\",\n        children: formatAmount(toTokenAvailableUsd, USD_DECIMALS, 2, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 7\n    }, this);\n  };\n\n  const hasMaxAvailableShort = isShort && toTokenInfo.maxAvailableShort && toTokenInfo.maxAvailableShort.gt(0);\n  const fromBalance = fromTokenInfo ? fromTokenInfo.balance : bigNumberify(0);\n  const toBalance = toTokenInfo ? toTokenInfo.balance : bigNumberify(0);\n  const fromAmount = parseValue(fromValue, fromToken && fromToken.decimals);\n  const toAmount = parseValue(toValue, toToken && toToken.decimals);\n  const isPotentialWrap = fromToken.isNative && toToken.isWrapped || fromToken.isWrapped && toToken.isNative;\n  const isWrapOrUnwrap = isSwap && isPotentialWrap;\n  const needApproval = fromTokenAddress !== AddressZero && tokenAllowance && fromAmount && fromAmount.gt(tokenAllowance) && !isWrapOrUnwrap;\n  const prevFromTokenAddress = usePrevious(fromTokenAddress);\n  const prevNeedApproval = usePrevious(needApproval);\n  const prevToTokenAddress = usePrevious(toTokenAddress);\n  const fromUsdMin = getUsd(fromAmount, fromTokenAddress, false, infoTokens);\n  const toUsdMax = getUsd(toAmount, toTokenAddress, true, infoTokens, orderOption, triggerPriceUsd);\n  const indexTokenAddress = toTokenAddress === AddressZero ? nativeTokenAddress : toTokenAddress;\n  const collateralTokenAddress = isLong ? indexTokenAddress : shortCollateralAddress;\n  const collateralToken = getToken(chainId, collateralTokenAddress);\n  const [triggerRatioValue, setTriggerRatioValue] = useState(\"\");\n  const triggerRatioInverted = useMemo(() => {\n    return isTriggerRatioInverted(fromTokenInfo, toTokenInfo);\n  }, [toTokenInfo, fromTokenInfo]);\n  const triggerRatio = useMemo(() => {\n    if (!triggerRatioValue) {\n      return bigNumberify(0);\n    }\n\n    let ratio = parseValue(triggerRatioValue, USD_DECIMALS);\n\n    if (ratio.eq(0)) {\n      return bigNumberify(0);\n    }\n\n    if (triggerRatioInverted) {\n      ratio = PRECISION.mul(PRECISION).div(ratio);\n    }\n\n    return ratio;\n  }, [triggerRatioValue, triggerRatioInverted]);\n  useEffect(() => {\n    if (fromToken && fromTokenAddress === prevFromTokenAddress && !needApproval && prevNeedApproval && isWaitingForApproval) {\n      setIsWaitingForApproval(false);\n      helperToast.success( /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [fromToken.symbol, \" approved!\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 27\n      }, this));\n    }\n  }, [fromTokenAddress, prevFromTokenAddress, needApproval, prevNeedApproval, setIsWaitingForApproval, fromToken.symbol, isWaitingForApproval, fromToken]);\n  useEffect(() => {\n    if (!toTokens.find(token => token.address === toTokenAddress)) {\n      setToTokenAddress(swapOption, toTokens[0].address);\n    }\n  }, [swapOption, toTokens, toTokenAddress, setToTokenAddress]);\n  useEffect(() => {\n    if (swapOption !== SHORT) {\n      return;\n    }\n\n    if (toTokenAddress === prevToTokenAddress) {\n      return;\n    }\n\n    for (let i = 0; i < stableTokens.length; i++) {\n      const stableToken = stableTokens[i];\n      const key = getPositionKey(account, stableToken.address, toTokenAddress, false, nativeTokenAddress);\n      const position = positionsMap[key];\n\n      if (position && position.size && position.size.gt(0)) {\n        setShortCollateralAddress(position.collateralToken.address);\n        return;\n      }\n    }\n  }, [account, toTokenAddress, prevToTokenAddress, swapOption, positionsMap, stableTokens, nativeTokenAddress, shortCollateralAddress, setShortCollateralAddress]);\n  useEffect(() => {\n    const updateSwapAmounts = () => {\n      if (anchorOnFromAmount) {\n        if (!fromAmount) {\n          setToValue(\"\");\n          return;\n        }\n\n        if (toToken) {\n          const {\n            amount: nextToAmount\n          } = getNextToAmount(chainId, fromAmount, fromTokenAddress, toTokenAddress, infoTokens, undefined, !isMarketOrder && triggerRatio, usdgSupply, totalTokenWeights);\n          const nextToValue = formatAmountFree(nextToAmount, toToken.decimals, toToken.decimals);\n          setToValue(nextToValue);\n        }\n\n        return;\n      }\n\n      if (!toAmount) {\n        setFromValue(\"\");\n        return;\n      }\n\n      if (fromToken) {\n        const {\n          amount: nextFromAmount\n        } = getNextFromAmount(chainId, toAmount, fromTokenAddress, toTokenAddress, infoTokens, undefined, !isMarketOrder && triggerRatio, usdgSupply, totalTokenWeights);\n        const nextFromValue = formatAmountFree(nextFromAmount, fromToken.decimals, fromToken.decimals);\n        setFromValue(nextFromValue);\n      }\n    };\n\n    const updateLeverageAmounts = () => {\n      if (!hasLeverageOption) {\n        return;\n      }\n\n      if (anchorOnFromAmount) {\n        if (!fromAmount) {\n          setToValue(\"\");\n          return;\n        }\n\n        const toTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n\n        if (toTokenInfo && toTokenInfo.maxPrice && fromUsdMin && fromUsdMin.gt(0)) {\n          const leverageMultiplier = parseInt(leverageOption * BASIS_POINTS_DIVISOR);\n          const toTokenPriceUsd = !isMarketOrder && triggerPriceUsd && triggerPriceUsd.gt(0) ? triggerPriceUsd : toTokenInfo.maxPrice;\n          const {\n            feeBasisPoints\n          } = getNextToAmount(chainId, fromAmount, fromTokenAddress, collateralTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n          let fromUsdMinAfterFee = fromUsdMin;\n\n          if (feeBasisPoints) {\n            fromUsdMinAfterFee = fromUsdMin.mul(BASIS_POINTS_DIVISOR - feeBasisPoints).div(BASIS_POINTS_DIVISOR);\n          }\n\n          const toNumerator = fromUsdMinAfterFee.mul(leverageMultiplier).mul(BASIS_POINTS_DIVISOR);\n          const toDenominator = bigNumberify(MARGIN_FEE_BASIS_POINTS).mul(leverageMultiplier).add(bigNumberify(BASIS_POINTS_DIVISOR).mul(BASIS_POINTS_DIVISOR));\n          const nextToUsd = toNumerator.div(toDenominator);\n          const nextToAmount = nextToUsd.mul(expandDecimals(1, toToken.decimals)).div(toTokenPriceUsd);\n          const nextToValue = formatAmountFree(nextToAmount, toToken.decimals, toToken.decimals);\n          setToValue(nextToValue);\n        }\n\n        return;\n      }\n\n      if (!toAmount) {\n        setFromValue(\"\");\n        return;\n      }\n\n      const fromTokenInfo = getTokenInfo(infoTokens, fromTokenAddress);\n\n      if (fromTokenInfo && fromTokenInfo.minPrice && toUsdMax && toUsdMax.gt(0)) {\n        const leverageMultiplier = parseInt(leverageOption * BASIS_POINTS_DIVISOR);\n        const baseFromAmountUsd = toUsdMax.mul(BASIS_POINTS_DIVISOR).div(leverageMultiplier);\n        let fees = toUsdMax.mul(MARGIN_FEE_BASIS_POINTS).div(BASIS_POINTS_DIVISOR);\n        const {\n          feeBasisPoints\n        } = getNextToAmount(chainId, fromAmount, fromTokenAddress, collateralTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n\n        if (feeBasisPoints) {\n          const swapFees = baseFromAmountUsd.mul(feeBasisPoints).div(BASIS_POINTS_DIVISOR);\n          fees = fees.add(swapFees);\n        }\n\n        const nextFromUsd = baseFromAmountUsd.add(fees);\n        const nextFromAmount = nextFromUsd.mul(expandDecimals(1, fromToken.decimals)).div(fromTokenInfo.minPrice);\n        const nextFromValue = formatAmountFree(nextFromAmount, fromToken.decimals, fromToken.decimals);\n        setFromValue(nextFromValue);\n      }\n    };\n\n    if (isSwap) {\n      updateSwapAmounts();\n    }\n\n    if (isLong || isShort) {\n      updateLeverageAmounts();\n    }\n  }, [anchorOnFromAmount, fromAmount, toAmount, fromToken, toToken, fromTokenAddress, toTokenAddress, infoTokens, isSwap, isLong, isShort, leverageOption, fromUsdMin, toUsdMax, isMarketOrder, triggerPriceUsd, triggerRatio, hasLeverageOption, usdgSupply, totalTokenWeights, chainId, collateralTokenAddress, indexTokenAddress]);\n  let entryMarkPrice;\n  let exitMarkPrice;\n\n  if (toTokenInfo) {\n    entryMarkPrice = swapOption === LONG ? toTokenInfo.maxPrice : toTokenInfo.minPrice;\n    exitMarkPrice = swapOption === LONG ? toTokenInfo.minPrice : toTokenInfo.maxPrice;\n  }\n\n  let leverage = bigNumberify(0);\n\n  if (fromUsdMin && toUsdMax && fromUsdMin.gt(0)) {\n    const fees = toUsdMax.mul(MARGIN_FEE_BASIS_POINTS).div(BASIS_POINTS_DIVISOR);\n\n    if (fromUsdMin.sub(fees).gt(0)) {\n      leverage = toUsdMax.mul(BASIS_POINTS_DIVISOR).div(fromUsdMin.sub(fees));\n    }\n  }\n\n  let nextAveragePrice = isMarketOrder ? entryMarkPrice : triggerPriceUsd;\n\n  if (hasExistingPosition) {\n    let nextDelta, nextHasProfit;\n\n    if (isMarketOrder) {\n      nextDelta = existingPosition.delta;\n      nextHasProfit = existingPosition.hasProfit;\n    } else {\n      const data = calculatePositionDelta(triggerPriceUsd || bigNumberify(0), existingPosition);\n      nextDelta = data.delta;\n      nextHasProfit = data.hasProfit;\n    }\n\n    nextAveragePrice = getNextAveragePrice({\n      size: existingPosition.size,\n      sizeDelta: toUsdMax,\n      hasProfit: nextHasProfit,\n      delta: nextDelta,\n      nextPrice: isMarketOrder ? entryMarkPrice : triggerPriceUsd,\n      isLong\n    });\n  }\n\n  const liquidationPrice = getLiquidationPrice({\n    isLong,\n    size: hasExistingPosition ? existingPosition.size : bigNumberify(0),\n    collateral: hasExistingPosition ? existingPosition.collateral : bigNumberify(0),\n    averagePrice: nextAveragePrice,\n    entryFundingRate: hasExistingPosition ? existingPosition.entryFundingRate : bigNumberify(0),\n    cumulativeFundingRate: hasExistingPosition ? existingPosition.cumulativeFundingRate : bigNumberify(0),\n    sizeDelta: toUsdMax,\n    collateralDelta: fromUsdMin,\n    increaseCollateral: true,\n    increaseSize: true\n  });\n  const existingLiquidationPrice = existingPosition ? getLiquidationPrice(existingPosition) : undefined;\n  let displayLiquidationPrice = liquidationPrice ? liquidationPrice : existingLiquidationPrice;\n\n  if (hasExistingPosition) {\n    const collateralDelta = fromUsdMin ? fromUsdMin : bigNumberify(0);\n    const sizeDelta = toUsdMax ? toUsdMax : bigNumberify(0);\n    leverage = getLeverage({\n      size: existingPosition.size,\n      sizeDelta,\n      collateral: existingPosition.collateral,\n      collateralDelta,\n      increaseCollateral: true,\n      entryFundingRate: existingPosition.entryFundingRate,\n      cumulativeFundingRate: existingPosition.cumulativeFundingRate,\n      increaseSize: true,\n      hasProfit: existingPosition.hasProfit,\n      delta: existingPosition.delta,\n      includeDelta: savedIsPnlInLeverage\n    });\n  } else if (hasLeverageOption) {\n    leverage = bigNumberify(parseInt(leverageOption * BASIS_POINTS_DIVISOR));\n  }\n\n  const getSwapError = () => {\n    var _gasTokenInfo$balance;\n\n    const gasTokenInfo = getTokenInfo(infoTokens, ethers.constants.AddressZero);\n\n    if ((_gasTokenInfo$balance = gasTokenInfo.balance) !== null && _gasTokenInfo$balance !== void 0 && _gasTokenInfo$balance.eq(0)) {\n      return [\"Not enough ETH for gas\"];\n    }\n\n    if (fromTokenAddress === toTokenAddress) {\n      return [\"Select different tokens\"];\n    }\n\n    if (!isMarketOrder) {\n      if ((toToken.isStable || toToken.isUsdg) && (fromToken.isStable || fromToken.isUsdg)) {\n        return [\"Select different tokens\"];\n      }\n\n      if (fromToken.isNative && toToken.isWrapped) {\n        return [\"Select different tokens\"];\n      }\n\n      if (toToken.isNative && fromToken.isWrapped) {\n        return [\"Select different tokens\"];\n      }\n    }\n\n    if (!fromAmount || fromAmount.eq(0)) {\n      return [\"Enter an amount\"];\n    }\n\n    if (!toAmount || toAmount.eq(0)) {\n      return [\"Enter an amount\"];\n    }\n\n    const fromTokenInfo = getTokenInfo(infoTokens, fromTokenAddress);\n\n    if (!fromTokenInfo || !fromTokenInfo.minPrice) {\n      return [\"Incorrect network\"];\n    }\n\n    if (fromTokenInfo && fromTokenInfo.balance && fromAmount && fromAmount.gt(fromTokenInfo.balance)) {\n      return [`Insufficient ${fromTokenInfo.symbol} balance`];\n    }\n\n    const toTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n\n    if (!isMarketOrder) {\n      if (!triggerRatioValue || triggerRatio.eq(0)) {\n        return [\"Enter a price\"];\n      }\n\n      const currentRate = getExchangeRate(fromTokenInfo, toTokenInfo);\n\n      if (currentRate && currentRate.lt(triggerRatio)) {\n        return [`Price ${triggerRatioInverted ? \"below\" : \"above\"} Mark Price`];\n      }\n    }\n\n    if (!isWrapOrUnwrap && toToken && toTokenAddress !== USDG_ADDRESS && toTokenInfo && toTokenInfo.availableAmount && toAmount.gt(toTokenInfo.availableAmount)) {\n      return [\"Insufficient liquidity\"];\n    }\n\n    if (!isWrapOrUnwrap && toAmount && toTokenInfo.bufferAmount && toTokenInfo.poolAmount && toTokenInfo.bufferAmount.gt(toTokenInfo.poolAmount.sub(toAmount))) {\n      return [\"Insufficient liquidity\"];\n    }\n\n    if (fromUsdMin && fromTokenInfo.maxUsdgAmount && fromTokenInfo.maxUsdgAmount.gt(0) && fromTokenInfo.usdgAmount && fromTokenInfo.maxPrice) {\n      const usdgFromAmount = adjustForDecimals(fromUsdMin, USD_DECIMALS, USDG_DECIMALS);\n      const nextUsdgAmount = fromTokenInfo.usdgAmount.add(usdgFromAmount);\n\n      if (nextUsdgAmount.gt(fromTokenInfo.maxUsdgAmount)) {\n        return [`${fromTokenInfo.symbol} pool exceeded`];\n      }\n    }\n\n    return [false];\n  };\n\n  const getLeverageError = useCallback(() => {\n    var _gasTokenInfo$balance2;\n\n    const gasTokenInfo = getTokenInfo(infoTokens, ethers.constants.AddressZero);\n\n    if ((_gasTokenInfo$balance2 = gasTokenInfo.balance) !== null && _gasTokenInfo$balance2 !== void 0 && _gasTokenInfo$balance2.eq(0)) {\n      return [\"Not enough ETH for gas\"];\n    }\n\n    if (hasOutdatedUi) {\n      return [\"Page outdated, please refresh\"];\n    }\n\n    if (!toAmount || toAmount.eq(0)) {\n      return [\"Enter an amount\"];\n    }\n\n    let toTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n\n    if (toTokenInfo && toTokenInfo.isStable) {\n      return [`${swapOption === LONG ? \"Longing\" : \"Shorting\"} ${toTokenInfo.symbol} not supported`];\n    }\n\n    const fromTokenInfo = getTokenInfo(infoTokens, fromTokenAddress);\n\n    if (fromTokenInfo && fromTokenInfo.balance && fromAmount && fromAmount.gt(fromTokenInfo.balance)) {\n      return [`Insufficient ${fromTokenInfo.symbol} balance`];\n    }\n\n    if (leverage && leverage.eq(0)) {\n      return [\"Enter an amount\"];\n    }\n\n    if (!isMarketOrder && (!triggerPriceValue || triggerPriceUsd.eq(0))) {\n      return [\"Enter a price\"];\n    }\n\n    if (!hasExistingPosition && fromUsdMin && fromUsdMin.lt(expandDecimals(10, USD_DECIMALS))) {\n      return [\"Min order: 10 USD\"];\n    }\n\n    if (leverage && leverage.lt(1.1 * BASIS_POINTS_DIVISOR)) {\n      return [\"Min leverage: 1.1x\"];\n    }\n\n    if (leverage && leverage.gt(30.5 * BASIS_POINTS_DIVISOR)) {\n      return [\"Max leverage: 30.5x\"];\n    }\n\n    if (!isMarketOrder && entryMarkPrice && triggerPriceUsd) {\n      if (isLong && entryMarkPrice.lt(triggerPriceUsd)) {\n        return [\"Price above Mark Price\"];\n      }\n\n      if (!isLong && entryMarkPrice.gt(triggerPriceUsd)) {\n        return [\"Price below Mark Price\"];\n      }\n    }\n\n    if (isLong) {\n      let requiredAmount = toAmount;\n\n      if (fromTokenAddress !== toTokenAddress) {\n        const {\n          amount: swapAmount\n        } = getNextToAmount(chainId, fromAmount, fromTokenAddress, toTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n        requiredAmount = requiredAmount.add(swapAmount);\n\n        if (toToken && toTokenAddress !== USDG_ADDRESS) {\n          if (!toTokenInfo.availableAmount) {\n            return [\"Liquidity data not loaded\"];\n          }\n\n          if (toTokenInfo.availableAmount && requiredAmount.gt(toTokenInfo.availableAmount)) {\n            return [\"Insufficient liquidity\"];\n          }\n        }\n\n        if (toTokenInfo.poolAmount && toTokenInfo.bufferAmount && toTokenInfo.bufferAmount.gt(toTokenInfo.poolAmount.sub(swapAmount))) {\n          return [\"Insufficient liquidity\", true, \"BUFFER\"];\n        }\n\n        if (fromUsdMin && fromTokenInfo.maxUsdgAmount && fromTokenInfo.maxUsdgAmount.gt(0) && fromTokenInfo.minPrice && fromTokenInfo.usdgAmount) {\n          const usdgFromAmount = adjustForDecimals(fromUsdMin, USD_DECIMALS, USDG_DECIMALS);\n          const nextUsdgAmount = fromTokenInfo.usdgAmount.add(usdgFromAmount);\n\n          if (nextUsdgAmount.gt(fromTokenInfo.maxUsdgAmount)) {\n            return [`${fromTokenInfo.symbol} pool exceeded, try different token`, true, \"MAX_USDG\"];\n          }\n        }\n\n        if (toTokenInfo && toTokenInfo.maxPrice) {\n          const sizeUsd = toAmount.mul(toTokenInfo.maxPrice).div(expandDecimals(1, toTokenInfo.decimals));\n\n          if (toTokenInfo.maxGlobalLongSize && toTokenInfo.maxGlobalLongSize.gt(0) && toTokenInfo.maxAvailableLong && sizeUsd.gt(toTokenInfo.maxAvailableLong)) {\n            return [`Max ${toTokenInfo.symbol} long exceeded`];\n          }\n        }\n      }\n    }\n\n    if (isShort) {\n      let stableTokenAmount = bigNumberify(0);\n\n      if (fromTokenAddress !== shortCollateralAddress && fromAmount && fromAmount.gt(0)) {\n        const {\n          amount: nextToAmount\n        } = getNextToAmount(chainId, fromAmount, fromTokenAddress, shortCollateralAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n        stableTokenAmount = nextToAmount;\n\n        if (stableTokenAmount.gt(shortCollateralToken.availableAmount)) {\n          return [`Insufficient liquidity, change \"Profits In\"`];\n        }\n\n        if (shortCollateralToken.bufferAmount && shortCollateralToken.poolAmount && shortCollateralToken.bufferAmount.gt(shortCollateralToken.poolAmount.sub(stableTokenAmount))) {\n          // suggest swapping to collateralToken\n          return [`Insufficient liquidity, change \"Profits In\"`, true, \"BUFFER\"];\n        }\n\n        if (fromTokenInfo.maxUsdgAmount && fromTokenInfo.maxUsdgAmount.gt(0) && fromTokenInfo.minPrice && fromTokenInfo.usdgAmount) {\n          const usdgFromAmount = adjustForDecimals(fromUsdMin, USD_DECIMALS, USDG_DECIMALS);\n          const nextUsdgAmount = fromTokenInfo.usdgAmount.add(usdgFromAmount);\n\n          if (nextUsdgAmount.gt(fromTokenInfo.maxUsdgAmount)) {\n            return [`${fromTokenInfo.symbol} pool exceeded, try different token`, true, \"MAX_USDG\"];\n          }\n        }\n      }\n\n      if (!shortCollateralToken || !fromTokenInfo || !toTokenInfo || !toTokenInfo.maxPrice || !shortCollateralToken.availableAmount) {\n        return [\"Fetching token info...\"];\n      }\n\n      const sizeUsd = toAmount.mul(toTokenInfo.maxPrice).div(expandDecimals(1, toTokenInfo.decimals));\n      const sizeTokens = sizeUsd.mul(expandDecimals(1, shortCollateralToken.decimals)).div(shortCollateralToken.minPrice);\n\n      if (!toTokenInfo.maxAvailableShort) {\n        return [\"Liquidity data not loaded\"];\n      }\n\n      if (toTokenInfo.maxAvailableShort && toTokenInfo.maxAvailableShort.gt(0) && sizeUsd.gt(toTokenInfo.maxAvailableShort)) {\n        return [`Max ${toTokenInfo.symbol} short exceeded`];\n      }\n\n      stableTokenAmount = stableTokenAmount.add(sizeTokens);\n\n      if (stableTokenAmount.gt(shortCollateralToken.availableAmount)) {\n        return [`Insufficient liquidity, change \"Profits In\"`];\n      }\n    }\n\n    return [false];\n  }, [chainId, fromAmount, fromTokenAddress, fromUsdMin, hasExistingPosition, infoTokens, isLong, isMarketOrder, isShort, leverage, shortCollateralAddress, shortCollateralToken, swapOption, toAmount, toToken, toTokenAddress, totalTokenWeights, triggerPriceUsd, triggerPriceValue, usdgSupply, entryMarkPrice, hasOutdatedUi]);\n\n  const getToLabel = () => {\n    if (isSwap) {\n      return \"Receive\";\n    }\n\n    if (isLong) {\n      return \"Long\";\n    }\n\n    return \"Short\";\n  };\n\n  const getError = () => {\n    if (isSwap) {\n      return getSwapError();\n    }\n\n    return getLeverageError();\n  };\n\n  const renderOrdersToa = useCallback(() => {\n    if (!ordersToaOpen) {\n      return null;\n    }\n\n    return /*#__PURE__*/_jsxDEV(OrdersToa, {\n      setIsVisible: setOrdersToaOpen,\n      approveOrderBook: approveOrderBook,\n      isPluginApproving: isPluginApproving\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 999,\n      columnNumber: 7\n    }, this);\n  }, [ordersToaOpen, setOrdersToaOpen, isPluginApproving, approveOrderBook]);\n  const renderErrorModal = useCallback(() => {\n    const inputCurrency = fromToken.address === AddressZero ? \"ETH\" : fromToken.address;\n    let outputCurrency;\n\n    if (isLong) {\n      outputCurrency = toToken.address === AddressZero ? \"ETH\" : toToken.address;\n    } else {\n      outputCurrency = shortCollateralToken.address;\n    }\n\n    let uniswapUrl = `https://app.uniswap.org/#/swap?inputCurrency=${inputCurrency}&outputCurrency=${outputCurrency}&chain=arbitrum`;\n    const label = modalError === \"BUFFER\" ? `${shortCollateralToken.symbol} Required` : `${fromToken.symbol} Capacity Reached`;\n    const swapTokenSymbol = isLong ? toToken.symbol : shortCollateralToken.symbol;\n    return /*#__PURE__*/_jsxDEV(Modal, {\n      isVisible: !!modalError,\n      setIsVisible: setModalError,\n      label: label,\n      className: \"Error-modal\",\n      children: [\"You will need to select \", swapTokenSymbol, \" as the \\\"Pay\\\" token to initiate this trade.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1022,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1023,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n        href: uniswapUrl,\n        target: \"_blank\",\n        rel: \"noreferrer\",\n        children: [\"Buy \", swapTokenSymbol, \" on Uniswap\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1024,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1020,\n      columnNumber: 7\n    }, this);\n  }, [modalError, setModalError, fromToken === null || fromToken === void 0 ? void 0 : fromToken.address, toToken === null || toToken === void 0 ? void 0 : toToken.address, shortCollateralToken === null || shortCollateralToken === void 0 ? void 0 : shortCollateralToken.address, isLong, shortCollateralToken === null || shortCollateralToken === void 0 ? void 0 : shortCollateralToken.symbol, toToken === null || toToken === void 0 ? void 0 : toToken.symbol, fromToken === null || fromToken === void 0 ? void 0 : fromToken.symbol]);\n\n  const isPrimaryEnabled = () => {\n    if (!active) {\n      return true;\n    }\n\n    const [error, modal] = getError();\n\n    if (error && !modal) {\n      return false;\n    }\n\n    if (needOrderBookApproval && isWaitingForPluginApproval) {\n      return false;\n    }\n\n    if (needApproval && isWaitingForApproval || isApproving) {\n      return false;\n    }\n\n    if (needPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      return false;\n    }\n\n    if (isPositionRouterApproving) {\n      return false;\n    }\n\n    if (isApproving) {\n      return false;\n    }\n\n    if (isSubmitting) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const getPrimaryText = () => {\n    if (!active) {\n      return \"Connect Wallet\";\n    }\n\n    if (!isSupportedChain(chainId)) {\n      return \"Incorrect Network\";\n    }\n\n    const [error, modal] = getError();\n\n    if (error && !modal) {\n      return error;\n    }\n\n    if (needPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      return \"Enabling Leverage...\";\n    }\n\n    if (isPositionRouterApproving) {\n      return \"Enabling Leverage...\";\n    }\n\n    if (needPositionRouterApproval) {\n      return \"Enable Leverage\";\n    }\n\n    if (needApproval && isWaitingForApproval) {\n      return \"Waiting for Approval\";\n    }\n\n    if (isApproving) {\n      return `Approving ${fromToken.symbol}...`;\n    }\n\n    if (needApproval) {\n      return `Approve ${fromToken.symbol}`;\n    }\n\n    if (needOrderBookApproval && isWaitingForPluginApproval) {\n      return \"Enabling Orders...\";\n    }\n\n    if (isPluginApproving) {\n      return \"Enabling Orders...\";\n    }\n\n    if (needOrderBookApproval) {\n      return \"Enable Orders\";\n    }\n\n    if (!isMarketOrder) return `Create ${orderOption.charAt(0) + orderOption.substring(1).toLowerCase()} Order`;\n\n    if (isSwap) {\n      if (toUsdMax && toUsdMax.lt(fromUsdMin.mul(95).div(100))) {\n        return \"High Slippage, Swap Anyway\";\n      }\n\n      return \"Swap\";\n    }\n\n    if (isLong) {\n      const indexTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n\n      if (indexTokenInfo && indexTokenInfo.minPrice) {\n        const {\n          amount: nextToAmount\n        } = getNextToAmount(chainId, fromAmount, fromTokenAddress, indexTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n        const nextToAmountUsd = nextToAmount.mul(indexTokenInfo.minPrice).div(expandDecimals(1, indexTokenInfo.decimals));\n\n        if (fromTokenAddress === USDG_ADDRESS && nextToAmountUsd.lt(fromUsdMin.mul(98).div(100))) {\n          return \"High USDG Slippage, Long Anyway\";\n        }\n      }\n\n      return `Long ${toToken.symbol}`;\n    }\n\n    return `Short ${toToken.symbol}`;\n  };\n\n  const onSelectFromToken = token => {\n    setFromTokenAddress(swapOption, token.address);\n    setIsWaitingForApproval(false);\n\n    if (isShort && token.isStable) {\n      setShortCollateralAddress(token.address);\n    }\n  };\n\n  const onSelectShortCollateralAddress = token => {\n    setShortCollateralAddress(token.address);\n  };\n\n  const onSelectToToken = token => {\n    setToTokenAddress(swapOption, token.address);\n  };\n\n  const onFromValueChange = e => {\n    setAnchorOnFromAmount(true);\n    setFromValue(e.target.value);\n  };\n\n  const onToValueChange = e => {\n    setAnchorOnFromAmount(false);\n    setToValue(e.target.value);\n  };\n\n  const switchTokens = () => {\n    if (fromAmount && toAmount) {\n      if (anchorOnFromAmount) {\n        setToValue(formatAmountFree(fromAmount, fromToken.decimals, 8));\n      } else {\n        setFromValue(formatAmountFree(toAmount, toToken.decimals, 8));\n      }\n\n      setAnchorOnFromAmount(!anchorOnFromAmount);\n    }\n\n    setIsWaitingForApproval(false);\n    const updatedTokenSelection = JSON.parse(JSON.stringify(tokenSelection));\n    updatedTokenSelection[swapOption] = {\n      from: toTokenAddress,\n      to: fromTokenAddress\n    };\n    setTokenSelection(updatedTokenSelection);\n  };\n\n  const wrap = async () => {\n    setIsSubmitting(true);\n    const contract = new ethers.Contract(nativeTokenAddress, WETH.abi, library.getSigner());\n    Api.callContract(chainId, contract, \"deposit\", {\n      value: fromAmount,\n      sentMsg: \"Swap submitted.\",\n      successMsg: `Swapped ${formatAmount(fromAmount, fromToken.decimals, 4, true)} ${fromToken.symbol} for ${formatAmount(toAmount, toToken.decimals, 4, true)} ${toToken.symbol}!`,\n      failMsg: \"Swap failed.\",\n      setPendingTxns\n    }).then(async res => {}).finally(() => {\n      setIsSubmitting(false);\n    });\n  };\n\n  const unwrap = async () => {\n    setIsSubmitting(true);\n    const contract = new ethers.Contract(nativeTokenAddress, WETH.abi, library.getSigner());\n    Api.callContract(chainId, contract, \"withdraw\", [fromAmount], {\n      sentMsg: \"Swap submitted!\",\n      failMsg: \"Swap failed.\",\n      successMsg: `Swapped ${formatAmount(fromAmount, fromToken.decimals, 4, true)} ${fromToken.symbol} for ${formatAmount(toAmount, toToken.decimals, 4, true)} ${toToken.symbol}!`,\n      setPendingTxns\n    }).then(async res => {}).finally(() => {\n      setIsSubmitting(false);\n    });\n  };\n\n  const swap = async () => {\n    if (fromToken.isNative && toToken.isWrapped) {\n      wrap();\n      return;\n    }\n\n    if (fromTokenAddress.isWrapped && toToken.isNative) {\n      unwrap();\n      return;\n    }\n\n    setIsSubmitting(true);\n    let path = [fromTokenAddress, toTokenAddress];\n\n    if (anchorOnFromAmount) {\n      const {\n        path: multiPath\n      } = getNextToAmount(chainId, fromAmount, fromTokenAddress, toTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n\n      if (multiPath) {\n        path = multiPath;\n      }\n    } else {\n      const {\n        path: multiPath\n      } = getNextFromAmount(chainId, toAmount, fromTokenAddress, toTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n\n      if (multiPath) {\n        path = multiPath;\n      }\n    }\n\n    let method;\n    let contract;\n    let value;\n    let params;\n    let minOut;\n\n    if (shouldRaiseGasError(getTokenInfo(infoTokens, fromTokenAddress), fromAmount)) {\n      setIsSubmitting(false);\n      setIsPendingConfirmation(true);\n      helperToast.error(`Leave at least ${formatAmount(DUST_BNB, 18, 3)} ${getConstant(chainId, \"nativeTokenSymbol\")} for gas`);\n      return;\n    }\n\n    if (!isMarketOrder) {\n      minOut = toAmount;\n      Api.createSwapOrder(chainId, library, path, fromAmount, minOut, triggerRatio, nativeTokenAddress, {\n        sentMsg: \"Swap Order submitted!\",\n        successMsg: \"Swap Order created!\",\n        failMsg: \"Swap Order creation failed.\",\n        pendingTxns,\n        setPendingTxns\n      }).then(() => {\n        trackTrade(3, \"Swap\");\n        setIsConfirming(false);\n      }).finally(() => {\n        setIsSubmitting(false);\n        setIsPendingConfirmation(false);\n      });\n      return;\n    }\n\n    path = replaceNativeTokenAddress(path, nativeTokenAddress);\n    method = \"swap\";\n    value = bigNumberify(0);\n\n    if (toTokenAddress === AddressZero) {\n      method = \"swapTokensToETH\";\n    }\n\n    minOut = toAmount.mul(BASIS_POINTS_DIVISOR - allowedSlippage).div(BASIS_POINTS_DIVISOR);\n    params = [path, fromAmount, minOut, account];\n\n    if (fromTokenAddress === AddressZero) {\n      method = \"swapETHToTokens\";\n      value = fromAmount;\n      params = [path, minOut, account];\n    }\n\n    contract = new ethers.Contract(routerAddress, Router.abi, library.getSigner());\n    Api.callContract(chainId, contract, method, params, {\n      value,\n      sentMsg: `Swap ${!isMarketOrder ? \" order \" : \"\"} submitted!`,\n      successMsg: `Swapped ${formatAmount(fromAmount, fromToken.decimals, 4, true)} ${fromToken.symbol} for ${formatAmount(toAmount, toToken.decimals, 4, true)} ${toToken.symbol}!`,\n      failMsg: \"Swap failed.\",\n      setPendingTxns\n    }).then(async () => {\n      trackTrade(3, \"Swap\");\n      setIsConfirming(false);\n    }).finally(() => {\n      setIsSubmitting(false);\n      setIsPendingConfirmation(false);\n    });\n  };\n\n  const createIncreaseOrder = () => {\n    let path = [fromTokenAddress];\n\n    if (path[0] === USDG_ADDRESS) {\n      if (isLong) {\n        const stableToken = getMostAbundantStableToken(chainId, infoTokens);\n        path.push(stableToken.address);\n      } else {\n        path.push(shortCollateralAddress);\n      }\n    }\n\n    const minOut = 0;\n    const indexToken = getToken(chainId, indexTokenAddress);\n    const successMsg = `\n      Created limit order for ${indexToken.symbol} ${isLong ? \"Long\" : \"Short\"}: ${formatAmount(toUsdMax, USD_DECIMALS, 2)} USD!\n    `;\n    return Api.createIncreaseOrder(chainId, library, nativeTokenAddress, path, fromAmount, indexTokenAddress, minOut, toUsdMax, collateralTokenAddress, isLong, triggerPriceUsd, {\n      pendingTxns,\n      setPendingTxns,\n      sentMsg: \"Limit order submitted!\",\n      successMsg,\n      failMsg: \"Limit order creation failed.\"\n    }).then(() => {\n      trackTrade(3, \"Limit\");\n      setIsConfirming(false);\n    }).finally(() => {\n      setIsSubmitting(false);\n      setIsPendingConfirmation(false);\n    });\n  };\n\n  let referralCode = ethers.constants.HashZero;\n\n  if (isHashZero(userReferralCode) && userReferralCodeInLocalStorage) {\n    referralCode = userReferralCodeInLocalStorage;\n  }\n\n  const increasePosition = async () => {\n    setIsSubmitting(true);\n    const tokenAddress0 = fromTokenAddress === AddressZero ? nativeTokenAddress : fromTokenAddress;\n    const indexTokenAddress = toTokenAddress === AddressZero ? nativeTokenAddress : toTokenAddress;\n    let path = [indexTokenAddress]; // assume long\n\n    if (toTokenAddress !== fromTokenAddress) {\n      path = [tokenAddress0, indexTokenAddress];\n    }\n\n    if (fromTokenAddress === AddressZero && toTokenAddress === nativeTokenAddress) {\n      path = [nativeTokenAddress];\n    }\n\n    if (fromTokenAddress === nativeTokenAddress && toTokenAddress === AddressZero) {\n      path = [nativeTokenAddress];\n    }\n\n    if (isShort) {\n      path = [shortCollateralAddress];\n\n      if (tokenAddress0 !== shortCollateralAddress) {\n        path = [tokenAddress0, shortCollateralAddress];\n      }\n    }\n\n    const refPrice = isLong ? toTokenInfo.maxPrice : toTokenInfo.minPrice;\n    const priceBasisPoints = isLong ? BASIS_POINTS_DIVISOR + allowedSlippage : BASIS_POINTS_DIVISOR - allowedSlippage;\n    const priceLimit = refPrice.mul(priceBasisPoints).div(BASIS_POINTS_DIVISOR);\n    const boundedFromAmount = fromAmount ? fromAmount : bigNumberify(0);\n\n    if (fromAmount && fromAmount.gt(0) && fromTokenAddress === USDG_ADDRESS && isLong) {\n      const {\n        amount: nextToAmount,\n        path: multiPath\n      } = getNextToAmount(chainId, fromAmount, fromTokenAddress, indexTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n\n      if (nextToAmount.eq(0)) {\n        helperToast.error(\"Insufficient liquidity\");\n        return;\n      }\n\n      if (multiPath) {\n        path = replaceNativeTokenAddress(multiPath);\n      }\n    }\n\n    let params = [path, // _path\n    indexTokenAddress, // _indexToken\n    boundedFromAmount, // _amountIn\n    0, // _minOut\n    toUsdMax, // _sizeDelta\n    isLong, // _isLong\n    priceLimit, // _acceptablePrice\n    minExecutionFee, // _executionFee\n    referralCode // _referralCode\n    ];\n    let method = \"createIncreasePosition\";\n    let value = minExecutionFee;\n\n    if (fromTokenAddress === AddressZero) {\n      method = \"createIncreasePositionETH\";\n      value = boundedFromAmount.add(minExecutionFee);\n      params = [path, // _path\n      indexTokenAddress, // _indexToken\n      0, // _minOut\n      toUsdMax, // _sizeDelta\n      isLong, // _isLong\n      priceLimit, // _acceptablePrice\n      minExecutionFee, // _executionFee\n      referralCode // _referralCode\n      ];\n    }\n\n    if (shouldRaiseGasError(getTokenInfo(infoTokens, fromTokenAddress), fromAmount)) {\n      setIsSubmitting(false);\n      setIsPendingConfirmation(false);\n      helperToast.error(`Leave at least ${formatAmount(DUST_BNB, 18, 3)} ${getConstant(chainId, \"nativeTokenSymbol\")} for gas`);\n      return;\n    }\n\n    const contractAddress = getContract(chainId, \"PositionRouter\");\n    const contract = new ethers.Contract(contractAddress, PositionRouter.abi, library.getSigner());\n    const indexToken = getTokenInfo(infoTokens, indexTokenAddress);\n    const tokenSymbol = indexToken.isWrapped ? getConstant(chainId, \"nativeTokenSymbol\") : indexToken.symbol;\n    const successMsg = `Requested increase of ${tokenSymbol} ${isLong ? \"Long\" : \"Short\"} by ${formatAmount(toUsdMax, USD_DECIMALS, 2)} USD.`;\n    Api.callContract(chainId, contract, method, params, {\n      value,\n      setPendingTxns,\n      sentMsg: `${isLong ? \"Long\" : \"Short\"} submitted.`,\n      failMsg: `${isLong ? \"Long\" : \"Short\"} failed.`,\n      successMsg\n    }).then(async () => {\n      trackTrade(3, `${isLong ? \"Long\" : \"Short\"}`);\n      setIsConfirming(false);\n      const key = getPositionKey(account, path[path.length - 1], indexTokenAddress, isLong);\n      let nextSize = toUsdMax;\n\n      if (hasExistingPosition) {\n        nextSize = existingPosition.size.add(toUsdMax);\n      }\n\n      pendingPositions[key] = {\n        updatedAt: Date.now(),\n        pendingChanges: {\n          size: nextSize\n        }\n      };\n      setPendingPositions({ ...pendingPositions\n      });\n    }).finally(() => {\n      setIsSubmitting(false);\n      setIsPendingConfirmation(false);\n    });\n  };\n\n  const onSwapOptionChange = opt => {\n    setSwapOption(opt);\n    setAnchorOnFromAmount(true);\n    setFromValue(\"\");\n    setToValue(\"\");\n    setTriggerPriceValue(\"\");\n    setTriggerRatioValue(\"\");\n\n    if (opt === SHORT && infoTokens) {\n      const fromToken = getToken(chainId, tokenSelection[opt].from);\n\n      if (fromToken && fromToken.isStable) {\n        setShortCollateralAddress(fromToken.address);\n      } else {\n        const stableToken = getMostAbundantStableToken(chainId, infoTokens);\n        setShortCollateralAddress(stableToken.address);\n      }\n    }\n\n    trackAction && trackAction(\"Swap option changed\", {\n      option: opt\n    });\n  };\n\n  const onConfirmationClick = () => {\n    if (!active) {\n      props.connectWallet();\n      return;\n    }\n\n    if (needOrderBookApproval) {\n      approveOrderBook();\n      return;\n    }\n\n    setIsPendingConfirmation(true);\n\n    if (isSwap) {\n      swap();\n      return;\n    }\n\n    if (orderOption === LIMIT) {\n      createIncreaseOrder();\n      return;\n    }\n\n    increasePosition();\n  };\n\n  function approveFromToken() {\n    approveTokens({\n      setIsApproving,\n      library,\n      tokenAddress: fromToken.address,\n      spender: routerAddress,\n      chainId: chainId,\n      onApproveSubmitted: () => {\n        setIsWaitingForApproval(true);\n      },\n      infoTokens,\n      getTokenInfo,\n      pendingTxns,\n      setPendingTxns\n    });\n  }\n\n  const onClickPrimary = () => {\n    if (!active) {\n      props.connectWallet();\n      return;\n    }\n\n    if (needPositionRouterApproval) {\n      approvePositionRouter({\n        sentMsg: \"Enable leverage sent.\",\n        failMsg: \"Enable leverage failed.\"\n      });\n      return;\n    }\n\n    if (needApproval) {\n      approveFromToken();\n      return;\n    }\n\n    if (needOrderBookApproval) {\n      setOrdersToaOpen(true);\n      return;\n    }\n\n    const [, modal, errorCode] = getError();\n\n    if (modal) {\n      setModalError(errorCode);\n      return;\n    }\n\n    if (isSwap) {\n      if (fromTokenAddress === AddressZero && toTokenAddress === nativeTokenAddress) {\n        wrap();\n        return;\n      }\n\n      if (fromTokenAddress === nativeTokenAddress && toTokenAddress === AddressZero) {\n        unwrap();\n        return;\n      }\n    }\n\n    setIsConfirming(true);\n    setIsHigherSlippageAllowed(false);\n  };\n\n  const showFromAndToSection = orderOption !== STOP;\n  const showSizeSection = orderOption === STOP;\n  const showTriggerPriceSection = !isSwap && !isMarketOrder;\n  const showTriggerRatioSection = isSwap && !isMarketOrder;\n  let fees;\n  let feesUsd;\n  let feeBps;\n  let swapFees;\n  let positionFee;\n\n  if (isSwap) {\n    if (fromAmount) {\n      const {\n        feeBasisPoints\n      } = getNextToAmount(chainId, fromAmount, fromTokenAddress, toTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n\n      if (feeBasisPoints !== undefined) {\n        fees = fromAmount.mul(feeBasisPoints).div(BASIS_POINTS_DIVISOR);\n        const feeTokenPrice = fromTokenInfo.address === USDG_ADDRESS ? expandDecimals(1, USD_DECIMALS) : fromTokenInfo.maxPrice;\n        feesUsd = fees.mul(feeTokenPrice).div(expandDecimals(1, fromTokenInfo.decimals));\n      }\n\n      feeBps = feeBasisPoints;\n    }\n  } else if (toUsdMax) {\n    positionFee = toUsdMax.mul(MARGIN_FEE_BASIS_POINTS).div(BASIS_POINTS_DIVISOR);\n    feesUsd = positionFee;\n    const {\n      feeBasisPoints\n    } = getNextToAmount(chainId, fromAmount, fromTokenAddress, collateralTokenAddress, infoTokens, undefined, undefined, usdgSupply, totalTokenWeights);\n\n    if (feeBasisPoints) {\n      swapFees = fromUsdMin.mul(feeBasisPoints).div(BASIS_POINTS_DIVISOR);\n      feesUsd = feesUsd.add(swapFees);\n    }\n\n    feeBps = feeBasisPoints;\n  }\n\n  if (!fromToken || !toToken) {\n    return null;\n  }\n\n  let hasZeroBorrowFee = false;\n  let borrowFeeText;\n\n  if (isLong && toTokenInfo && toTokenInfo.fundingRate) {\n    borrowFeeText = formatAmount(toTokenInfo.fundingRate, 4, 4) + \"% / 1h\";\n\n    if (toTokenInfo.fundingRate.eq(0)) {// hasZeroBorrowFee = true\n    }\n  }\n\n  if (isShort && shortCollateralToken && shortCollateralToken.fundingRate) {\n    borrowFeeText = formatAmount(shortCollateralToken.fundingRate, 4, 4) + \"% / 1h\";\n\n    if (shortCollateralToken.fundingRate.eq(0)) {// hasZeroBorrowFee = true\n    }\n  }\n\n  function setFromValueToMaximumAvailable() {\n    if (!fromToken || !fromBalance) {\n      return;\n    }\n\n    const maxAvailableAmount = fromToken.isNative ? fromBalance.sub(bigNumberify(DUST_BNB).mul(2)) : fromBalance;\n    setFromValue(formatAmountFree(maxAvailableAmount, fromToken.decimals, fromToken.decimals));\n    setAnchorOnFromAmount(true);\n  }\n\n  function shouldShowMaxButton() {\n    if (!fromToken || !fromBalance) {\n      return false;\n    }\n\n    const maxAvailableAmount = fromToken.isNative ? fromBalance.sub(bigNumberify(DUST_BNB).mul(2)) : fromBalance;\n    return fromValue !== formatAmountFree(maxAvailableAmount, fromToken.decimals, fromToken.decimals);\n  }\n\n  const determineLiquidationPrice = () => {\n    switch (true) {\n      case !!existingLiquidationPrice:\n        return formatAmount(existingLiquidationPrice, USD_DECIMALS, 2, false);\n\n      case !!displayLiquidationPrice:\n        return formatAmount(displayLiquidationPrice, USD_DECIMALS, 2, false);\n\n      default:\n        return 0;\n    }\n  };\n\n  const determineBorrowFee = () => {\n    let borrowFee = 0;\n\n    switch (true) {\n      case isLong && toTokenInfo:\n        borrowFee = parseFloat(formatAmount(toTokenInfo.fundingRate, 4, 4));\n        break;\n\n      case isShort && shortCollateralToken:\n        borrowFee = parseFloat(formatAmount(shortCollateralToken.fundingRate, 4, 4));\n        break;\n\n      default:\n        borrowFee = 0;\n        break;\n    }\n\n    if (isLong && toTokenInfo && toTokenInfo.fundingRate || isShort && shortCollateralToken && shortCollateralToken.fundingRate) {\n      return `${borrowFee}% / 1h`;\n    } else {\n      return borrowFee;\n    }\n  };\n\n  const trackTrade = (stage, tradeType) => {\n    let stageName = \"\";\n\n    switch (stage) {\n      case 1:\n        stageName = \"Approve\";\n        break;\n\n      case 2:\n        stageName = \"Pre-confirmation\";\n        break;\n\n      case 3:\n        stageName = \"Post-confirmation\";\n        break;\n\n      default:\n        stageName = \"Approve\";\n        break;\n    }\n\n    const actionName = `${stageName}`;\n\n    try {\n      const fromToken = getToken(chainId, fromTokenAddress);\n      const toToken = getToken(chainId, toTokenAddress);\n      const leverage = (isLong || isShort) && hasLeverageOption && parseFloat(leverageOption).toFixed(2);\n      const market = swapOption !== \"Swap\" ? `${toToken.symbol}/USD` : \"No market - swap\"; //No market for Swap\n\n      const collateralAfterFees = feesUsd ? fromUsdMin.sub(feesUsd) : 0; //No collateral for Swap\n\n      const spread = getSpread(fromTokenInfo, toTokenInfo, isLong, nativeTokenAddress);\n      const entryPrice = isLong || isShort ? formatAmount(entryMarkPrice, USD_DECIMALS, 2, false) : \"No entry price - swap\";\n      let liqPrice = parseFloat(determineLiquidationPrice());\n      liqPrice = liqPrice < 0 ? 0 : liqPrice; // Format user ERC20 token balances from BigNumber to float\n\n      const [userBalances, tokenPrices, poolBalances] = getUserTokenBalances(infoTokens);\n      const traits = {\n        actionType: \"Create\",\n        transactionType: \"Buy\",\n        tradeType: tradeType,\n        position: swapOption,\n        market: market,\n        tokenToPay: fromToken.symbol,\n        tokenToReceive: toToken.symbol,\n        amountToPay: parseFloat(fromValue),\n        amountToReceive: parseFloat(toValue),\n        fromCurrencyBalance: parseFloat(formatAmount(fromBalance, fromToken.decimals, 4, false)),\n        fromCurrencyToken: fromToken.symbol,\n        leverage: parseFloat(leverage),\n        feesUsd: parseFloat(formatAmount(feesUsd, 4, 4, false)),\n        feesUsdFormatted: parseFloat(formatAmount(feesUsd, 4, 4, false).toFixed(2)),\n        [`fees${fromToken.symbol}`]: parseFloat(formatAmount(fees, fromToken.decimals, 4, false)),\n        walletAddress: account,\n        network: NETWORK_NAME[chainId],\n        profitsIn: toToken.symbol,\n        liqPrice: liqPrice,\n        collateralUsd: `${parseFloat(formatAmount(collateralAfterFees, USD_DECIMALS, 2, false))}`,\n        spreadIsHigh: spread.isHigh,\n        spreadValue: parseFloat(formatAmount(spread.value, 4, 4, true)),\n        entryPrice: parseFloat(entryPrice),\n        borrowFee: determineBorrowFee(),\n        allowedSlippage: parseFloat(formatAmount(allowedSlippage, 2, 2)),\n        upToOnePercentSlippageEnabled: isHigherSlippageAllowed,\n        ...userBalances,\n        ...tokenPrices,\n        ...poolBalances\n      };\n      trackAction && trackAction(actionName, traits);\n    } catch (err) {\n      console.error(`Unable to track ${actionName} event`, err);\n    }\n  };\n\n  const preventStrangeNumberInputs = e => {\n    if ([\"e\", \"E\", \"+\", \"-\"].includes(e.key)) {\n      e.preventDefault();\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Exchange-swap-box\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Exchange-swap-box-inner App-box-highlight\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(Tab, {\n          icons: SWAP_ICONS,\n          options: SWAP_OPTIONS,\n          option: swapOption,\n          onChange: onSwapOptionChange,\n          className: \"Exchange-swap-option-tabs\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1856,\n          columnNumber: 11\n        }, this), flagOrdersEnabled && /*#__PURE__*/_jsxDEV(Tab, {\n          options: orderOptions,\n          className: \"Exchange-swap-order-type-tabs\",\n          type: \"inline\",\n          option: orderOption,\n          onChange: onOrderOptionChange,\n          newItem: LIMIT\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1864,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1855,\n        columnNumber: 9\n      }, this), showFromAndToSection && /*#__PURE__*/_jsxDEV(React.Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-section-top\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"muted\",\n              children: [fromUsdMin && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-swap-usd\",\n                children: [\"Pay: \", formatAmount(fromUsdMin, USD_DECIMALS, 2, true), \" USD\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1880,\n                columnNumber: 21\n              }, this), !fromUsdMin && \"Pay\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1878,\n              columnNumber: 17\n            }, this), fromBalance && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"muted align-right clickable\",\n              onClick: setFromValueToMaximumAvailable,\n              children: [\"Balance: \", formatAmount(fromBalance, fromToken.decimals, 4, true)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1885,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1877,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-section-bottom\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-swap-input-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"number\",\n                min: \"0\",\n                placeholder: \"0.0\",\n                className: \"Exchange-swap-input\",\n                value: fromValue,\n                onChange: onFromValueChange,\n                onKeyDown: preventStrangeNumberInputs\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1892,\n                columnNumber: 19\n              }, this), shouldShowMaxButton() && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-swap-max\",\n                onClick: () => {\n                  setFromValueToMaximumAvailable();\n                  trackAction && trackAction(\"Button clicked\", {\n                    buttonName: \"Max amount\"\n                  });\n                },\n                children: \"MAX\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1902,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1891,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(TokenSelector, {\n                label: \"Pay\",\n                chainId: chainId,\n                tokenAddress: fromTokenAddress,\n                onSelectToken: onSelectFromToken,\n                tokens: fromTokens,\n                infoTokens: infoTokens,\n                showMintingCap: false,\n                showTokenImgInDropdown: true,\n                trackAction: trackAction\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1917,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1916,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1890,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1876,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-ball-container\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-ball\",\n            onClick: switchTokens,\n            children: /*#__PURE__*/_jsxDEV(IoMdSwap, {\n              className: \"Exchange-swap-ball-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1933,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1932,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1931,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-section-top\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"muted\",\n              children: [toUsdMax && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Exchange-swap-usd\",\n                children: [getToLabel(), \": \", formatAmount(toUsdMax, USD_DECIMALS, 2, true), \" USD\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1940,\n                columnNumber: 21\n              }, this), !toUsdMax && getToLabel()]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1938,\n              columnNumber: 17\n            }, this), toBalance && isSwap && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"muted align-right\",\n              children: [\"Balance: \", formatAmount(toBalance, toToken.decimals, 4, true)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1947,\n              columnNumber: 19\n            }, this), (isLong || isShort) && hasLeverageOption && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"muted align-right\",\n              children: [\"Leverage: \", parseFloat(leverageOption).toFixed(2), \"x\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1950,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1937,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-section-bottom\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"number\",\n                min: \"0\",\n                placeholder: \"0.0\",\n                className: \"Exchange-swap-input\",\n                value: toValue,\n                onChange: onToValueChange,\n                onKeyDown: preventStrangeNumberInputs\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1955,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1954,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(TokenSelector, {\n                label: getTokenLabel(),\n                chainId: chainId,\n                tokenAddress: toTokenAddress,\n                onSelectToken: onSelectToToken,\n                tokens: toTokens,\n                infoTokens: infoTokens,\n                showTokenImgInDropdown: true,\n                trackAction: trackAction\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1966,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1965,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1953,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1936,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1875,\n        columnNumber: 11\n      }, this), showSizeSection && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-swap-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-section-top\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"muted\",\n            children: \"Sell, USD\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1984,\n            columnNumber: 15\n          }, this), existingPosition && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"muted align-right clickable\",\n            onClick: () => {\n              setSellValue(formatAmountFree(existingPosition.size, USD_DECIMALS, 2));\n            },\n            children: [\"Position: \", formatAmount(existingPosition.size, USD_DECIMALS, 2, true)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1986,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1983,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-section-bottom\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-input-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: \"0\",\n              placeholder: \"0.0\",\n              className: \"Exchange-swap-input\",\n              value: sellValue,\n              onChange: onSellChange,\n              onKeyDown: preventStrangeNumberInputs\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1998,\n              columnNumber: 17\n            }, this), existingPosition && sellValue !== formatAmountFree(existingPosition.size, USD_DECIMALS, 2) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"Exchange-swap-max\",\n              onClick: () => {\n                setSellValue(formatAmountFree(existingPosition.size, USD_DECIMALS, 2));\n              },\n              children: \"MAX\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2008,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1997,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(TokenSelector, {\n              label: \"To\",\n              chainId: chainId,\n              tokenAddress: toTokenAddress,\n              onSelectToken: onSelectToToken,\n              tokens: toTokens,\n              infoTokens: infoTokens,\n              trackAction: trackAction\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2019,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2018,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1996,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1982,\n        columnNumber: 11\n      }, this), showTriggerRatioSection && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-swap-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-section-top\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"muted\",\n            children: \"Price\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2035,\n            columnNumber: 15\n          }, this), fromTokenInfo && toTokenInfo && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"muted align-right clickable\",\n            onClick: () => {\n              setTriggerRatioValue(formatAmountFree(getExchangeRate(fromTokenInfo, toTokenInfo, triggerRatioInverted), USD_DECIMALS, 10));\n            },\n            children: formatAmount(getExchangeRate(fromTokenInfo, toTokenInfo, triggerRatioInverted), USD_DECIMALS, 4)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2037,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2034,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-section-bottom\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-input-container\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: \"0\",\n              placeholder: \"0.0\",\n              className: \"Exchange-swap-input small\",\n              value: triggerRatioValue,\n              onChange: onTriggerRatioChange,\n              onKeyDown: preventStrangeNumberInputs\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2055,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2054,\n            columnNumber: 15\n          }, this), (() => {\n            if (!toTokenInfo) return;\n            if (!fromTokenInfo) return;\n            const [tokenA, tokenB] = triggerRatioInverted ? [toTokenInfo, fromTokenInfo] : [fromTokenInfo, toTokenInfo];\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"PositionEditor-token-symbol\",\n              children: [tokenA.symbol, \"\\xA0per\\xA0\", tokenB.symbol]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2072,\n              columnNumber: 19\n            }, this);\n          })()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2053,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2033,\n        columnNumber: 11\n      }, this), showTriggerPriceSection && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-swap-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-section-top\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"muted\",\n            children: \"Price\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2083,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"muted align-right clickable\",\n            onClick: () => {\n              setTriggerPriceValue(formatAmountFree(entryMarkPrice, USD_DECIMALS, 2));\n            },\n            children: [\"Mark: \", formatAmount(entryMarkPrice, USD_DECIMALS, 2, true)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2084,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2082,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-swap-section-bottom\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-swap-input-container\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: \"0\",\n              placeholder: \"0.0\",\n              className: \"Exchange-swap-input\",\n              value: triggerPriceValue,\n              onChange: onTriggerPriceChange,\n              onKeyDown: preventStrangeNumberInputs\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2095,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2094,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"PositionEditor-token-symbol\",\n            children: \"USD\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2105,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2093,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2081,\n        columnNumber: 11\n      }, this), isSwap && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-swap-box-info\",\n        children: /*#__PURE__*/_jsxDEV(ExchangeInfoRow, {\n          label: \"Fees\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [!fees && \"-\", fees && /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [formatAmount(feeBps, 2, 2, false), \"%\\xA0 (\", formatAmount(fees, fromToken.decimals, 4, true), \" \", fromToken.symbol, \": $\", formatAmount(feesUsd, USD_DECIMALS, 2, true), \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2115,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2112,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2111,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2110,\n        columnNumber: 11\n      }, this), (isLong || isShort) && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-leverage-box\",\n        children: [/*#__PURE__*/_jsxDEV(LeverageInput, {\n          value: leverageOption,\n          onChange: setLeverageOption,\n          max: 30.5,\n          min: 1.1,\n          step: 0.01\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2126,\n          columnNumber: 13\n        }, this), isShort && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-info-label\",\n            children: \"Profits In\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2129,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"align-right\",\n            children: /*#__PURE__*/_jsxDEV(TokenSelector, {\n              label: \"Profits In\",\n              chainId: chainId,\n              tokenAddress: shortCollateralAddress,\n              onSelectToken: onSelectShortCollateralAddress,\n              tokens: stableTokens,\n              showTokenImgInDropdown: true,\n              trackAction: trackAction\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2131,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2130,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2128,\n          columnNumber: 15\n        }, this), isLong && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-info-label\",\n            children: \"Profits In\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2145,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"align-right strong\",\n            children: toToken.symbol\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2146,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2144,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-info-label\",\n            children: \"Leverage\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2150,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"align-right\",\n            children: [hasExistingPosition && toAmount && toAmount.gt(0) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"inline-block muted\",\n              children: [formatAmount(existingPosition.leverage, 4, 2), \"x\", /*#__PURE__*/_jsxDEV(BsArrowRight, {\n                className: \"transition-arrow\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2155,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2153,\n              columnNumber: 19\n            }, this), toAmount && leverage && leverage.gt(0) && `${formatAmount(leverage, 4, 2)}x`, !toAmount && leverage && leverage.gt(0) && `-`, leverage && leverage.eq(0) && `-`]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2151,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2149,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-info-label\",\n            children: \"Entry Price\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2164,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"align-right\",\n            children: [hasExistingPosition && toAmount && toAmount.gt(0) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"inline-block muted\",\n              children: [\"$\", formatAmount(existingPosition.averagePrice, USD_DECIMALS, 2, true), /*#__PURE__*/_jsxDEV(BsArrowRight, {\n                className: \"transition-arrow\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2169,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2167,\n              columnNumber: 19\n            }, this), nextAveragePrice && `$${formatAmount(nextAveragePrice, USD_DECIMALS, 2, true)}`, !nextAveragePrice && `-`]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2165,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2163,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Exchange-info-label\",\n            children: \"Liq. Price\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2177,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"align-right\",\n            children: [hasExistingPosition && toAmount && toAmount.gt(0) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"inline-block muted\",\n              children: [\"$\", formatAmount(existingLiquidationPrice, USD_DECIMALS, 2, true), /*#__PURE__*/_jsxDEV(BsArrowRight, {\n                className: \"transition-arrow\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2182,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2180,\n              columnNumber: 19\n            }, this), toAmount && displayLiquidationPrice && `$${formatAmount(displayLiquidationPrice, USD_DECIMALS, 2, true)}`, !toAmount && displayLiquidationPrice && `-`, !displayLiquidationPrice && `-`]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2178,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2176,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(ExchangeInfoRow, {\n          label: \"Fees\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [!feesUsd && \"-\", feesUsd && /*#__PURE__*/_jsxDEV(Tooltip, {\n              handle: `$${formatAmount(feesUsd, USD_DECIMALS, 2, true)}`,\n              position: \"right-bottom\",\n              renderContent: () => {\n                return /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [swapFees && /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: [collateralToken.symbol, \" is required for collateral. \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2204,\n                      columnNumber: 84\n                    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2205,\n                      columnNumber: 31\n                    }, this), \"Swap \", fromToken.symbol, \" to \", collateralToken.symbol, \" Fee: $\", formatAmount(swapFees, USD_DECIMALS, 2, true), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2208,\n                      columnNumber: 31\n                    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2209,\n                      columnNumber: 31\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2203,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: [\"Position Fee (\", MARGIN_FEE_BASIS_POINTS / 100, \"% of position size): $\", formatAmount(positionFee, USD_DECIMALS, 2, true)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2212,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2196,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2193,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2192,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2125,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-swap-button-container\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"App-cta Exchange-swap-button\",\n          onClick: () => {\n            const buttonText = getPrimaryText();\n            onClickPrimary();\n\n            if (buttonText.includes(\"Approve\")) {\n              trackTrade(1, fromToken === null || fromToken === void 0 ? void 0 : fromToken.symbol);\n              trackAction && trackAction(\"Button clicked\", {\n                buttonName: \"Approve\",\n                fromToken: fromToken === null || fromToken === void 0 ? void 0 : fromToken.symbol\n              });\n            } else {\n              trackAction && trackAction(\"Button clicked\", {\n                buttonName: buttonText\n              });\n            }\n          },\n          disabled: !isPrimaryEnabled(),\n          children: getPrimaryText()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2226,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2225,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1854,\n      columnNumber: 7\n    }, this), isSwap && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Exchange-swap-market-box App-box App-box-border\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-swap-market-box-title\",\n        children: \"Swap\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2253,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App-card-divider\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2254,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-info-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-label\",\n          children: [fromToken.symbol, \" Price\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2256,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"align-right\",\n          children: [fromTokenInfo && formatAmount(fromTokenInfo.minPrice, USD_DECIMALS, 2, true), \" USD\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2257,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2255,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-info-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-label\",\n          children: [toToken.symbol, \" Price\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2262,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"align-right\",\n          children: [toTokenInfo && formatAmount(toTokenInfo.maxPrice, USD_DECIMALS, 2, true), \" USD\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2263,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2261,\n        columnNumber: 11\n      }, this), !isMarketOrder && /*#__PURE__*/_jsxDEV(ExchangeInfoRow, {\n        label: \"Price\",\n        children: getExchangeRateDisplay(getExchangeRate(fromTokenInfo, toTokenInfo), fromToken, toToken)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2268,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2252,\n      columnNumber: 9\n    }, this), (isLong || isShort) && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Exchange-swap-market-box App-box App-box-border\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-swap-market-box-title\",\n        children: [isLong ? \"Long\" : \"Short\", \"\\xA0\", toToken.symbol]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2276,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App-card-divider\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2279,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-info-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-label\",\n          children: \"Entry Price\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2281,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"align-right\",\n          children: /*#__PURE__*/_jsxDEV(Tooltip, {\n            handle: `${formatAmount(entryMarkPrice, USD_DECIMALS, 2, true)} USD`,\n            position: \"right-bottom\",\n            renderContent: () => {\n              return /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [\"The position will be opened at \", formatAmount(entryMarkPrice, USD_DECIMALS, 2, true), \" USD with a max slippage of \", parseFloat(savedSlippageAmount / 100.0).toFixed(2), \"%.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2291,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2292,\n                  columnNumber: 23\n                }, this), \"The slippage amount can be configured under Settings, found by clicking on your address at the top right of the page after connecting your wallet.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2295,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2296,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: \"https://swaps.docs.mycelium.xyz/quick-start-guide/2.-how-to-trade\",\n                  target: \"_blank\",\n                  rel: \"noopener noreferrer\",\n                  children: \"More Info\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2297,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2283,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2282,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2280,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-info-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-label\",\n          children: \"Exit Price\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2311,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"align-right\",\n          children: /*#__PURE__*/_jsxDEV(Tooltip, {\n            handle: `${formatAmount(exitMarkPrice, USD_DECIMALS, 2, true)} USD`,\n            position: \"right-bottom\",\n            renderContent: () => {\n              return /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [\"If you have an existing position, the position will be closed at\", \" \", formatAmount(exitMarkPrice, USD_DECIMALS, 2, true), \" USD.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2321,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2322,\n                  columnNumber: 23\n                }, this), \"This exit price will change with the price of the asset.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2324,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2325,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: \"https://swaps.docs.mycelium.xyz/quick-start-guide/2.-how-to-trade\",\n                  target: \"_blank\",\n                  rel: \"noopener noreferrer\",\n                  children: \"More Info\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2326,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2313,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2312,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2310,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-info-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-label\",\n          children: \"Borrow Fee\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2340,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"align-right\",\n          children: /*#__PURE__*/_jsxDEV(Tooltip, {\n            handle: borrowFeeText,\n            position: \"right-bottom\",\n            renderContent: () => {\n              return /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [hasZeroBorrowFee && /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [isLong && \"There are more shorts than longs, borrow fees for longing is currently zero\", isShort && \"There are more longs than shorts, borrow fees for shorting is currently zero\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2349,\n                  columnNumber: 25\n                }, this), !hasZeroBorrowFee && /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [\"The borrow fee is calculated as (assets borrowed) / (total assets in pool) * 0.005% per hour.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2357,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2358,\n                    columnNumber: 27\n                  }, this), isShort && `You can change the \"Profits In\" token above to find lower fees`]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2355,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2362,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: \"https://swaps.docs.mycelium.xyz/protocol-design/trading/fees#borrowing-fees\",\n                  target: \"_blank\",\n                  rel: \"noopener noreferrer\",\n                  children: \"More Info\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2363,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true);\n            },\n            children: !hasZeroBorrowFee && null\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2342,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2341,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2339,\n        columnNumber: 11\n      }, this), renderAvailableLongLiquidity(), hasMaxAvailableShort && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-info-row\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2380,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2275,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Exchange-swap-market-box App-box App-box-border\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-swap-market-box-title\",\n        children: \"Useful Links\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2387,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App-card-divider\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2388,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Exchange-info-row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Exchange-info-label-button\",\n          children: /*#__PURE__*/_jsxDEV(\"a\", {\n            href: \"https://arbitrex.gitbook.io/arbitrex/arbitrex/trading\",\n            target: \"_blank\",\n            rel: \"noopener noreferrer\",\n            children: \"Trading guide\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2391,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2390,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2389,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2386,\n      columnNumber: 7\n    }, this), renderErrorModal(), renderOrdersToa(), isConfirming && /*#__PURE__*/_jsxDEV(ConfirmationBox, {\n      isHigherSlippageAllowed: isHigherSlippageAllowed,\n      setIsHigherSlippageAllowed: setIsHigherSlippageAllowed,\n      orders: orders,\n      isSwap: isSwap,\n      isLong: isLong,\n      isMarketOrder: isMarketOrder,\n      orderOption: orderOption,\n      isShort: isShort,\n      fromToken: fromToken,\n      fromTokenInfo: fromTokenInfo,\n      toToken: toToken,\n      toTokenInfo: toTokenInfo,\n      toAmount: toAmount,\n      fromAmount: fromAmount,\n      feeBps: feeBps,\n      onConfirmationClick: onConfirmationClick,\n      setIsConfirming: setIsConfirming,\n      hasExistingPosition: hasExistingPosition,\n      shortCollateralAddress: shortCollateralAddress,\n      shortCollateralToken: shortCollateralToken,\n      leverage: leverage,\n      existingPosition: existingPosition,\n      existingLiquidationPrice: existingLiquidationPrice,\n      displayLiquidationPrice: displayLiquidationPrice,\n      nextAveragePrice: nextAveragePrice,\n      triggerPriceUsd: triggerPriceUsd,\n      triggerRatio: triggerRatio,\n      fees: fees,\n      feesUsd: feesUsd,\n      isSubmitting: isSubmitting,\n      isPendingConfirmation: isPendingConfirmation,\n      fromUsdMin: fromUsdMin,\n      toUsdMax: toUsdMax,\n      collateralTokenAddress: collateralTokenAddress,\n      infoTokens: infoTokens,\n      chainId: chainId,\n      trackAction: trackAction,\n      trackTrade: trackTrade\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2404,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1849,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SwapBox, \"LjYlu27+CCvXpar0Oozw4aVoULI=\", false, function () {\n  return [useUserReferralCode, useLocalStorageByChainId, useLocalStorageSerializeKey, useLocalStorageSerializeKey, usePrevious, usePrevious, useSWR, useSWR, Api.useHasOutdatedUi, usePrevious, usePrevious, usePrevious];\n});\n\n_c = SwapBox;\n\nvar _c;\n\n$RefreshReg$(_c, \"SwapBox\");","map":{"version":3,"names":["React","useState","useEffect","useMemo","useCallback","Tooltip","Modal","useSWR","ethers","IoMdSwap","BsArrowRight","helperToast","formatAmount","bigNumberify","USD_DECIMALS","USDG_DECIMALS","LONG","SHORT","SWAP","MARKET","SWAP_ORDER_OPTIONS","LEVERAGE_ORDER_OPTIONS","DEFAULT_HIGHER_SLIPPAGE_AMOUNT","getPositionKey","getUsd","BASIS_POINTS_DIVISOR","MARGIN_FEE_BASIS_POINTS","PRECISION","USDG_ADDRESS","STOP","LIMIT","SWAP_OPTIONS","DUST_BNB","isTriggerRatioInverted","usePrevious","formatAmountFree","fetcher","parseValue","expandDecimals","shouldRaiseGasError","getTokenInfo","getLiquidationPrice","approveTokens","getLeverage","isSupportedChain","getExchangeRate","getExchangeRateDisplay","getNextToAmount","getNextFromAmount","getMostAbundantStableToken","useLocalStorageSerializeKey","useLocalStorageByChainId","calculatePositionDelta","replaceNativeTokenAddress","adjustForDecimals","isHashZero","NETWORK_NAME","getSpread","getUserTokenBalances","getConstant","Api","getContract","Tab","TokenSelector","ExchangeInfoRow","ConfirmationBox","OrdersToa","getTokens","getWhitelistedTokens","getToken","getTokenBySymbol","PositionRouter","Router","Token","WETH","useUserReferralCode","LeverageInput","REFERRAL_CODE_KEY","SWAP_ICONS","longImg","shortImg","swapImg","AddressZero","constants","getNextAveragePrice","size","sizeDelta","hasProfit","delta","nextPrice","isLong","nextSize","add","divisor","sub","eq","nextAveragePrice","mul","div","SwapBox","props","pendingPositions","setPendingPositions","infoTokens","active","library","account","fromTokenAddress","setFromTokenAddress","toTokenAddress","setToTokenAddress","swapOption","setSwapOption","positionsMap","pendingTxns","setPendingTxns","tokenSelection","setTokenSelection","setIsConfirming","isConfirming","isPendingConfirmation","setIsPendingConfirmation","flagOrdersEnabled","chainId","nativeTokenAddress","savedSlippageAmount","totalTokenWeights","usdgSupply","orders","savedIsPnlInLeverage","orderBookApproved","positionRouterApproved","isWaitingForPluginApproval","approveOrderBook","approvePositionRouter","setIsWaitingForPluginApproval","isWaitingForPositionRouterApproval","setIsWaitingForPositionRouterApproval","isPluginApproving","isPositionRouterApproving","trackAction","fromValue","setFromValue","toValue","setToValue","anchorOnFromAmount","setAnchorOnFromAmount","isApproving","setIsApproving","isWaitingForApproval","setIsWaitingForApproval","isSubmitting","setIsSubmitting","modalError","setModalError","isHigherSlippageAllowed","setIsHigherSlippageAllowed","userReferralCode","userReferralCodeInLocalStorage","window","localStorage","getItem","allowedSlippage","defaultCollateralSymbol","shortCollateralAddress","setShortCollateralAddress","address","isShort","isSwap","getTokenLabel","leverageOption","setLeverageOption","hasLeverageOption","isNaN","parseFloat","ordersToaOpen","setOrdersToaOpen","orderOption","setOrderOption","onOrderOptionChange","option","sellValue","setSellValue","onSellChange","evt","target","value","isMarketOrder","orderOptions","triggerPriceValue","setTriggerPriceValue","triggerPriceUsd","onTriggerPriceChange","onTriggerRatioChange","setTriggerRatioValue","positionKey","existingPosition","undefined","hasExistingPosition","gt","whitelistedTokens","tokens","fromTokens","stableTokens","filter","token","isStable","indexTokens","isWrapped","shortableTokens","isShortable","toTokens","needOrderBookApproval","prevNeedOrderBookApproval","needPositionRouterApproval","prevNeedPositionRouterApproval","success","routerAddress","tokenAllowanceAddress","data","tokenAllowance","positionRouterAddress","minExecutionFee","hasOutdatedUi","useHasOutdatedUi","fromToken","toToken","shortCollateralToken","fromTokenInfo","toTokenInfo","toTokenAvailableUsd","availableUsd","renderAvailableLongLiquidity","hasMaxAvailableShort","maxAvailableShort","fromBalance","balance","toBalance","fromAmount","decimals","toAmount","isPotentialWrap","isNative","isWrapOrUnwrap","needApproval","prevFromTokenAddress","prevNeedApproval","prevToTokenAddress","fromUsdMin","toUsdMax","indexTokenAddress","collateralTokenAddress","collateralToken","triggerRatioValue","triggerRatioInverted","triggerRatio","ratio","symbol","find","i","length","stableToken","key","position","updateSwapAmounts","amount","nextToAmount","nextToValue","nextFromAmount","nextFromValue","updateLeverageAmounts","maxPrice","leverageMultiplier","parseInt","toTokenPriceUsd","feeBasisPoints","fromUsdMinAfterFee","toNumerator","toDenominator","nextToUsd","minPrice","baseFromAmountUsd","fees","swapFees","nextFromUsd","entryMarkPrice","exitMarkPrice","leverage","nextDelta","nextHasProfit","liquidationPrice","collateral","averagePrice","entryFundingRate","cumulativeFundingRate","collateralDelta","increaseCollateral","increaseSize","existingLiquidationPrice","displayLiquidationPrice","includeDelta","getSwapError","gasTokenInfo","isUsdg","currentRate","lt","availableAmount","bufferAmount","poolAmount","maxUsdgAmount","usdgAmount","usdgFromAmount","nextUsdgAmount","getLeverageError","requiredAmount","swapAmount","sizeUsd","maxGlobalLongSize","maxAvailableLong","stableTokenAmount","sizeTokens","getToLabel","getError","renderOrdersToa","renderErrorModal","inputCurrency","outputCurrency","uniswapUrl","label","swapTokenSymbol","isPrimaryEnabled","error","modal","getPrimaryText","charAt","substring","toLowerCase","indexTokenInfo","nextToAmountUsd","onSelectFromToken","onSelectShortCollateralAddress","onSelectToToken","onFromValueChange","e","onToValueChange","switchTokens","updatedTokenSelection","JSON","parse","stringify","from","to","wrap","contract","Contract","abi","getSigner","callContract","sentMsg","successMsg","failMsg","then","res","finally","unwrap","swap","path","multiPath","method","params","minOut","createSwapOrder","trackTrade","createIncreaseOrder","push","indexToken","referralCode","HashZero","increasePosition","tokenAddress0","refPrice","priceBasisPoints","priceLimit","boundedFromAmount","contractAddress","tokenSymbol","updatedAt","Date","now","pendingChanges","onSwapOptionChange","opt","onConfirmationClick","connectWallet","approveFromToken","tokenAddress","spender","onApproveSubmitted","onClickPrimary","errorCode","showFromAndToSection","showSizeSection","showTriggerPriceSection","showTriggerRatioSection","feesUsd","feeBps","positionFee","feeTokenPrice","hasZeroBorrowFee","borrowFeeText","fundingRate","setFromValueToMaximumAvailable","maxAvailableAmount","shouldShowMaxButton","determineLiquidationPrice","determineBorrowFee","borrowFee","stage","tradeType","stageName","actionName","toFixed","market","collateralAfterFees","spread","entryPrice","liqPrice","userBalances","tokenPrices","poolBalances","traits","actionType","transactionType","tokenToPay","tokenToReceive","amountToPay","amountToReceive","fromCurrencyBalance","fromCurrencyToken","feesUsdFormatted","walletAddress","network","profitsIn","collateralUsd","spreadIsHigh","isHigh","spreadValue","upToOnePercentSlippageEnabled","err","console","preventStrangeNumberInputs","includes","preventDefault","buttonName","tokenA","tokenB","buttonText"],"sources":["C:/Users/rober/Documents/swaps-client/src/components/Exchange/SwapBox.js"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from \"react\";\n\nimport Tooltip from \"../Tooltip/Tooltip\";\nimport Modal from \"../Modal/Modal\";\n\nimport useSWR from \"swr\";\nimport { ethers } from \"ethers\";\n\nimport { IoMdSwap } from \"react-icons/io\";\nimport { BsArrowRight } from \"react-icons/bs\";\n\nimport {\n  helperToast,\n  formatAmount,\n  bigNumberify,\n  USD_DECIMALS,\n  USDG_DECIMALS,\n  LONG,\n  SHORT,\n  SWAP,\n  MARKET,\n  SWAP_ORDER_OPTIONS,\n  LEVERAGE_ORDER_OPTIONS,\n  DEFAULT_HIGHER_SLIPPAGE_AMOUNT,\n  getPositionKey,\n  getUsd,\n  BASIS_POINTS_DIVISOR,\n  MARGIN_FEE_BASIS_POINTS,\n  PRECISION,\n  USDG_ADDRESS,\n  STOP,\n  LIMIT,\n  SWAP_OPTIONS,\n  DUST_BNB,\n  isTriggerRatioInverted,\n  usePrevious,\n  formatAmountFree,\n  fetcher,\n  parseValue,\n  expandDecimals,\n  shouldRaiseGasError,\n  getTokenInfo,\n  getLiquidationPrice,\n  approveTokens,\n  getLeverage,\n  isSupportedChain,\n  getExchangeRate,\n  getExchangeRateDisplay,\n  getNextToAmount,\n  getNextFromAmount,\n  getMostAbundantStableToken,\n  useLocalStorageSerializeKey,\n  useLocalStorageByChainId,\n  calculatePositionDelta,\n  replaceNativeTokenAddress,\n  adjustForDecimals,\n  isHashZero,\n  NETWORK_NAME,\n  getSpread,\n  getUserTokenBalances,\n} from \"../../Helpers\";\nimport { getConstant } from \"../../Constants\";\nimport * as Api from \"../../Api\";\nimport { getContract } from \"../../Addresses\";\n\nimport Tab from \"../Tab/Tab\";\nimport TokenSelector from \"./TokenSelector\";\nimport ExchangeInfoRow from \"./ExchangeInfoRow\";\nimport ConfirmationBox from \"./ConfirmationBox\";\nimport OrdersToa from \"./OrdersToa\";\n\nimport { getTokens, getWhitelistedTokens, getToken, getTokenBySymbol } from \"../../data/Tokens\";\nimport PositionRouter from \"../../abis/PositionRouter.json\";\nimport Router from \"../../abis/Router.json\";\nimport Token from \"../../abis/Token.json\";\nimport WETH from \"../../abis/WETH.json\";\n\nimport longImg from \"../../img/long.svg\";\nimport shortImg from \"../../img/short.svg\";\nimport swapImg from \"../../img/swap.svg\";\nimport { useUserReferralCode } from \"../../Api/referrals\";\nimport { LeverageInput } from \"./LeverageInput\";\nimport { REFERRAL_CODE_KEY } from \"../../config/localstorage\";\n\nconst SWAP_ICONS = {\n  [LONG]: longImg,\n  [SHORT]: shortImg,\n  [SWAP]: swapImg,\n};\nconst { AddressZero } = ethers.constants;\n\nfunction getNextAveragePrice({ size, sizeDelta, hasProfit, delta, nextPrice, isLong }) {\n  if (!size || !sizeDelta || !delta || !nextPrice) {\n    return;\n  }\n  const nextSize = size.add(sizeDelta);\n  let divisor;\n  if (isLong) {\n    divisor = hasProfit ? nextSize.add(delta) : nextSize.sub(delta);\n  } else {\n    divisor = hasProfit ? nextSize.sub(delta) : nextSize.add(delta);\n  }\n  if (!divisor || divisor.eq(0)) {\n    return;\n  }\n  const nextAveragePrice = nextPrice.mul(nextSize).div(divisor);\n  return nextAveragePrice;\n}\n\nexport default function SwapBox(props) {\n  const {\n    pendingPositions,\n    setPendingPositions,\n    infoTokens,\n    active,\n    library,\n    account,\n    fromTokenAddress,\n    setFromTokenAddress,\n    toTokenAddress,\n    setToTokenAddress,\n    swapOption,\n    setSwapOption,\n    positionsMap,\n    pendingTxns,\n    setPendingTxns,\n    tokenSelection,\n    setTokenSelection,\n    setIsConfirming,\n    isConfirming,\n    isPendingConfirmation,\n    setIsPendingConfirmation,\n    flagOrdersEnabled,\n    chainId,\n    nativeTokenAddress,\n    savedSlippageAmount,\n    totalTokenWeights,\n    usdgSupply,\n    orders,\n    savedIsPnlInLeverage,\n    orderBookApproved,\n    positionRouterApproved,\n    isWaitingForPluginApproval,\n    approveOrderBook,\n    approvePositionRouter,\n    setIsWaitingForPluginApproval,\n    isWaitingForPositionRouterApproval,\n    setIsWaitingForPositionRouterApproval,\n    isPluginApproving,\n    isPositionRouterApproving,\n    trackAction,\n  } = props;\n\n  const [fromValue, setFromValue] = useState(\"\");\n  const [toValue, setToValue] = useState(\"\");\n  const [anchorOnFromAmount, setAnchorOnFromAmount] = useState(true);\n  const [isApproving, setIsApproving] = useState(false);\n  const [isWaitingForApproval, setIsWaitingForApproval] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [modalError, setModalError] = useState(false);\n  const [isHigherSlippageAllowed, setIsHigherSlippageAllowed] = useState(false);\n  const { userReferralCode } = useUserReferralCode(library, chainId, account);\n  const userReferralCodeInLocalStorage = window.localStorage.getItem(REFERRAL_CODE_KEY);\n\n  let allowedSlippage = savedSlippageAmount;\n  if (isHigherSlippageAllowed) {\n    allowedSlippage = DEFAULT_HIGHER_SLIPPAGE_AMOUNT;\n  }\n\n  const defaultCollateralSymbol = getConstant(chainId, \"defaultCollateralSymbol\");\n  // TODO hack with useLocalStorageSerializeKey\n  const [shortCollateralAddress, setShortCollateralAddress] = useLocalStorageByChainId(\n    chainId,\n    \"Short-Collateral-Address\",\n    getTokenBySymbol(chainId, defaultCollateralSymbol).address\n  );\n  const isLong = swapOption === LONG;\n  const isShort = swapOption === SHORT;\n  const isSwap = swapOption === SWAP;\n\n  function getTokenLabel() {\n    switch (true) {\n      case isLong:\n        return \"Long\";\n      case isShort:\n        return \"Short\";\n      case isSwap:\n        return \"Receive\";\n      default:\n        return \"\";\n    }\n  }\n  const [leverageOption, setLeverageOption] = useLocalStorageSerializeKey(\n    [chainId, \"Exchange-swap-leverage-option\"],\n    \"2\"\n  );\n\n  const hasLeverageOption = !isNaN(parseFloat(leverageOption));\n\n  const [ordersToaOpen, setOrdersToaOpen] = useState(false);\n\n  let [orderOption, setOrderOption] = useLocalStorageSerializeKey([chainId, \"Order-option\"], MARKET);\n  if (!flagOrdersEnabled) {\n    orderOption = MARKET;\n  }\n\n  const onOrderOptionChange = (option) => {\n    // limits disabled\n    if (typeof option === \"string\") {\n      setOrderOption(option);\n    }\n  };\n\n  const [sellValue, setSellValue] = useState(\"\");\n\n  const onSellChange = (evt) => {\n    setSellValue(evt.target.value || \"\");\n  };\n\n  const isMarketOrder = orderOption === MARKET;\n  const orderOptions = isSwap ? SWAP_ORDER_OPTIONS : LEVERAGE_ORDER_OPTIONS;\n\n  const [triggerPriceValue, setTriggerPriceValue] = useState(\"\");\n  const triggerPriceUsd = isMarketOrder ? 0 : parseValue(triggerPriceValue, USD_DECIMALS);\n\n  const onTriggerPriceChange = (evt) => {\n    setTriggerPriceValue(evt.target.value || \"\");\n  };\n\n  const onTriggerRatioChange = (evt) => {\n    setTriggerRatioValue(evt.target.value || \"\");\n  };\n\n  let positionKey;\n  if (isLong) {\n    positionKey = getPositionKey(account, toTokenAddress, toTokenAddress, true, nativeTokenAddress);\n  }\n  if (isShort) {\n    positionKey = getPositionKey(account, shortCollateralAddress, toTokenAddress, false, nativeTokenAddress);\n  }\n\n  const existingPosition = positionKey ? positionsMap[positionKey] : undefined;\n  const hasExistingPosition = existingPosition && existingPosition.size && existingPosition.size.gt(0);\n\n  const whitelistedTokens = getWhitelistedTokens(chainId);\n  const tokens = getTokens(chainId);\n  const fromTokens = tokens;\n  const stableTokens = tokens.filter((token) => token.isStable);\n  const indexTokens = whitelistedTokens.filter((token) => !token.isStable && !token.isWrapped);\n  const shortableTokens = indexTokens.filter((token) => token.isShortable);\n  let toTokens = tokens;\n  if (isLong) {\n    toTokens = indexTokens;\n  }\n  if (isShort) {\n    toTokens = shortableTokens;\n  }\n\n  const needOrderBookApproval = !isMarketOrder && !orderBookApproved;\n  const prevNeedOrderBookApproval = usePrevious(needOrderBookApproval);\n\n  const needPositionRouterApproval = (isLong || isShort) && isMarketOrder && !positionRouterApproved;\n  const prevNeedPositionRouterApproval = usePrevious(needPositionRouterApproval);\n\n  useEffect(() => {\n    if (!needOrderBookApproval && prevNeedOrderBookApproval && isWaitingForPluginApproval) {\n      setIsWaitingForPluginApproval(false);\n      helperToast.success(<div>Orders enabled!</div>);\n    }\n  }, [needOrderBookApproval, prevNeedOrderBookApproval, setIsWaitingForPluginApproval, isWaitingForPluginApproval]);\n\n  useEffect(() => {\n    if (!needPositionRouterApproval && prevNeedPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      setIsWaitingForPositionRouterApproval(false);\n      helperToast.success(<div>Leverage enabled!</div>);\n    }\n  }, [\n    needPositionRouterApproval,\n    prevNeedPositionRouterApproval,\n    setIsWaitingForPositionRouterApproval,\n    isWaitingForPositionRouterApproval,\n  ]);\n\n  useEffect(() => {\n    if (!needOrderBookApproval && prevNeedOrderBookApproval && isWaitingForPluginApproval) {\n      setIsWaitingForPluginApproval(false);\n      helperToast.success(<div>Orders enabled!</div>);\n    }\n  }, [needOrderBookApproval, prevNeedOrderBookApproval, setIsWaitingForPluginApproval, isWaitingForPluginApproval]);\n\n  const routerAddress = getContract(chainId, \"Router\");\n  const tokenAllowanceAddress = fromTokenAddress === AddressZero ? nativeTokenAddress : fromTokenAddress;\n  const { data: tokenAllowance } = useSWR(\n    active && [active, chainId, tokenAllowanceAddress, \"allowance\", account, routerAddress],\n    {\n      fetcher: fetcher(library, Token),\n    }\n  );\n\n  const positionRouterAddress = getContract(chainId, \"PositionRouter\");\n\n  const { data: minExecutionFee } = useSWR([active, chainId, positionRouterAddress, \"minExecutionFee\"], {\n    fetcher: fetcher(library, PositionRouter),\n  });\n\n  const { data: hasOutdatedUi } = Api.useHasOutdatedUi();\n\n  const fromToken = getToken(chainId, fromTokenAddress);\n  const toToken = getToken(chainId, toTokenAddress);\n  const shortCollateralToken = getTokenInfo(infoTokens, shortCollateralAddress);\n\n  const fromTokenInfo = getTokenInfo(infoTokens, fromTokenAddress);\n  const toTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n  const toTokenAvailableUsd = toTokenInfo.availableUsd;\n\n  const renderAvailableLongLiquidity = () => {\n    if (!isLong) {\n      return null;\n    }\n\n    return (\n      <div className=\"Exchange-info-row\">\n        <div className=\"Exchange-info-label\">Available Liquidity</div>\n        <div className=\"align-right\">{formatAmount(toTokenAvailableUsd, USD_DECIMALS, 2, true)}</div>\n      </div>\n    );\n  };\n\n  const hasMaxAvailableShort = isShort && toTokenInfo.maxAvailableShort && toTokenInfo.maxAvailableShort.gt(0);\n\n  const fromBalance = fromTokenInfo ? fromTokenInfo.balance : bigNumberify(0);\n  const toBalance = toTokenInfo ? toTokenInfo.balance : bigNumberify(0);\n\n  const fromAmount = parseValue(fromValue, fromToken && fromToken.decimals);\n  const toAmount = parseValue(toValue, toToken && toToken.decimals);\n\n  const isPotentialWrap = (fromToken.isNative && toToken.isWrapped) || (fromToken.isWrapped && toToken.isNative);\n  const isWrapOrUnwrap = isSwap && isPotentialWrap;\n  const needApproval =\n    fromTokenAddress !== AddressZero &&\n    tokenAllowance &&\n    fromAmount &&\n    fromAmount.gt(tokenAllowance) &&\n    !isWrapOrUnwrap;\n  const prevFromTokenAddress = usePrevious(fromTokenAddress);\n  const prevNeedApproval = usePrevious(needApproval);\n  const prevToTokenAddress = usePrevious(toTokenAddress);\n\n  const fromUsdMin = getUsd(fromAmount, fromTokenAddress, false, infoTokens);\n  const toUsdMax = getUsd(toAmount, toTokenAddress, true, infoTokens, orderOption, triggerPriceUsd);\n\n  const indexTokenAddress = toTokenAddress === AddressZero ? nativeTokenAddress : toTokenAddress;\n  const collateralTokenAddress = isLong ? indexTokenAddress : shortCollateralAddress;\n  const collateralToken = getToken(chainId, collateralTokenAddress);\n\n  const [triggerRatioValue, setTriggerRatioValue] = useState(\"\");\n\n  const triggerRatioInverted = useMemo(() => {\n    return isTriggerRatioInverted(fromTokenInfo, toTokenInfo);\n  }, [toTokenInfo, fromTokenInfo]);\n\n  const triggerRatio = useMemo(() => {\n    if (!triggerRatioValue) {\n      return bigNumberify(0);\n    }\n    let ratio = parseValue(triggerRatioValue, USD_DECIMALS);\n    if (ratio.eq(0)) {\n      return bigNumberify(0);\n    }\n    if (triggerRatioInverted) {\n      ratio = PRECISION.mul(PRECISION).div(ratio);\n    }\n    return ratio;\n  }, [triggerRatioValue, triggerRatioInverted]);\n\n  useEffect(() => {\n    if (\n      fromToken &&\n      fromTokenAddress === prevFromTokenAddress &&\n      !needApproval &&\n      prevNeedApproval &&\n      isWaitingForApproval\n    ) {\n      setIsWaitingForApproval(false);\n      helperToast.success(<div>{fromToken.symbol} approved!</div>);\n    }\n  }, [\n    fromTokenAddress,\n    prevFromTokenAddress,\n    needApproval,\n    prevNeedApproval,\n    setIsWaitingForApproval,\n    fromToken.symbol,\n    isWaitingForApproval,\n    fromToken,\n  ]);\n\n  useEffect(() => {\n    if (!toTokens.find((token) => token.address === toTokenAddress)) {\n      setToTokenAddress(swapOption, toTokens[0].address);\n    }\n  }, [swapOption, toTokens, toTokenAddress, setToTokenAddress]);\n\n  useEffect(() => {\n    if (swapOption !== SHORT) {\n      return;\n    }\n    if (toTokenAddress === prevToTokenAddress) {\n      return;\n    }\n    for (let i = 0; i < stableTokens.length; i++) {\n      const stableToken = stableTokens[i];\n      const key = getPositionKey(account, stableToken.address, toTokenAddress, false, nativeTokenAddress);\n      const position = positionsMap[key];\n      if (position && position.size && position.size.gt(0)) {\n        setShortCollateralAddress(position.collateralToken.address);\n        return;\n      }\n    }\n  }, [\n    account,\n    toTokenAddress,\n    prevToTokenAddress,\n    swapOption,\n    positionsMap,\n    stableTokens,\n    nativeTokenAddress,\n    shortCollateralAddress,\n    setShortCollateralAddress,\n  ]);\n\n  useEffect(() => {\n    const updateSwapAmounts = () => {\n      if (anchorOnFromAmount) {\n        if (!fromAmount) {\n          setToValue(\"\");\n          return;\n        }\n        if (toToken) {\n          const { amount: nextToAmount } = getNextToAmount(\n            chainId,\n            fromAmount,\n            fromTokenAddress,\n            toTokenAddress,\n            infoTokens,\n            undefined,\n            !isMarketOrder && triggerRatio,\n            usdgSupply,\n            totalTokenWeights\n          );\n\n          const nextToValue = formatAmountFree(nextToAmount, toToken.decimals, toToken.decimals);\n          setToValue(nextToValue);\n        }\n        return;\n      }\n\n      if (!toAmount) {\n        setFromValue(\"\");\n        return;\n      }\n      if (fromToken) {\n        const { amount: nextFromAmount } = getNextFromAmount(\n          chainId,\n          toAmount,\n          fromTokenAddress,\n          toTokenAddress,\n          infoTokens,\n          undefined,\n          !isMarketOrder && triggerRatio,\n          usdgSupply,\n          totalTokenWeights\n        );\n        const nextFromValue = formatAmountFree(nextFromAmount, fromToken.decimals, fromToken.decimals);\n        setFromValue(nextFromValue);\n      }\n    };\n\n    const updateLeverageAmounts = () => {\n      if (!hasLeverageOption) {\n        return;\n      }\n      if (anchorOnFromAmount) {\n        if (!fromAmount) {\n          setToValue(\"\");\n          return;\n        }\n\n        const toTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n        if (toTokenInfo && toTokenInfo.maxPrice && fromUsdMin && fromUsdMin.gt(0)) {\n          const leverageMultiplier = parseInt(leverageOption * BASIS_POINTS_DIVISOR);\n          const toTokenPriceUsd =\n            !isMarketOrder && triggerPriceUsd && triggerPriceUsd.gt(0) ? triggerPriceUsd : toTokenInfo.maxPrice;\n\n          const { feeBasisPoints } = getNextToAmount(\n            chainId,\n            fromAmount,\n            fromTokenAddress,\n            collateralTokenAddress,\n            infoTokens,\n            undefined,\n            undefined,\n            usdgSupply,\n            totalTokenWeights\n          );\n\n          let fromUsdMinAfterFee = fromUsdMin;\n          if (feeBasisPoints) {\n            fromUsdMinAfterFee = fromUsdMin.mul(BASIS_POINTS_DIVISOR - feeBasisPoints).div(BASIS_POINTS_DIVISOR);\n          }\n\n          const toNumerator = fromUsdMinAfterFee.mul(leverageMultiplier).mul(BASIS_POINTS_DIVISOR);\n          const toDenominator = bigNumberify(MARGIN_FEE_BASIS_POINTS)\n            .mul(leverageMultiplier)\n            .add(bigNumberify(BASIS_POINTS_DIVISOR).mul(BASIS_POINTS_DIVISOR));\n\n          const nextToUsd = toNumerator.div(toDenominator);\n\n          const nextToAmount = nextToUsd.mul(expandDecimals(1, toToken.decimals)).div(toTokenPriceUsd);\n\n          const nextToValue = formatAmountFree(nextToAmount, toToken.decimals, toToken.decimals);\n\n          setToValue(nextToValue);\n        }\n        return;\n      }\n\n      if (!toAmount) {\n        setFromValue(\"\");\n        return;\n      }\n\n      const fromTokenInfo = getTokenInfo(infoTokens, fromTokenAddress);\n      if (fromTokenInfo && fromTokenInfo.minPrice && toUsdMax && toUsdMax.gt(0)) {\n        const leverageMultiplier = parseInt(leverageOption * BASIS_POINTS_DIVISOR);\n\n        const baseFromAmountUsd = toUsdMax.mul(BASIS_POINTS_DIVISOR).div(leverageMultiplier);\n\n        let fees = toUsdMax.mul(MARGIN_FEE_BASIS_POINTS).div(BASIS_POINTS_DIVISOR);\n\n        const { feeBasisPoints } = getNextToAmount(\n          chainId,\n          fromAmount,\n          fromTokenAddress,\n          collateralTokenAddress,\n          infoTokens,\n          undefined,\n          undefined,\n          usdgSupply,\n          totalTokenWeights\n        );\n\n        if (feeBasisPoints) {\n          const swapFees = baseFromAmountUsd.mul(feeBasisPoints).div(BASIS_POINTS_DIVISOR);\n          fees = fees.add(swapFees);\n        }\n\n        const nextFromUsd = baseFromAmountUsd.add(fees);\n\n        const nextFromAmount = nextFromUsd.mul(expandDecimals(1, fromToken.decimals)).div(fromTokenInfo.minPrice);\n\n        const nextFromValue = formatAmountFree(nextFromAmount, fromToken.decimals, fromToken.decimals);\n\n        setFromValue(nextFromValue);\n      }\n    };\n\n    if (isSwap) {\n      updateSwapAmounts();\n    }\n\n    if (isLong || isShort) {\n      updateLeverageAmounts();\n    }\n  }, [\n    anchorOnFromAmount,\n    fromAmount,\n    toAmount,\n    fromToken,\n    toToken,\n    fromTokenAddress,\n    toTokenAddress,\n    infoTokens,\n    isSwap,\n    isLong,\n    isShort,\n    leverageOption,\n    fromUsdMin,\n    toUsdMax,\n    isMarketOrder,\n    triggerPriceUsd,\n    triggerRatio,\n    hasLeverageOption,\n    usdgSupply,\n    totalTokenWeights,\n    chainId,\n    collateralTokenAddress,\n    indexTokenAddress,\n  ]);\n\n  let entryMarkPrice;\n  let exitMarkPrice;\n  if (toTokenInfo) {\n    entryMarkPrice = swapOption === LONG ? toTokenInfo.maxPrice : toTokenInfo.minPrice;\n    exitMarkPrice = swapOption === LONG ? toTokenInfo.minPrice : toTokenInfo.maxPrice;\n  }\n\n  let leverage = bigNumberify(0);\n  if (fromUsdMin && toUsdMax && fromUsdMin.gt(0)) {\n    const fees = toUsdMax.mul(MARGIN_FEE_BASIS_POINTS).div(BASIS_POINTS_DIVISOR);\n    if (fromUsdMin.sub(fees).gt(0)) {\n      leverage = toUsdMax.mul(BASIS_POINTS_DIVISOR).div(fromUsdMin.sub(fees));\n    }\n  }\n\n  let nextAveragePrice = isMarketOrder ? entryMarkPrice : triggerPriceUsd;\n  if (hasExistingPosition) {\n    let nextDelta, nextHasProfit;\n\n    if (isMarketOrder) {\n      nextDelta = existingPosition.delta;\n      nextHasProfit = existingPosition.hasProfit;\n    } else {\n      const data = calculatePositionDelta(triggerPriceUsd || bigNumberify(0), existingPosition);\n      nextDelta = data.delta;\n      nextHasProfit = data.hasProfit;\n    }\n\n    nextAveragePrice = getNextAveragePrice({\n      size: existingPosition.size,\n      sizeDelta: toUsdMax,\n      hasProfit: nextHasProfit,\n      delta: nextDelta,\n      nextPrice: isMarketOrder ? entryMarkPrice : triggerPriceUsd,\n      isLong,\n    });\n  }\n\n  const liquidationPrice = getLiquidationPrice({\n    isLong,\n    size: hasExistingPosition ? existingPosition.size : bigNumberify(0),\n    collateral: hasExistingPosition ? existingPosition.collateral : bigNumberify(0),\n    averagePrice: nextAveragePrice,\n    entryFundingRate: hasExistingPosition ? existingPosition.entryFundingRate : bigNumberify(0),\n    cumulativeFundingRate: hasExistingPosition ? existingPosition.cumulativeFundingRate : bigNumberify(0),\n    sizeDelta: toUsdMax,\n    collateralDelta: fromUsdMin,\n    increaseCollateral: true,\n    increaseSize: true,\n  });\n\n  const existingLiquidationPrice = existingPosition ? getLiquidationPrice(existingPosition) : undefined;\n  let displayLiquidationPrice = liquidationPrice ? liquidationPrice : existingLiquidationPrice;\n\n  if (hasExistingPosition) {\n    const collateralDelta = fromUsdMin ? fromUsdMin : bigNumberify(0);\n    const sizeDelta = toUsdMax ? toUsdMax : bigNumberify(0);\n    leverage = getLeverage({\n      size: existingPosition.size,\n      sizeDelta,\n      collateral: existingPosition.collateral,\n      collateralDelta,\n      increaseCollateral: true,\n      entryFundingRate: existingPosition.entryFundingRate,\n      cumulativeFundingRate: existingPosition.cumulativeFundingRate,\n      increaseSize: true,\n      hasProfit: existingPosition.hasProfit,\n      delta: existingPosition.delta,\n      includeDelta: savedIsPnlInLeverage,\n    });\n  } else if (hasLeverageOption) {\n    leverage = bigNumberify(parseInt(leverageOption * BASIS_POINTS_DIVISOR));\n  }\n\n  const getSwapError = () => {\n    const gasTokenInfo = getTokenInfo(infoTokens, ethers.constants.AddressZero);\n    if (gasTokenInfo.balance?.eq(0)) {\n      return [\"Not enough ETH for gas\"];\n    }\n\n    if (fromTokenAddress === toTokenAddress) {\n      return [\"Select different tokens\"];\n    }\n\n    if (!isMarketOrder) {\n      if ((toToken.isStable || toToken.isUsdg) && (fromToken.isStable || fromToken.isUsdg)) {\n        return [\"Select different tokens\"];\n      }\n\n      if (fromToken.isNative && toToken.isWrapped) {\n        return [\"Select different tokens\"];\n      }\n\n      if (toToken.isNative && fromToken.isWrapped) {\n        return [\"Select different tokens\"];\n      }\n    }\n\n    if (!fromAmount || fromAmount.eq(0)) {\n      return [\"Enter an amount\"];\n    }\n    if (!toAmount || toAmount.eq(0)) {\n      return [\"Enter an amount\"];\n    }\n\n    const fromTokenInfo = getTokenInfo(infoTokens, fromTokenAddress);\n    if (!fromTokenInfo || !fromTokenInfo.minPrice) {\n      return [\"Incorrect network\"];\n    }\n    if (fromTokenInfo && fromTokenInfo.balance && fromAmount && fromAmount.gt(fromTokenInfo.balance)) {\n      return [`Insufficient ${fromTokenInfo.symbol} balance`];\n    }\n\n    const toTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n\n    if (!isMarketOrder) {\n      if (!triggerRatioValue || triggerRatio.eq(0)) {\n        return [\"Enter a price\"];\n      }\n\n      const currentRate = getExchangeRate(fromTokenInfo, toTokenInfo);\n      if (currentRate && currentRate.lt(triggerRatio)) {\n        return [`Price ${triggerRatioInverted ? \"below\" : \"above\"} Mark Price`];\n      }\n    }\n\n    if (\n      !isWrapOrUnwrap &&\n      toToken &&\n      toTokenAddress !== USDG_ADDRESS &&\n      toTokenInfo &&\n      toTokenInfo.availableAmount &&\n      toAmount.gt(toTokenInfo.availableAmount)\n    ) {\n      return [\"Insufficient liquidity\"];\n    }\n    if (\n      !isWrapOrUnwrap &&\n      toAmount &&\n      toTokenInfo.bufferAmount &&\n      toTokenInfo.poolAmount &&\n      toTokenInfo.bufferAmount.gt(toTokenInfo.poolAmount.sub(toAmount))\n    ) {\n      return [\"Insufficient liquidity\"];\n    }\n\n    if (\n      fromUsdMin &&\n      fromTokenInfo.maxUsdgAmount &&\n      fromTokenInfo.maxUsdgAmount.gt(0) &&\n      fromTokenInfo.usdgAmount &&\n      fromTokenInfo.maxPrice\n    ) {\n      const usdgFromAmount = adjustForDecimals(fromUsdMin, USD_DECIMALS, USDG_DECIMALS);\n      const nextUsdgAmount = fromTokenInfo.usdgAmount.add(usdgFromAmount);\n\n      if (nextUsdgAmount.gt(fromTokenInfo.maxUsdgAmount)) {\n        return [`${fromTokenInfo.symbol} pool exceeded`];\n      }\n    }\n\n    return [false];\n  };\n\n  const getLeverageError = useCallback(() => {\n    const gasTokenInfo = getTokenInfo(infoTokens, ethers.constants.AddressZero);\n    if (gasTokenInfo.balance?.eq(0)) {\n      return [\"Not enough ETH for gas\"];\n    }\n    if (hasOutdatedUi) {\n      return [\"Page outdated, please refresh\"];\n    }\n\n    if (!toAmount || toAmount.eq(0)) {\n      return [\"Enter an amount\"];\n    }\n\n    let toTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n    if (toTokenInfo && toTokenInfo.isStable) {\n      return [`${swapOption === LONG ? \"Longing\" : \"Shorting\"} ${toTokenInfo.symbol} not supported`];\n    }\n\n    const fromTokenInfo = getTokenInfo(infoTokens, fromTokenAddress);\n    if (fromTokenInfo && fromTokenInfo.balance && fromAmount && fromAmount.gt(fromTokenInfo.balance)) {\n      return [`Insufficient ${fromTokenInfo.symbol} balance`];\n    }\n\n    if (leverage && leverage.eq(0)) {\n      return [\"Enter an amount\"];\n    }\n    if (!isMarketOrder && (!triggerPriceValue || triggerPriceUsd.eq(0))) {\n      return [\"Enter a price\"];\n    }\n\n    if (!hasExistingPosition && fromUsdMin && fromUsdMin.lt(expandDecimals(10, USD_DECIMALS))) {\n      return [\"Min order: 10 USD\"];\n    }\n\n    if (leverage && leverage.lt(1.1 * BASIS_POINTS_DIVISOR)) {\n      return [\"Min leverage: 1.1x\"];\n    }\n\n    if (leverage && leverage.gt(30.5 * BASIS_POINTS_DIVISOR)) {\n      return [\"Max leverage: 30.5x\"];\n    }\n\n    if (!isMarketOrder && entryMarkPrice && triggerPriceUsd) {\n      if (isLong && entryMarkPrice.lt(triggerPriceUsd)) {\n        return [\"Price above Mark Price\"];\n      }\n      if (!isLong && entryMarkPrice.gt(triggerPriceUsd)) {\n        return [\"Price below Mark Price\"];\n      }\n    }\n\n    if (isLong) {\n      let requiredAmount = toAmount;\n      if (fromTokenAddress !== toTokenAddress) {\n        const { amount: swapAmount } = getNextToAmount(\n          chainId,\n          fromAmount,\n          fromTokenAddress,\n          toTokenAddress,\n          infoTokens,\n          undefined,\n          undefined,\n          usdgSupply,\n          totalTokenWeights\n        );\n        requiredAmount = requiredAmount.add(swapAmount);\n\n        if (toToken && toTokenAddress !== USDG_ADDRESS) {\n          if (!toTokenInfo.availableAmount) {\n            return [\"Liquidity data not loaded\"];\n          }\n          if (toTokenInfo.availableAmount && requiredAmount.gt(toTokenInfo.availableAmount)) {\n            return [\"Insufficient liquidity\"];\n          }\n        }\n\n        if (\n          toTokenInfo.poolAmount &&\n          toTokenInfo.bufferAmount &&\n          toTokenInfo.bufferAmount.gt(toTokenInfo.poolAmount.sub(swapAmount))\n        ) {\n          return [\"Insufficient liquidity\", true, \"BUFFER\"];\n        }\n\n        if (\n          fromUsdMin &&\n          fromTokenInfo.maxUsdgAmount &&\n          fromTokenInfo.maxUsdgAmount.gt(0) &&\n          fromTokenInfo.minPrice &&\n          fromTokenInfo.usdgAmount\n        ) {\n          const usdgFromAmount = adjustForDecimals(fromUsdMin, USD_DECIMALS, USDG_DECIMALS);\n          const nextUsdgAmount = fromTokenInfo.usdgAmount.add(usdgFromAmount);\n          if (nextUsdgAmount.gt(fromTokenInfo.maxUsdgAmount)) {\n            return [`${fromTokenInfo.symbol} pool exceeded, try different token`, true, \"MAX_USDG\"];\n          }\n        }\n        if (toTokenInfo && toTokenInfo.maxPrice) {\n          const sizeUsd = toAmount.mul(toTokenInfo.maxPrice).div(expandDecimals(1, toTokenInfo.decimals));\n          if (\n            toTokenInfo.maxGlobalLongSize &&\n            toTokenInfo.maxGlobalLongSize.gt(0) &&\n            toTokenInfo.maxAvailableLong &&\n            sizeUsd.gt(toTokenInfo.maxAvailableLong)\n          ) {\n            return [`Max ${toTokenInfo.symbol} long exceeded`];\n          }\n        }\n      }\n    }\n\n    if (isShort) {\n      let stableTokenAmount = bigNumberify(0);\n      if (fromTokenAddress !== shortCollateralAddress && fromAmount && fromAmount.gt(0)) {\n        const { amount: nextToAmount } = getNextToAmount(\n          chainId,\n          fromAmount,\n          fromTokenAddress,\n          shortCollateralAddress,\n          infoTokens,\n          undefined,\n          undefined,\n          usdgSupply,\n          totalTokenWeights\n        );\n        stableTokenAmount = nextToAmount;\n        if (stableTokenAmount.gt(shortCollateralToken.availableAmount)) {\n          return [`Insufficient liquidity, change \"Profits In\"`];\n        }\n\n        if (\n          shortCollateralToken.bufferAmount &&\n          shortCollateralToken.poolAmount &&\n          shortCollateralToken.bufferAmount.gt(shortCollateralToken.poolAmount.sub(stableTokenAmount))\n        ) {\n          // suggest swapping to collateralToken\n          return [`Insufficient liquidity, change \"Profits In\"`, true, \"BUFFER\"];\n        }\n\n        if (\n          fromTokenInfo.maxUsdgAmount &&\n          fromTokenInfo.maxUsdgAmount.gt(0) &&\n          fromTokenInfo.minPrice &&\n          fromTokenInfo.usdgAmount\n        ) {\n          const usdgFromAmount = adjustForDecimals(fromUsdMin, USD_DECIMALS, USDG_DECIMALS);\n          const nextUsdgAmount = fromTokenInfo.usdgAmount.add(usdgFromAmount);\n          if (nextUsdgAmount.gt(fromTokenInfo.maxUsdgAmount)) {\n            return [`${fromTokenInfo.symbol} pool exceeded, try different token`, true, \"MAX_USDG\"];\n          }\n        }\n      }\n      if (\n        !shortCollateralToken ||\n        !fromTokenInfo ||\n        !toTokenInfo ||\n        !toTokenInfo.maxPrice ||\n        !shortCollateralToken.availableAmount\n      ) {\n        return [\"Fetching token info...\"];\n      }\n\n      const sizeUsd = toAmount.mul(toTokenInfo.maxPrice).div(expandDecimals(1, toTokenInfo.decimals));\n      const sizeTokens = sizeUsd\n        .mul(expandDecimals(1, shortCollateralToken.decimals))\n        .div(shortCollateralToken.minPrice);\n\n      if (!toTokenInfo.maxAvailableShort) {\n        return [\"Liquidity data not loaded\"];\n      }\n\n      if (\n        toTokenInfo.maxAvailableShort &&\n        toTokenInfo.maxAvailableShort.gt(0) &&\n        sizeUsd.gt(toTokenInfo.maxAvailableShort)\n      ) {\n        return [`Max ${toTokenInfo.symbol} short exceeded`];\n      }\n\n      stableTokenAmount = stableTokenAmount.add(sizeTokens);\n      if (stableTokenAmount.gt(shortCollateralToken.availableAmount)) {\n        return [`Insufficient liquidity, change \"Profits In\"`];\n      }\n    }\n\n    return [false];\n  }, [\n    chainId,\n    fromAmount,\n    fromTokenAddress,\n    fromUsdMin,\n    hasExistingPosition,\n    infoTokens,\n    isLong,\n    isMarketOrder,\n    isShort,\n    leverage,\n    shortCollateralAddress,\n    shortCollateralToken,\n    swapOption,\n    toAmount,\n    toToken,\n    toTokenAddress,\n    totalTokenWeights,\n    triggerPriceUsd,\n    triggerPriceValue,\n    usdgSupply,\n    entryMarkPrice,\n    hasOutdatedUi,\n  ]);\n\n  const getToLabel = () => {\n    if (isSwap) {\n      return \"Receive\";\n    }\n    if (isLong) {\n      return \"Long\";\n    }\n    return \"Short\";\n  };\n\n  const getError = () => {\n    if (isSwap) {\n      return getSwapError();\n    }\n    return getLeverageError();\n  };\n\n  const renderOrdersToa = useCallback(() => {\n    if (!ordersToaOpen) {\n      return null;\n    }\n\n    return (\n      <OrdersToa\n        setIsVisible={setOrdersToaOpen}\n        approveOrderBook={approveOrderBook}\n        isPluginApproving={isPluginApproving}\n      />\n    );\n  }, [ordersToaOpen, setOrdersToaOpen, isPluginApproving, approveOrderBook]);\n\n  const renderErrorModal = useCallback(() => {\n    const inputCurrency = fromToken.address === AddressZero ? \"ETH\" : fromToken.address;\n    let outputCurrency;\n    if (isLong) {\n      outputCurrency = toToken.address === AddressZero ? \"ETH\" : toToken.address;\n    } else {\n      outputCurrency = shortCollateralToken.address;\n    }\n    let uniswapUrl = `https://app.uniswap.org/#/swap?inputCurrency=${inputCurrency}&outputCurrency=${outputCurrency}&chain=arbitrum`;\n    const label =\n      modalError === \"BUFFER\" ? `${shortCollateralToken.symbol} Required` : `${fromToken.symbol} Capacity Reached`;\n    const swapTokenSymbol = isLong ? toToken.symbol : shortCollateralToken.symbol;\n    return (\n      <Modal isVisible={!!modalError} setIsVisible={setModalError} label={label} className=\"Error-modal\">\n        You will need to select {swapTokenSymbol} as the \"Pay\" token to initiate this trade.\n        <br />\n        <br />\n        <a href={uniswapUrl} target=\"_blank\" rel=\"noreferrer\">\n          Buy {swapTokenSymbol} on Uniswap\n        </a>\n      </Modal>\n    );\n  }, [\n    modalError,\n    setModalError,\n    fromToken?.address,\n    toToken?.address,\n    shortCollateralToken?.address,\n    isLong,\n    shortCollateralToken?.symbol,\n    toToken?.symbol,\n    fromToken?.symbol,\n  ]);\n\n  const isPrimaryEnabled = () => {\n    if (!active) {\n      return true;\n    }\n    const [error, modal] = getError();\n    if (error && !modal) {\n      return false;\n    }\n    if (needOrderBookApproval && isWaitingForPluginApproval) {\n      return false;\n    }\n    if ((needApproval && isWaitingForApproval) || isApproving) {\n      return false;\n    }\n    if (needPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      return false;\n    }\n    if (isPositionRouterApproving) {\n      return false;\n    }\n    if (isApproving) {\n      return false;\n    }\n    if (isSubmitting) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const getPrimaryText = () => {\n    if (!active) {\n      return \"Connect Wallet\";\n    }\n    if (!isSupportedChain(chainId)) {\n      return \"Incorrect Network\";\n    }\n    const [error, modal] = getError();\n    if (error && !modal) {\n      return error;\n    }\n\n    if (needPositionRouterApproval && isWaitingForPositionRouterApproval) {\n      return \"Enabling Leverage...\";\n    }\n    if (isPositionRouterApproving) {\n      return \"Enabling Leverage...\";\n    }\n    if (needPositionRouterApproval) {\n      return \"Enable Leverage\";\n    }\n\n    if (needApproval && isWaitingForApproval) {\n      return \"Waiting for Approval\";\n    }\n    if (isApproving) {\n      return `Approving ${fromToken.symbol}...`;\n    }\n    if (needApproval) {\n      return `Approve ${fromToken.symbol}`;\n    }\n\n    if (needOrderBookApproval && isWaitingForPluginApproval) {\n      return \"Enabling Orders...\";\n    }\n    if (isPluginApproving) {\n      return \"Enabling Orders...\";\n    }\n    if (needOrderBookApproval) {\n      return \"Enable Orders\";\n    }\n\n    if (!isMarketOrder) return `Create ${orderOption.charAt(0) + orderOption.substring(1).toLowerCase()} Order`;\n\n    if (isSwap) {\n      if (toUsdMax && toUsdMax.lt(fromUsdMin.mul(95).div(100))) {\n        return \"High Slippage, Swap Anyway\";\n      }\n      return \"Swap\";\n    }\n\n    if (isLong) {\n      const indexTokenInfo = getTokenInfo(infoTokens, toTokenAddress);\n      if (indexTokenInfo && indexTokenInfo.minPrice) {\n        const { amount: nextToAmount } = getNextToAmount(\n          chainId,\n          fromAmount,\n          fromTokenAddress,\n          indexTokenAddress,\n          infoTokens,\n          undefined,\n          undefined,\n          usdgSupply,\n          totalTokenWeights\n        );\n        const nextToAmountUsd = nextToAmount\n          .mul(indexTokenInfo.minPrice)\n          .div(expandDecimals(1, indexTokenInfo.decimals));\n        if (fromTokenAddress === USDG_ADDRESS && nextToAmountUsd.lt(fromUsdMin.mul(98).div(100))) {\n          return \"High USDG Slippage, Long Anyway\";\n        }\n      }\n      return `Long ${toToken.symbol}`;\n    }\n\n    return `Short ${toToken.symbol}`;\n  };\n\n  const onSelectFromToken = (token) => {\n    setFromTokenAddress(swapOption, token.address);\n    setIsWaitingForApproval(false);\n\n    if (isShort && token.isStable) {\n      setShortCollateralAddress(token.address);\n    }\n  };\n\n  const onSelectShortCollateralAddress = (token) => {\n    setShortCollateralAddress(token.address);\n  };\n\n  const onSelectToToken = (token) => {\n    setToTokenAddress(swapOption, token.address);\n  };\n\n  const onFromValueChange = (e) => {\n    setAnchorOnFromAmount(true);\n    setFromValue(e.target.value);\n  };\n\n  const onToValueChange = (e) => {\n    setAnchorOnFromAmount(false);\n    setToValue(e.target.value);\n  };\n\n  const switchTokens = () => {\n    if (fromAmount && toAmount) {\n      if (anchorOnFromAmount) {\n        setToValue(formatAmountFree(fromAmount, fromToken.decimals, 8));\n      } else {\n        setFromValue(formatAmountFree(toAmount, toToken.decimals, 8));\n      }\n      setAnchorOnFromAmount(!anchorOnFromAmount);\n    }\n    setIsWaitingForApproval(false);\n\n    const updatedTokenSelection = JSON.parse(JSON.stringify(tokenSelection));\n    updatedTokenSelection[swapOption] = {\n      from: toTokenAddress,\n      to: fromTokenAddress,\n    };\n    setTokenSelection(updatedTokenSelection);\n  };\n\n  const wrap = async () => {\n    setIsSubmitting(true);\n\n    const contract = new ethers.Contract(nativeTokenAddress, WETH.abi, library.getSigner());\n    Api.callContract(chainId, contract, \"deposit\", {\n      value: fromAmount,\n      sentMsg: \"Swap submitted.\",\n      successMsg: `Swapped ${formatAmount(fromAmount, fromToken.decimals, 4, true)} ${\n        fromToken.symbol\n      } for ${formatAmount(toAmount, toToken.decimals, 4, true)} ${toToken.symbol}!`,\n      failMsg: \"Swap failed.\",\n      setPendingTxns,\n    })\n      .then(async (res) => {})\n      .finally(() => {\n        setIsSubmitting(false);\n      });\n  };\n\n  const unwrap = async () => {\n    setIsSubmitting(true);\n\n    const contract = new ethers.Contract(nativeTokenAddress, WETH.abi, library.getSigner());\n    Api.callContract(chainId, contract, \"withdraw\", [fromAmount], {\n      sentMsg: \"Swap submitted!\",\n      failMsg: \"Swap failed.\",\n      successMsg: `Swapped ${formatAmount(fromAmount, fromToken.decimals, 4, true)} ${\n        fromToken.symbol\n      } for ${formatAmount(toAmount, toToken.decimals, 4, true)} ${toToken.symbol}!`,\n      setPendingTxns,\n    })\n      .then(async (res) => {})\n      .finally(() => {\n        setIsSubmitting(false);\n      });\n  };\n\n  const swap = async () => {\n    if (fromToken.isNative && toToken.isWrapped) {\n      wrap();\n      return;\n    }\n\n    if (fromTokenAddress.isWrapped && toToken.isNative) {\n      unwrap();\n      return;\n    }\n\n    setIsSubmitting(true);\n    let path = [fromTokenAddress, toTokenAddress];\n    if (anchorOnFromAmount) {\n      const { path: multiPath } = getNextToAmount(\n        chainId,\n        fromAmount,\n        fromTokenAddress,\n        toTokenAddress,\n        infoTokens,\n        undefined,\n        undefined,\n        usdgSupply,\n        totalTokenWeights\n      );\n      if (multiPath) {\n        path = multiPath;\n      }\n    } else {\n      const { path: multiPath } = getNextFromAmount(\n        chainId,\n        toAmount,\n        fromTokenAddress,\n        toTokenAddress,\n        infoTokens,\n        undefined,\n        undefined,\n        usdgSupply,\n        totalTokenWeights\n      );\n      if (multiPath) {\n        path = multiPath;\n      }\n    }\n\n    let method;\n    let contract;\n    let value;\n    let params;\n    let minOut;\n    if (shouldRaiseGasError(getTokenInfo(infoTokens, fromTokenAddress), fromAmount)) {\n      setIsSubmitting(false);\n      setIsPendingConfirmation(true);\n      helperToast.error(\n        `Leave at least ${formatAmount(DUST_BNB, 18, 3)} ${getConstant(chainId, \"nativeTokenSymbol\")} for gas`\n      );\n      return;\n    }\n\n    if (!isMarketOrder) {\n      minOut = toAmount;\n      Api.createSwapOrder(chainId, library, path, fromAmount, minOut, triggerRatio, nativeTokenAddress, {\n        sentMsg: \"Swap Order submitted!\",\n        successMsg: \"Swap Order created!\",\n        failMsg: \"Swap Order creation failed.\",\n        pendingTxns,\n        setPendingTxns,\n      })\n        .then(() => {\n          trackTrade(3, \"Swap\");\n          setIsConfirming(false);\n        })\n        .finally(() => {\n          setIsSubmitting(false);\n          setIsPendingConfirmation(false);\n        });\n      return;\n    }\n\n    path = replaceNativeTokenAddress(path, nativeTokenAddress);\n    method = \"swap\";\n    value = bigNumberify(0);\n    if (toTokenAddress === AddressZero) {\n      method = \"swapTokensToETH\";\n    }\n\n    minOut = toAmount.mul(BASIS_POINTS_DIVISOR - allowedSlippage).div(BASIS_POINTS_DIVISOR);\n    params = [path, fromAmount, minOut, account];\n    if (fromTokenAddress === AddressZero) {\n      method = \"swapETHToTokens\";\n      value = fromAmount;\n      params = [path, minOut, account];\n    }\n    contract = new ethers.Contract(routerAddress, Router.abi, library.getSigner());\n\n    Api.callContract(chainId, contract, method, params, {\n      value,\n      sentMsg: `Swap ${!isMarketOrder ? \" order \" : \"\"} submitted!`,\n      successMsg: `Swapped ${formatAmount(fromAmount, fromToken.decimals, 4, true)} ${\n        fromToken.symbol\n      } for ${formatAmount(toAmount, toToken.decimals, 4, true)} ${toToken.symbol}!`,\n      failMsg: \"Swap failed.\",\n      setPendingTxns,\n    })\n      .then(async () => {\n        trackTrade(3, \"Swap\");\n        setIsConfirming(false);\n      })\n      .finally(() => {\n        setIsSubmitting(false);\n        setIsPendingConfirmation(false);\n      });\n  };\n\n  const createIncreaseOrder = () => {\n    let path = [fromTokenAddress];\n\n    if (path[0] === USDG_ADDRESS) {\n      if (isLong) {\n        const stableToken = getMostAbundantStableToken(chainId, infoTokens);\n        path.push(stableToken.address);\n      } else {\n        path.push(shortCollateralAddress);\n      }\n    }\n\n    const minOut = 0;\n    const indexToken = getToken(chainId, indexTokenAddress);\n    const successMsg = `\n      Created limit order for ${indexToken.symbol} ${isLong ? \"Long\" : \"Short\"}: ${formatAmount(\n      toUsdMax,\n      USD_DECIMALS,\n      2\n    )} USD!\n    `;\n    return Api.createIncreaseOrder(\n      chainId,\n      library,\n      nativeTokenAddress,\n      path,\n      fromAmount,\n      indexTokenAddress,\n      minOut,\n      toUsdMax,\n      collateralTokenAddress,\n      isLong,\n      triggerPriceUsd,\n      {\n        pendingTxns,\n        setPendingTxns,\n        sentMsg: \"Limit order submitted!\",\n        successMsg,\n        failMsg: \"Limit order creation failed.\",\n      }\n    )\n      .then(() => {\n        trackTrade(3, \"Limit\");\n        setIsConfirming(false);\n      })\n      .finally(() => {\n        setIsSubmitting(false);\n        setIsPendingConfirmation(false);\n      });\n  };\n\n  let referralCode = ethers.constants.HashZero;\n  if (isHashZero(userReferralCode) && userReferralCodeInLocalStorage) {\n    referralCode = userReferralCodeInLocalStorage;\n  }\n\n  const increasePosition = async () => {\n    setIsSubmitting(true);\n    const tokenAddress0 = fromTokenAddress === AddressZero ? nativeTokenAddress : fromTokenAddress;\n    const indexTokenAddress = toTokenAddress === AddressZero ? nativeTokenAddress : toTokenAddress;\n    let path = [indexTokenAddress]; // assume long\n    if (toTokenAddress !== fromTokenAddress) {\n      path = [tokenAddress0, indexTokenAddress];\n    }\n\n    if (fromTokenAddress === AddressZero && toTokenAddress === nativeTokenAddress) {\n      path = [nativeTokenAddress];\n    }\n\n    if (fromTokenAddress === nativeTokenAddress && toTokenAddress === AddressZero) {\n      path = [nativeTokenAddress];\n    }\n\n    if (isShort) {\n      path = [shortCollateralAddress];\n      if (tokenAddress0 !== shortCollateralAddress) {\n        path = [tokenAddress0, shortCollateralAddress];\n      }\n    }\n\n    const refPrice = isLong ? toTokenInfo.maxPrice : toTokenInfo.minPrice;\n    const priceBasisPoints = isLong ? BASIS_POINTS_DIVISOR + allowedSlippage : BASIS_POINTS_DIVISOR - allowedSlippage;\n    const priceLimit = refPrice.mul(priceBasisPoints).div(BASIS_POINTS_DIVISOR);\n\n    const boundedFromAmount = fromAmount ? fromAmount : bigNumberify(0);\n\n    if (fromAmount && fromAmount.gt(0) && fromTokenAddress === USDG_ADDRESS && isLong) {\n      const { amount: nextToAmount, path: multiPath } = getNextToAmount(\n        chainId,\n        fromAmount,\n        fromTokenAddress,\n        indexTokenAddress,\n        infoTokens,\n        undefined,\n        undefined,\n        usdgSupply,\n        totalTokenWeights\n      );\n      if (nextToAmount.eq(0)) {\n        helperToast.error(\"Insufficient liquidity\");\n        return;\n      }\n      if (multiPath) {\n        path = replaceNativeTokenAddress(multiPath);\n      }\n    }\n\n    let params = [\n      path, // _path\n      indexTokenAddress, // _indexToken\n      boundedFromAmount, // _amountIn\n      0, // _minOut\n      toUsdMax, // _sizeDelta\n      isLong, // _isLong\n      priceLimit, // _acceptablePrice\n      minExecutionFee, // _executionFee\n      referralCode, // _referralCode\n    ];\n\n    let method = \"createIncreasePosition\";\n    let value = minExecutionFee;\n    if (fromTokenAddress === AddressZero) {\n      method = \"createIncreasePositionETH\";\n      value = boundedFromAmount.add(minExecutionFee);\n      params = [\n        path, // _path\n        indexTokenAddress, // _indexToken\n        0, // _minOut\n        toUsdMax, // _sizeDelta\n        isLong, // _isLong\n        priceLimit, // _acceptablePrice\n        minExecutionFee, // _executionFee\n        referralCode, // _referralCode\n      ];\n    }\n\n    if (shouldRaiseGasError(getTokenInfo(infoTokens, fromTokenAddress), fromAmount)) {\n      setIsSubmitting(false);\n      setIsPendingConfirmation(false);\n      helperToast.error(\n        `Leave at least ${formatAmount(DUST_BNB, 18, 3)} ${getConstant(chainId, \"nativeTokenSymbol\")} for gas`\n      );\n      return;\n    }\n\n    const contractAddress = getContract(chainId, \"PositionRouter\");\n    const contract = new ethers.Contract(contractAddress, PositionRouter.abi, library.getSigner());\n    const indexToken = getTokenInfo(infoTokens, indexTokenAddress);\n    const tokenSymbol = indexToken.isWrapped ? getConstant(chainId, \"nativeTokenSymbol\") : indexToken.symbol;\n    const successMsg = `Requested increase of ${tokenSymbol} ${isLong ? \"Long\" : \"Short\"} by ${formatAmount(\n      toUsdMax,\n      USD_DECIMALS,\n      2\n    )} USD.`;\n\n    Api.callContract(chainId, contract, method, params, {\n      value,\n      setPendingTxns,\n      sentMsg: `${isLong ? \"Long\" : \"Short\"} submitted.`,\n      failMsg: `${isLong ? \"Long\" : \"Short\"} failed.`,\n      successMsg,\n    })\n      .then(async () => {\n        trackTrade(3, `${isLong ? \"Long\" : \"Short\"}`);\n        setIsConfirming(false);\n\n        const key = getPositionKey(account, path[path.length - 1], indexTokenAddress, isLong);\n        let nextSize = toUsdMax;\n        if (hasExistingPosition) {\n          nextSize = existingPosition.size.add(toUsdMax);\n        }\n\n        pendingPositions[key] = {\n          updatedAt: Date.now(),\n          pendingChanges: {\n            size: nextSize,\n          },\n        };\n\n        setPendingPositions({ ...pendingPositions });\n      })\n      .finally(() => {\n        setIsSubmitting(false);\n        setIsPendingConfirmation(false);\n      });\n  };\n\n  const onSwapOptionChange = (opt) => {\n    setSwapOption(opt);\n    setAnchorOnFromAmount(true);\n    setFromValue(\"\");\n    setToValue(\"\");\n    setTriggerPriceValue(\"\");\n    setTriggerRatioValue(\"\");\n\n    if (opt === SHORT && infoTokens) {\n      const fromToken = getToken(chainId, tokenSelection[opt].from);\n      if (fromToken && fromToken.isStable) {\n        setShortCollateralAddress(fromToken.address);\n      } else {\n        const stableToken = getMostAbundantStableToken(chainId, infoTokens);\n        setShortCollateralAddress(stableToken.address);\n      }\n    }\n\n    trackAction &&\n      trackAction(\"Swap option changed\", {\n        option: opt,\n      });\n  };\n\n  const onConfirmationClick = () => {\n    if (!active) {\n      props.connectWallet();\n      return;\n    }\n\n    if (needOrderBookApproval) {\n      approveOrderBook();\n      return;\n    }\n\n    setIsPendingConfirmation(true);\n\n    if (isSwap) {\n      swap();\n      return;\n    }\n\n    if (orderOption === LIMIT) {\n      createIncreaseOrder();\n      return;\n    }\n\n    increasePosition();\n  };\n\n  function approveFromToken() {\n    approveTokens({\n      setIsApproving,\n      library,\n      tokenAddress: fromToken.address,\n      spender: routerAddress,\n      chainId: chainId,\n      onApproveSubmitted: () => {\n        setIsWaitingForApproval(true);\n      },\n      infoTokens,\n      getTokenInfo,\n      pendingTxns,\n      setPendingTxns,\n    });\n  }\n\n  const onClickPrimary = () => {\n    if (!active) {\n      props.connectWallet();\n      return;\n    }\n\n    if (needPositionRouterApproval) {\n      approvePositionRouter({\n        sentMsg: \"Enable leverage sent.\",\n        failMsg: \"Enable leverage failed.\",\n      });\n      return;\n    }\n\n    if (needApproval) {\n      approveFromToken();\n      return;\n    }\n\n    if (needOrderBookApproval) {\n      setOrdersToaOpen(true);\n      return;\n    }\n\n    const [, modal, errorCode] = getError();\n\n    if (modal) {\n      setModalError(errorCode);\n      return;\n    }\n\n    if (isSwap) {\n      if (fromTokenAddress === AddressZero && toTokenAddress === nativeTokenAddress) {\n        wrap();\n        return;\n      }\n\n      if (fromTokenAddress === nativeTokenAddress && toTokenAddress === AddressZero) {\n        unwrap();\n        return;\n      }\n    }\n\n    setIsConfirming(true);\n    setIsHigherSlippageAllowed(false);\n  };\n\n  const showFromAndToSection = orderOption !== STOP;\n  const showSizeSection = orderOption === STOP;\n  const showTriggerPriceSection = !isSwap && !isMarketOrder;\n  const showTriggerRatioSection = isSwap && !isMarketOrder;\n\n  let fees;\n  let feesUsd;\n  let feeBps;\n  let swapFees;\n  let positionFee;\n  if (isSwap) {\n    if (fromAmount) {\n      const { feeBasisPoints } = getNextToAmount(\n        chainId,\n        fromAmount,\n        fromTokenAddress,\n        toTokenAddress,\n        infoTokens,\n        undefined,\n        undefined,\n        usdgSupply,\n        totalTokenWeights\n      );\n      if (feeBasisPoints !== undefined) {\n        fees = fromAmount.mul(feeBasisPoints).div(BASIS_POINTS_DIVISOR);\n        const feeTokenPrice =\n          fromTokenInfo.address === USDG_ADDRESS ? expandDecimals(1, USD_DECIMALS) : fromTokenInfo.maxPrice;\n        feesUsd = fees.mul(feeTokenPrice).div(expandDecimals(1, fromTokenInfo.decimals));\n      }\n      feeBps = feeBasisPoints;\n    }\n  } else if (toUsdMax) {\n    positionFee = toUsdMax.mul(MARGIN_FEE_BASIS_POINTS).div(BASIS_POINTS_DIVISOR);\n    feesUsd = positionFee;\n\n    const { feeBasisPoints } = getNextToAmount(\n      chainId,\n      fromAmount,\n      fromTokenAddress,\n      collateralTokenAddress,\n      infoTokens,\n      undefined,\n      undefined,\n      usdgSupply,\n      totalTokenWeights\n    );\n    if (feeBasisPoints) {\n      swapFees = fromUsdMin.mul(feeBasisPoints).div(BASIS_POINTS_DIVISOR);\n      feesUsd = feesUsd.add(swapFees);\n    }\n    feeBps = feeBasisPoints;\n  }\n\n  if (!fromToken || !toToken) {\n    return null;\n  }\n\n  let hasZeroBorrowFee = false;\n  let borrowFeeText;\n  if (isLong && toTokenInfo && toTokenInfo.fundingRate) {\n    borrowFeeText = formatAmount(toTokenInfo.fundingRate, 4, 4) + \"% / 1h\";\n    if (toTokenInfo.fundingRate.eq(0)) {\n      // hasZeroBorrowFee = true\n    }\n  }\n  if (isShort && shortCollateralToken && shortCollateralToken.fundingRate) {\n    borrowFeeText = formatAmount(shortCollateralToken.fundingRate, 4, 4) + \"% / 1h\";\n    if (shortCollateralToken.fundingRate.eq(0)) {\n      // hasZeroBorrowFee = true\n    }\n  }\n\n  function setFromValueToMaximumAvailable() {\n    if (!fromToken || !fromBalance) {\n      return;\n    }\n\n    const maxAvailableAmount = fromToken.isNative ? fromBalance.sub(bigNumberify(DUST_BNB).mul(2)) : fromBalance;\n    setFromValue(formatAmountFree(maxAvailableAmount, fromToken.decimals, fromToken.decimals));\n    setAnchorOnFromAmount(true);\n  }\n\n  function shouldShowMaxButton() {\n    if (!fromToken || !fromBalance) {\n      return false;\n    }\n    const maxAvailableAmount = fromToken.isNative ? fromBalance.sub(bigNumberify(DUST_BNB).mul(2)) : fromBalance;\n    return fromValue !== formatAmountFree(maxAvailableAmount, fromToken.decimals, fromToken.decimals);\n  }\n\n  const determineLiquidationPrice = () => {\n    switch (true) {\n      case !!existingLiquidationPrice:\n        return formatAmount(existingLiquidationPrice, USD_DECIMALS, 2, false);\n      case !!displayLiquidationPrice:\n        return formatAmount(displayLiquidationPrice, USD_DECIMALS, 2, false);\n      default:\n        return 0;\n    }\n  };\n\n  const determineBorrowFee = () => {\n    let borrowFee = 0;\n    switch (true) {\n      case isLong && toTokenInfo:\n        borrowFee = parseFloat(formatAmount(toTokenInfo.fundingRate, 4, 4));\n        break;\n      case isShort && shortCollateralToken:\n        borrowFee = parseFloat(formatAmount(shortCollateralToken.fundingRate, 4, 4));\n        break;\n      default:\n        borrowFee = 0;\n        break;\n    }\n    if (\n      (isLong && toTokenInfo && toTokenInfo.fundingRate) ||\n      (isShort && shortCollateralToken && shortCollateralToken.fundingRate)\n    ) {\n      return `${borrowFee}% / 1h`;\n    } else {\n      return borrowFee;\n    }\n  };\n\n  const trackTrade = (stage, tradeType) => {\n    let stageName = \"\";\n    switch (stage) {\n      case 1:\n        stageName = \"Approve\";\n        break;\n      case 2:\n        stageName = \"Pre-confirmation\";\n        break;\n      case 3:\n        stageName = \"Post-confirmation\";\n        break;\n      default:\n        stageName = \"Approve\";\n        break;\n    }\n\n    const actionName = `${stageName}`;\n\n    try {\n      const fromToken = getToken(chainId, fromTokenAddress);\n      const toToken = getToken(chainId, toTokenAddress);\n      const leverage = (isLong || isShort) && hasLeverageOption && parseFloat(leverageOption).toFixed(2);\n      const market = swapOption !== \"Swap\" ? `${toToken.symbol}/USD` : \"No market - swap\"; //No market for Swap\n      const collateralAfterFees = feesUsd ? fromUsdMin.sub(feesUsd) : 0; //No collateral for Swap\n      const spread = getSpread(fromTokenInfo, toTokenInfo, isLong, nativeTokenAddress);\n      const entryPrice =\n        isLong || isShort ? formatAmount(entryMarkPrice, USD_DECIMALS, 2, false) : \"No entry price - swap\";\n      let liqPrice = parseFloat(determineLiquidationPrice());\n      liqPrice = liqPrice < 0 ? 0 : liqPrice;\n\n      // Format user ERC20 token balances from BigNumber to float\n      const [userBalances, tokenPrices, poolBalances] = getUserTokenBalances(infoTokens);\n\n      const traits = {\n        actionType: \"Create\",\n        transactionType: \"Buy\",\n        tradeType: tradeType,\n        position: swapOption,\n        market: market,\n        tokenToPay: fromToken.symbol,\n        tokenToReceive: toToken.symbol,\n        amountToPay: parseFloat(fromValue),\n        amountToReceive: parseFloat(toValue),\n        fromCurrencyBalance: parseFloat(formatAmount(fromBalance, fromToken.decimals, 4, false)),\n        fromCurrencyToken: fromToken.symbol,\n        leverage: parseFloat(leverage),\n        feesUsd: parseFloat(formatAmount(feesUsd, 4, 4, false)),\n        feesUsdFormatted: parseFloat(formatAmount(feesUsd, 4, 4, false).toFixed(2)),\n        [`fees${fromToken.symbol}`]: parseFloat(formatAmount(fees, fromToken.decimals, 4, false)),\n        walletAddress: account,\n        network: NETWORK_NAME[chainId],\n        profitsIn: toToken.symbol,\n        liqPrice: liqPrice,\n        collateralUsd: `${parseFloat(formatAmount(collateralAfterFees, USD_DECIMALS, 2, false))}`,\n        spreadIsHigh: spread.isHigh,\n        spreadValue: parseFloat(formatAmount(spread.value, 4, 4, true)),\n        entryPrice: parseFloat(entryPrice),\n        borrowFee: determineBorrowFee(),\n        allowedSlippage: parseFloat(formatAmount(allowedSlippage, 2, 2)),\n        upToOnePercentSlippageEnabled: isHigherSlippageAllowed,\n        ...userBalances,\n        ...tokenPrices,\n        ...poolBalances,\n      };\n      trackAction && trackAction(actionName, traits);\n    } catch (err) {\n      console.error(`Unable to track ${actionName} event`, err);\n    }\n  };\n\n  const preventStrangeNumberInputs = (e) => {\n    if ([\"e\", \"E\", \"+\", \"-\"].includes(e.key)) {\n      e.preventDefault();\n    }\n  };\n\n  return (\n    <div className=\"Exchange-swap-box\">\n      {/* <div className=\"Exchange-swap-wallet-box App-box\">\n        {active && <div className=\"Exchange-swap-account\" >\n        </div>}\n      </div> */}\n      <div className=\"Exchange-swap-box-inner App-box-highlight\">\n        <div>\n          <Tab\n            icons={SWAP_ICONS}\n            options={SWAP_OPTIONS}\n            option={swapOption}\n            onChange={onSwapOptionChange}\n            className=\"Exchange-swap-option-tabs\"\n          />\n          {flagOrdersEnabled && (\n            <Tab\n              options={orderOptions}\n              className=\"Exchange-swap-order-type-tabs\"\n              type=\"inline\"\n              option={orderOption}\n              onChange={onOrderOptionChange}\n              newItem={LIMIT}\n            />\n          )}\n        </div>\n        {showFromAndToSection && (\n          <React.Fragment>\n            <div className=\"Exchange-swap-section\">\n              <div className=\"Exchange-swap-section-top\">\n                <div className=\"muted\">\n                  {fromUsdMin && (\n                    <div className=\"Exchange-swap-usd\">Pay: {formatAmount(fromUsdMin, USD_DECIMALS, 2, true)} USD</div>\n                  )}\n                  {!fromUsdMin && \"Pay\"}\n                </div>\n                {fromBalance && (\n                  <div className=\"muted align-right clickable\" onClick={setFromValueToMaximumAvailable}>\n                    Balance: {formatAmount(fromBalance, fromToken.decimals, 4, true)}\n                  </div>\n                )}\n              </div>\n              <div className=\"Exchange-swap-section-bottom\">\n                <div className=\"Exchange-swap-input-container\">\n                  <input\n                    type=\"number\"\n                    min=\"0\"\n                    placeholder=\"0.0\"\n                    className=\"Exchange-swap-input\"\n                    value={fromValue}\n                    onChange={onFromValueChange}\n                    onKeyDown={preventStrangeNumberInputs}\n                  />\n                  {shouldShowMaxButton() && (\n                    <div\n                      className=\"Exchange-swap-max\"\n                      onClick={() => {\n                        setFromValueToMaximumAvailable();\n                        trackAction &&\n                          trackAction(\"Button clicked\", {\n                            buttonName: \"Max amount\",\n                          });\n                      }}\n                    >\n                      MAX\n                    </div>\n                  )}\n                </div>\n                <div>\n                  <TokenSelector\n                    label=\"Pay\"\n                    chainId={chainId}\n                    tokenAddress={fromTokenAddress}\n                    onSelectToken={onSelectFromToken}\n                    tokens={fromTokens}\n                    infoTokens={infoTokens}\n                    showMintingCap={false}\n                    showTokenImgInDropdown={true}\n                    trackAction={trackAction}\n                  />\n                </div>\n              </div>\n            </div>\n            <div className=\"Exchange-swap-ball-container\">\n              <div className=\"Exchange-swap-ball\" onClick={switchTokens}>\n                <IoMdSwap className=\"Exchange-swap-ball-icon\" />\n              </div>\n            </div>\n            <div className=\"Exchange-swap-section\">\n              <div className=\"Exchange-swap-section-top\">\n                <div className=\"muted\">\n                  {toUsdMax && (\n                    <div className=\"Exchange-swap-usd\">\n                      {getToLabel()}: {formatAmount(toUsdMax, USD_DECIMALS, 2, true)} USD\n                    </div>\n                  )}\n                  {!toUsdMax && getToLabel()}\n                </div>\n                {toBalance && isSwap && (\n                  <div className=\"muted align-right\">Balance: {formatAmount(toBalance, toToken.decimals, 4, true)}</div>\n                )}\n                {(isLong || isShort) && hasLeverageOption && (\n                  <div className=\"muted align-right\">Leverage: {parseFloat(leverageOption).toFixed(2)}x</div>\n                )}\n              </div>\n              <div className=\"Exchange-swap-section-bottom\">\n                <div>\n                  <input\n                    type=\"number\"\n                    min=\"0\"\n                    placeholder=\"0.0\"\n                    className=\"Exchange-swap-input\"\n                    value={toValue}\n                    onChange={onToValueChange}\n                    onKeyDown={preventStrangeNumberInputs}\n                  />\n                </div>\n                <div>\n                  <TokenSelector\n                    label={getTokenLabel()}\n                    chainId={chainId}\n                    tokenAddress={toTokenAddress}\n                    onSelectToken={onSelectToToken}\n                    tokens={toTokens}\n                    infoTokens={infoTokens}\n                    showTokenImgInDropdown={true}\n                    trackAction={trackAction}\n                  />\n                </div>\n              </div>\n            </div>\n          </React.Fragment>\n        )}\n        {showSizeSection && (\n          <div className=\"Exchange-swap-section\">\n            <div className=\"Exchange-swap-section-top\">\n              <div className=\"muted\">Sell, USD</div>\n              {existingPosition && (\n                <div\n                  className=\"muted align-right clickable\"\n                  onClick={() => {\n                    setSellValue(formatAmountFree(existingPosition.size, USD_DECIMALS, 2));\n                  }}\n                >\n                  Position: {formatAmount(existingPosition.size, USD_DECIMALS, 2, true)}\n                </div>\n              )}\n            </div>\n            <div className=\"Exchange-swap-section-bottom\">\n              <div className=\"Exchange-swap-input-container\">\n                <input\n                  type=\"number\"\n                  min=\"0\"\n                  placeholder=\"0.0\"\n                  className=\"Exchange-swap-input\"\n                  value={sellValue}\n                  onChange={onSellChange}\n                  onKeyDown={preventStrangeNumberInputs}\n                />\n                {existingPosition && sellValue !== formatAmountFree(existingPosition.size, USD_DECIMALS, 2) && (\n                  <div\n                    className=\"Exchange-swap-max\"\n                    onClick={() => {\n                      setSellValue(formatAmountFree(existingPosition.size, USD_DECIMALS, 2));\n                    }}\n                  >\n                    MAX\n                  </div>\n                )}\n              </div>\n              <div>\n                <TokenSelector\n                  label=\"To\"\n                  chainId={chainId}\n                  tokenAddress={toTokenAddress}\n                  onSelectToken={onSelectToToken}\n                  tokens={toTokens}\n                  infoTokens={infoTokens}\n                  trackAction={trackAction}\n                />\n              </div>\n            </div>\n          </div>\n        )}\n        {showTriggerRatioSection && (\n          <div className=\"Exchange-swap-section\">\n            <div className=\"Exchange-swap-section-top\">\n              <div className=\"muted\">Price</div>\n              {fromTokenInfo && toTokenInfo && (\n                <div\n                  className=\"muted align-right clickable\"\n                  onClick={() => {\n                    setTriggerRatioValue(\n                      formatAmountFree(\n                        getExchangeRate(fromTokenInfo, toTokenInfo, triggerRatioInverted),\n                        USD_DECIMALS,\n                        10\n                      )\n                    );\n                  }}\n                >\n                  {formatAmount(getExchangeRate(fromTokenInfo, toTokenInfo, triggerRatioInverted), USD_DECIMALS, 4)}\n                </div>\n              )}\n            </div>\n            <div className=\"Exchange-swap-section-bottom\">\n              <div className=\"Exchange-swap-input-container\">\n                <input\n                  type=\"number\"\n                  min=\"0\"\n                  placeholder=\"0.0\"\n                  className=\"Exchange-swap-input small\"\n                  value={triggerRatioValue}\n                  onChange={onTriggerRatioChange}\n                  onKeyDown={preventStrangeNumberInputs}\n                />\n              </div>\n              {(() => {\n                if (!toTokenInfo) return;\n                if (!fromTokenInfo) return;\n                const [tokenA, tokenB] = triggerRatioInverted\n                  ? [toTokenInfo, fromTokenInfo]\n                  : [fromTokenInfo, toTokenInfo];\n                return (\n                  <div className=\"PositionEditor-token-symbol\">\n                    {tokenA.symbol}&nbsp;per&nbsp;{tokenB.symbol}\n                  </div>\n                );\n              })()}\n            </div>\n          </div>\n        )}\n        {showTriggerPriceSection && (\n          <div className=\"Exchange-swap-section\">\n            <div className=\"Exchange-swap-section-top\">\n              <div className=\"muted\">Price</div>\n              <div\n                className=\"muted align-right clickable\"\n                onClick={() => {\n                  setTriggerPriceValue(formatAmountFree(entryMarkPrice, USD_DECIMALS, 2));\n                }}\n              >\n                Mark: {formatAmount(entryMarkPrice, USD_DECIMALS, 2, true)}\n              </div>\n            </div>\n            <div className=\"Exchange-swap-section-bottom\">\n              <div className=\"Exchange-swap-input-container\">\n                <input\n                  type=\"number\"\n                  min=\"0\"\n                  placeholder=\"0.0\"\n                  className=\"Exchange-swap-input\"\n                  value={triggerPriceValue}\n                  onChange={onTriggerPriceChange}\n                  onKeyDown={preventStrangeNumberInputs}\n                />\n              </div>\n              <div className=\"PositionEditor-token-symbol\">USD</div>\n            </div>\n          </div>\n        )}\n        {isSwap && (\n          <div className=\"Exchange-swap-box-info\">\n            <ExchangeInfoRow label=\"Fees\">\n              <div>\n                {!fees && \"-\"}\n                {fees && (\n                  <div>\n                    {formatAmount(feeBps, 2, 2, false)}%&nbsp; ({formatAmount(fees, fromToken.decimals, 4, true)}{\" \"}\n                    {fromToken.symbol}: ${formatAmount(feesUsd, USD_DECIMALS, 2, true)})\n                  </div>\n                )}\n              </div>\n            </ExchangeInfoRow>\n          </div>\n        )}\n        {(isLong || isShort) && (\n          <div className=\"Exchange-leverage-box\">\n            <LeverageInput value={leverageOption} onChange={setLeverageOption} max={30.5} min={1.1} step={0.01} />\n            {isShort && (\n              <div className=\"Exchange-info-row\">\n                <div className=\"Exchange-info-label\">Profits In</div>\n                <div className=\"align-right\">\n                  <TokenSelector\n                    label=\"Profits In\"\n                    chainId={chainId}\n                    tokenAddress={shortCollateralAddress}\n                    onSelectToken={onSelectShortCollateralAddress}\n                    tokens={stableTokens}\n                    showTokenImgInDropdown={true}\n                    trackAction={trackAction}\n                  />\n                </div>\n              </div>\n            )}\n            {isLong && (\n              <div className=\"Exchange-info-row\">\n                <div className=\"Exchange-info-label\">Profits In</div>\n                <div className=\"align-right strong\">{toToken.symbol}</div>\n              </div>\n            )}\n            <div className=\"Exchange-info-row\">\n              <div className=\"Exchange-info-label\">Leverage</div>\n              <div className=\"align-right\">\n                {hasExistingPosition && toAmount && toAmount.gt(0) && (\n                  <div className=\"inline-block muted\">\n                    {formatAmount(existingPosition.leverage, 4, 2)}x\n                    <BsArrowRight className=\"transition-arrow\" />\n                  </div>\n                )}\n                {toAmount && leverage && leverage.gt(0) && `${formatAmount(leverage, 4, 2)}x`}\n                {!toAmount && leverage && leverage.gt(0) && `-`}\n                {leverage && leverage.eq(0) && `-`}\n              </div>\n            </div>\n            <div className=\"Exchange-info-row\">\n              <div className=\"Exchange-info-label\">Entry Price</div>\n              <div className=\"align-right\">\n                {hasExistingPosition && toAmount && toAmount.gt(0) && (\n                  <div className=\"inline-block muted\">\n                    ${formatAmount(existingPosition.averagePrice, USD_DECIMALS, 2, true)}\n                    <BsArrowRight className=\"transition-arrow\" />\n                  </div>\n                )}\n                {nextAveragePrice && `$${formatAmount(nextAveragePrice, USD_DECIMALS, 2, true)}`}\n                {!nextAveragePrice && `-`}\n              </div>\n            </div>\n            <div className=\"Exchange-info-row\">\n              <div className=\"Exchange-info-label\">Liq. Price</div>\n              <div className=\"align-right\">\n                {hasExistingPosition && toAmount && toAmount.gt(0) && (\n                  <div className=\"inline-block muted\">\n                    ${formatAmount(existingLiquidationPrice, USD_DECIMALS, 2, true)}\n                    <BsArrowRight className=\"transition-arrow\" />\n                  </div>\n                )}\n                {toAmount &&\n                  displayLiquidationPrice &&\n                  `$${formatAmount(displayLiquidationPrice, USD_DECIMALS, 2, true)}`}\n                {!toAmount && displayLiquidationPrice && `-`}\n                {!displayLiquidationPrice && `-`}\n              </div>\n            </div>\n            <ExchangeInfoRow label=\"Fees\">\n              <div>\n                {!feesUsd && \"-\"}\n                {feesUsd && (\n                  <Tooltip\n                    handle={`$${formatAmount(feesUsd, USD_DECIMALS, 2, true)}`}\n                    position=\"right-bottom\"\n                    renderContent={() => {\n                      return (\n                        <>\n                          {swapFees && (\n                            <div>\n                              {collateralToken.symbol} is required for collateral. <br />\n                              <br />\n                              Swap {fromToken.symbol} to {collateralToken.symbol} Fee: $\n                              {formatAmount(swapFees, USD_DECIMALS, 2, true)}\n                              <br />\n                              <br />\n                            </div>\n                          )}\n                          <div>\n                            Position Fee ({MARGIN_FEE_BASIS_POINTS / 100}% of position size): $\n                            {formatAmount(positionFee, USD_DECIMALS, 2, true)}\n                          </div>\n                        </>\n                      );\n                    }}\n                  />\n                )}\n              </div>\n            </ExchangeInfoRow>\n          </div>\n        )}\n        <div className=\"Exchange-swap-button-container\">\n          <button\n            className=\"App-cta Exchange-swap-button\"\n            onClick={() => {\n              const buttonText = getPrimaryText();\n              onClickPrimary();\n              if (buttonText.includes(\"Approve\")) {\n                trackTrade(1, fromToken?.symbol);\n                trackAction &&\n                  trackAction(\"Button clicked\", {\n                    buttonName: \"Approve\",\n                    fromToken: fromToken?.symbol,\n                  });\n              } else {\n                trackAction &&\n                  trackAction(\"Button clicked\", {\n                    buttonName: buttonText,\n                  });\n              }\n            }}\n            disabled={!isPrimaryEnabled()}\n          >\n            {getPrimaryText()}\n          </button>\n        </div>\n      </div>\n      {isSwap && (\n        <div className=\"Exchange-swap-market-box App-box App-box-border\">\n          <div className=\"Exchange-swap-market-box-title\">Swap</div>\n          <div className=\"App-card-divider\"></div>\n          <div className=\"Exchange-info-row\">\n            <div className=\"Exchange-info-label\">{fromToken.symbol} Price</div>\n            <div className=\"align-right\">\n              {fromTokenInfo && formatAmount(fromTokenInfo.minPrice, USD_DECIMALS, 2, true)} USD\n            </div>\n          </div>\n          <div className=\"Exchange-info-row\">\n            <div className=\"Exchange-info-label\">{toToken.symbol} Price</div>\n            <div className=\"align-right\">\n              {toTokenInfo && formatAmount(toTokenInfo.maxPrice, USD_DECIMALS, 2, true)} USD\n            </div>\n          </div>\n          {!isMarketOrder && (\n            <ExchangeInfoRow label=\"Price\">\n              {getExchangeRateDisplay(getExchangeRate(fromTokenInfo, toTokenInfo), fromToken, toToken)}\n            </ExchangeInfoRow>\n          )}\n        </div>\n      )}\n      {(isLong || isShort) && (\n        <div className=\"Exchange-swap-market-box App-box App-box-border\">\n          <div className=\"Exchange-swap-market-box-title\">\n            {isLong ? \"Long\" : \"Short\"}&nbsp;{toToken.symbol}\n          </div>\n          <div className=\"App-card-divider\"></div>\n          <div className=\"Exchange-info-row\">\n            <div className=\"Exchange-info-label\">Entry Price</div>\n            <div className=\"align-right\">\n              <Tooltip\n                handle={`${formatAmount(entryMarkPrice, USD_DECIMALS, 2, true)} USD`}\n                position=\"right-bottom\"\n                renderContent={() => {\n                  return (\n                    <>\n                      The position will be opened at {formatAmount(entryMarkPrice, USD_DECIMALS, 2, true)} USD with a\n                      max slippage of {parseFloat(savedSlippageAmount / 100.0).toFixed(2)}%.\n                      <br />\n                      <br />\n                      The slippage amount can be configured under Settings, found by clicking on your address at the top\n                      right of the page after connecting your wallet.\n                      <br />\n                      <br />\n                      <a\n                        href=\"https://swaps.docs.mycelium.xyz/quick-start-guide/2.-how-to-trade\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        More Info\n                      </a>\n                    </>\n                  );\n                }}\n              />\n            </div>\n          </div>\n          <div className=\"Exchange-info-row\">\n            <div className=\"Exchange-info-label\">Exit Price</div>\n            <div className=\"align-right\">\n              <Tooltip\n                handle={`${formatAmount(exitMarkPrice, USD_DECIMALS, 2, true)} USD`}\n                position=\"right-bottom\"\n                renderContent={() => {\n                  return (\n                    <>\n                      If you have an existing position, the position will be closed at{\" \"}\n                      {formatAmount(exitMarkPrice, USD_DECIMALS, 2, true)} USD.\n                      <br />\n                      <br />\n                      This exit price will change with the price of the asset.\n                      <br />\n                      <br />\n                      <a\n                        href=\"https://swaps.docs.mycelium.xyz/quick-start-guide/2.-how-to-trade\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        More Info\n                      </a>\n                    </>\n                  );\n                }}\n              />\n            </div>\n          </div>\n          <div className=\"Exchange-info-row\">\n            <div className=\"Exchange-info-label\">Borrow Fee</div>\n            <div className=\"align-right\">\n              <Tooltip\n                handle={borrowFeeText}\n                position=\"right-bottom\"\n                renderContent={() => {\n                  return (\n                    <>\n                      {hasZeroBorrowFee && (\n                        <div>\n                          {isLong && \"There are more shorts than longs, borrow fees for longing is currently zero\"}\n                          {isShort && \"There are more longs than shorts, borrow fees for shorting is currently zero\"}\n                        </div>\n                      )}\n                      {!hasZeroBorrowFee && (\n                        <div>\n                          The borrow fee is calculated as (assets borrowed) / (total assets in pool) * 0.005% per hour.\n                          <br />\n                          <br />\n                          {isShort && `You can change the \"Profits In\" token above to find lower fees`}\n                        </div>\n                      )}\n                      <br />\n                      <a\n                        href=\"https://swaps.docs.mycelium.xyz/protocol-design/trading/fees#borrowing-fees\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        More Info\n                      </a>\n                    </>\n                  );\n                }}\n              >\n                {!hasZeroBorrowFee && null}\n              </Tooltip>\n            </div>\n          </div>\n          {renderAvailableLongLiquidity()}\n          {hasMaxAvailableShort && (\n            <div className=\"Exchange-info-row\">\n              \n            </div>\n          )}\n        </div>\n      )}\n      <div className=\"Exchange-swap-market-box App-box App-box-border\">\n        <div className=\"Exchange-swap-market-box-title\">Useful Links</div>\n        <div className=\"App-card-divider\"></div>\n        <div className=\"Exchange-info-row\">\n          <div className=\"Exchange-info-label-button\">\n            <a\n              href=\"https://arbitrex.gitbook.io/arbitrex/arbitrex/trading\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              Trading guide\n            </a>\n          </div>\n        </div>\n      </div>\n      {renderErrorModal()}\n      {renderOrdersToa()}\n      {isConfirming && (\n        <ConfirmationBox\n          isHigherSlippageAllowed={isHigherSlippageAllowed}\n          setIsHigherSlippageAllowed={setIsHigherSlippageAllowed}\n          orders={orders}\n          isSwap={isSwap}\n          isLong={isLong}\n          isMarketOrder={isMarketOrder}\n          orderOption={orderOption}\n          isShort={isShort}\n          fromToken={fromToken}\n          fromTokenInfo={fromTokenInfo}\n          toToken={toToken}\n          toTokenInfo={toTokenInfo}\n          toAmount={toAmount}\n          fromAmount={fromAmount}\n          feeBps={feeBps}\n          onConfirmationClick={onConfirmationClick}\n          setIsConfirming={setIsConfirming}\n          hasExistingPosition={hasExistingPosition}\n          shortCollateralAddress={shortCollateralAddress}\n          shortCollateralToken={shortCollateralToken}\n          leverage={leverage}\n          existingPosition={existingPosition}\n          existingLiquidationPrice={existingLiquidationPrice}\n          displayLiquidationPrice={displayLiquidationPrice}\n          nextAveragePrice={nextAveragePrice}\n          triggerPriceUsd={triggerPriceUsd}\n          triggerRatio={triggerRatio}\n          fees={fees}\n          feesUsd={feesUsd}\n          isSubmitting={isSubmitting}\n          isPendingConfirmation={isPendingConfirmation}\n          fromUsdMin={fromUsdMin}\n          toUsdMax={toUsdMax}\n          collateralTokenAddress={collateralTokenAddress}\n          infoTokens={infoTokens}\n          chainId={chainId}\n          trackAction={trackAction}\n          trackTrade={trackTrade}\n        />\n      )}\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}