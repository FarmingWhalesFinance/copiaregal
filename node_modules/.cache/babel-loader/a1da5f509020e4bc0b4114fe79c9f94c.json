{"ast":null,"code":"import { __extends } from \"tslib\";\nexport function isString(obj) {\n  return typeof obj === 'string';\n}\nexport function isNumber(obj) {\n  return typeof obj === 'number';\n}\nexport function isFunction(obj) {\n  return typeof obj === 'function';\n}\nexport function isPlainObject(obj) {\n  return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === 'object';\n}\n\nfunction hasUser(event) {\n  var _a, _b, _c;\n\n  var id = (_c = (_b = (_a = event.userId) !== null && _a !== void 0 ? _a : event.anonymousId) !== null && _b !== void 0 ? _b : event.groupId) !== null && _c !== void 0 ? _c : event.previousId;\n  return isString(id);\n}\n\nvar ValidationError =\n/** @class */\nfunction (_super) {\n  __extends(ValidationError, _super);\n\n  function ValidationError(field, message) {\n    var _this = _super.call(this, message) || this;\n\n    _this.field = field;\n    return _this;\n  }\n\n  return ValidationError;\n}(Error);\n\nfunction validate(ctx) {\n  var _a;\n\n  var eventType = ctx && ctx.event && ctx.event.type;\n  var event = ctx.event;\n\n  if (event === undefined) {\n    throw new ValidationError('event', 'Event is missing');\n  }\n\n  if (!isString(eventType)) {\n    throw new ValidationError('event', 'Event is not a string');\n  }\n\n  if (eventType === 'track' && !isString(event.event)) {\n    throw new ValidationError('event', 'Event is not a string');\n  }\n\n  var props = (_a = event.properties) !== null && _a !== void 0 ? _a : event.traits;\n\n  if (eventType !== 'alias' && !isPlainObject(props)) {\n    throw new ValidationError('properties', 'properties is not an object');\n  }\n\n  if (!hasUser(event)) {\n    throw new ValidationError('userId', 'Missing userId or anonymousId');\n  }\n\n  return ctx;\n}\n\nexport var validation = {\n  name: 'Event Validation',\n  type: 'before',\n  version: '1.0.0',\n  isLoaded: function () {\n    return true;\n  },\n  load: function () {\n    return Promise.resolve();\n  },\n  track: validate,\n  identify: validate,\n  page: validate,\n  alias: validate,\n  group: validate,\n  screen: validate\n};","map":{"version":3,"sources":["../../../../src/plugins/validation/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __extends } from \"tslib\";\nexport function isString(obj) {\n    return typeof obj === 'string';\n}\nexport function isNumber(obj) {\n    return typeof obj === 'number';\n}\nexport function isFunction(obj) {\n    return typeof obj === 'function';\n}\nexport function isPlainObject(obj) {\n    return (Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === 'object');\n}\nfunction hasUser(event) {\n    var _a, _b, _c;\n    var id = (_c = (_b = (_a = event.userId) !== null && _a !== void 0 ? _a : event.anonymousId) !== null && _b !== void 0 ? _b : event.groupId) !== null && _c !== void 0 ? _c : event.previousId;\n    return isString(id);\n}\nvar ValidationError = /** @class */ (function (_super) {\n    __extends(ValidationError, _super);\n    function ValidationError(field, message) {\n        var _this = _super.call(this, message) || this;\n        _this.field = field;\n        return _this;\n    }\n    return ValidationError;\n}(Error));\nfunction validate(ctx) {\n    var _a;\n    var eventType = ctx && ctx.event && ctx.event.type;\n    var event = ctx.event;\n    if (event === undefined) {\n        throw new ValidationError('event', 'Event is missing');\n    }\n    if (!isString(eventType)) {\n        throw new ValidationError('event', 'Event is not a string');\n    }\n    if (eventType === 'track' && !isString(event.event)) {\n        throw new ValidationError('event', 'Event is not a string');\n    }\n    var props = (_a = event.properties) !== null && _a !== void 0 ? _a : event.traits;\n    if (eventType !== 'alias' && !isPlainObject(props)) {\n        throw new ValidationError('properties', 'properties is not an object');\n    }\n    if (!hasUser(event)) {\n        throw new ValidationError('userId', 'Missing userId or anonymousId');\n    }\n    return ctx;\n}\nexport var validation = {\n    name: 'Event Validation',\n    type: 'before',\n    version: '1.0.0',\n    isLoaded: function () { return true; },\n    load: function () { return Promise.resolve(); },\n    track: validate,\n    identify: validate,\n    page: validate,\n    alias: validate,\n    group: validate,\n    screen: validate,\n};\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}