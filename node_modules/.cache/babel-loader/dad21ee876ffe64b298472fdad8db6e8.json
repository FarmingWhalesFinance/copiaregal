{"ast":null,"code":"import { ethers } from \"ethers\";\nimport { expandDecimals, getTokenInfo, MARKET, PRECISION, USDG_ADDRESS } from \"../Helpers\";\nexport function getUsd(amount, tokenAddress, max, infoTokens, orderOption, triggerPriceUsd) {\n  if (!amount) {\n    return;\n  }\n\n  if (tokenAddress === USDG_ADDRESS) {\n    return amount.mul(PRECISION).div(expandDecimals(1, 18));\n  }\n\n  const info = getTokenInfo(infoTokens, tokenAddress);\n  const price = getTriggerPrice(tokenAddress, max, info, orderOption, triggerPriceUsd);\n\n  if (!price) {\n    return;\n  }\n\n  return amount.mul(price).div(expandDecimals(1, info.decimals));\n} // opts: {\n// max?: boolean;\n// overridePrice?: BigNumber;\n// } = {}\n\nexport function getTokenAmountFromUsd(infoTokens, tokenAddress, usdAmount) {\n  let opts = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n  if (!usdAmount) {\n    return;\n  }\n\n  if (tokenAddress === USDG_ADDRESS) {\n    return usdAmount.mul(expandDecimals(1, 18)).div(PRECISION);\n  }\n\n  const info = getTokenInfo(infoTokens, tokenAddress);\n\n  if (!info) {\n    return;\n  }\n\n  let price;\n\n  if (info.isStable) {\n    price = expandDecimals(1, 30);\n  } else {\n    price = opts.overridePrice || (opts.max ? info.maxPrice : info.minPrice);\n  }\n\n  if (!ethers.BigNumber.isBigNumber(price) || price.lte(0)) {\n    return;\n  }\n\n  return usdAmount.mul(expandDecimals(1, info.decimals)).div(price);\n}\nexport function getTriggerPrice(_tokenAddress, max, info, orderOption, triggerPriceUsd) {\n  // Limit/stop orders are executed with price specified by user\n  if (orderOption && orderOption !== MARKET && triggerPriceUsd) {\n    return triggerPriceUsd;\n  } // Market orders are executed with current market price\n\n\n  if (!info) {\n    return;\n  }\n\n  if (max && !info.maxPrice) {\n    return;\n  }\n\n  if (!max && !info.minPrice) {\n    return;\n  }\n\n  return max ? info.maxPrice : info.minPrice;\n}","map":{"version":3,"names":["ethers","expandDecimals","getTokenInfo","MARKET","PRECISION","USDG_ADDRESS","getUsd","amount","tokenAddress","max","infoTokens","orderOption","triggerPriceUsd","mul","div","info","price","getTriggerPrice","decimals","getTokenAmountFromUsd","usdAmount","opts","isStable","overridePrice","maxPrice","minPrice","BigNumber","isBigNumber","lte","_tokenAddress"],"sources":["C:/Users/rober/Documents/swaps-client/src/utils/tokens.ts"],"sourcesContent":["import { BigNumber, ethers } from \"ethers\";\nimport { expandDecimals, getTokenInfo, MARKET, PRECISION, USDG_ADDRESS } from \"../Helpers\";\nimport {InfoTokens, TokenInfo} from \"../types/tokens\";\n\nexport function getUsd(\n  amount: BigNumber,\n  tokenAddress: string,\n  max: boolean,\n  infoTokens: InfoTokens,\n  orderOption?: string,\n  triggerPriceUsd?: BigNumber\n) {\n  if (!amount) {\n    return;\n  }\n  if (tokenAddress === USDG_ADDRESS) {\n    return amount.mul(PRECISION).div(expandDecimals(1, 18));\n  }\n  const info = getTokenInfo(infoTokens, tokenAddress);\n  const price = getTriggerPrice(tokenAddress, max, info, orderOption, triggerPriceUsd);\n  if (!price) {\n    return;\n  }\n\n  return amount.mul(price).div(expandDecimals(1, info.decimals));\n}\n\n// opts: {\n  // max?: boolean;\n  // overridePrice?: BigNumber;\n// } = {}\nexport function getTokenAmountFromUsd(\n  infoTokens: InfoTokens,\n  tokenAddress: string,\n  usdAmount?: BigNumber,\n  opts: {\n    max?: boolean;\n    overridePrice?: BigNumber;\n  } = {}\n) {\n  if (!usdAmount) {\n    return;\n  }\n\n  if (tokenAddress === USDG_ADDRESS) {\n    return usdAmount.mul(expandDecimals(1, 18)).div(PRECISION);\n  }\n\n  const info = getTokenInfo(infoTokens, tokenAddress);\n\n  if (!info) {\n    return;\n  }\n\n  let price: BigNumber\n  if (info.isStable) {\n    price = expandDecimals(1, 30);\n  } else {\n    price = opts.overridePrice || (opts.max ? info.maxPrice : info.minPrice);\n  }\n\n\n  if (!ethers.BigNumber.isBigNumber(price) || price.lte(0)) {\n    return;\n  }\n\n  return usdAmount.mul(expandDecimals(1, info.decimals)).div(price);\n}\n\nexport function getTriggerPrice(\n  _tokenAddress: string,\n  max: boolean,\n  info: TokenInfo,\n  orderOption?: string,\n  triggerPriceUsd?: BigNumber\n) {\n  // Limit/stop orders are executed with price specified by user\n  if (orderOption && orderOption !== MARKET && triggerPriceUsd) {\n    return triggerPriceUsd;\n  }\n\n  // Market orders are executed with current market price\n  if (!info) {\n    return;\n  }\n  if (max && !info.maxPrice) {\n    return;\n  }\n  if (!max && !info.minPrice) {\n    return;\n  }\n  return max ? info.maxPrice : info.minPrice;\n}\n"],"mappings":"AAAA,SAAoBA,MAApB,QAAkC,QAAlC;AACA,SAASC,cAAT,EAAyBC,YAAzB,EAAuCC,MAAvC,EAA+CC,SAA/C,EAA0DC,YAA1D,QAA8E,YAA9E;AAGA,OAAO,SAASC,MAAT,CACLC,MADK,EAELC,YAFK,EAGLC,GAHK,EAILC,UAJK,EAKLC,WALK,EAMLC,eANK,EAOL;EACA,IAAI,CAACL,MAAL,EAAa;IACX;EACD;;EACD,IAAIC,YAAY,KAAKH,YAArB,EAAmC;IACjC,OAAOE,MAAM,CAACM,GAAP,CAAWT,SAAX,EAAsBU,GAAtB,CAA0Bb,cAAc,CAAC,CAAD,EAAI,EAAJ,CAAxC,CAAP;EACD;;EACD,MAAMc,IAAI,GAAGb,YAAY,CAACQ,UAAD,EAAaF,YAAb,CAAzB;EACA,MAAMQ,KAAK,GAAGC,eAAe,CAACT,YAAD,EAAeC,GAAf,EAAoBM,IAApB,EAA0BJ,WAA1B,EAAuCC,eAAvC,CAA7B;;EACA,IAAI,CAACI,KAAL,EAAY;IACV;EACD;;EAED,OAAOT,MAAM,CAACM,GAAP,CAAWG,KAAX,EAAkBF,GAAlB,CAAsBb,cAAc,CAAC,CAAD,EAAIc,IAAI,CAACG,QAAT,CAApC,CAAP;AACD,C,CAED;AACE;AACA;AACF;;AACA,OAAO,SAASC,qBAAT,CACLT,UADK,EAELF,YAFK,EAGLY,SAHK,EAQL;EAAA,IAJAC,IAIA,uEADI,EACJ;;EACA,IAAI,CAACD,SAAL,EAAgB;IACd;EACD;;EAED,IAAIZ,YAAY,KAAKH,YAArB,EAAmC;IACjC,OAAOe,SAAS,CAACP,GAAV,CAAcZ,cAAc,CAAC,CAAD,EAAI,EAAJ,CAA5B,EAAqCa,GAArC,CAAyCV,SAAzC,CAAP;EACD;;EAED,MAAMW,IAAI,GAAGb,YAAY,CAACQ,UAAD,EAAaF,YAAb,CAAzB;;EAEA,IAAI,CAACO,IAAL,EAAW;IACT;EACD;;EAED,IAAIC,KAAJ;;EACA,IAAID,IAAI,CAACO,QAAT,EAAmB;IACjBN,KAAK,GAAGf,cAAc,CAAC,CAAD,EAAI,EAAJ,CAAtB;EACD,CAFD,MAEO;IACLe,KAAK,GAAGK,IAAI,CAACE,aAAL,KAAuBF,IAAI,CAACZ,GAAL,GAAWM,IAAI,CAACS,QAAhB,GAA2BT,IAAI,CAACU,QAAvD,CAAR;EACD;;EAGD,IAAI,CAACzB,MAAM,CAAC0B,SAAP,CAAiBC,WAAjB,CAA6BX,KAA7B,CAAD,IAAwCA,KAAK,CAACY,GAAN,CAAU,CAAV,CAA5C,EAA0D;IACxD;EACD;;EAED,OAAOR,SAAS,CAACP,GAAV,CAAcZ,cAAc,CAAC,CAAD,EAAIc,IAAI,CAACG,QAAT,CAA5B,EAAgDJ,GAAhD,CAAoDE,KAApD,CAAP;AACD;AAED,OAAO,SAASC,eAAT,CACLY,aADK,EAELpB,GAFK,EAGLM,IAHK,EAILJ,WAJK,EAKLC,eALK,EAML;EACA;EACA,IAAID,WAAW,IAAIA,WAAW,KAAKR,MAA/B,IAAyCS,eAA7C,EAA8D;IAC5D,OAAOA,eAAP;EACD,CAJD,CAMA;;;EACA,IAAI,CAACG,IAAL,EAAW;IACT;EACD;;EACD,IAAIN,GAAG,IAAI,CAACM,IAAI,CAACS,QAAjB,EAA2B;IACzB;EACD;;EACD,IAAI,CAACf,GAAD,IAAQ,CAACM,IAAI,CAACU,QAAlB,EAA4B;IAC1B;EACD;;EACD,OAAOhB,GAAG,GAAGM,IAAI,CAACS,QAAR,GAAmBT,IAAI,CAACU,QAAlC;AACD"},"metadata":{},"sourceType":"module"}