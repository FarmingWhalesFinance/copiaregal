{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rober\\\\Documents\\\\swaps-client\\\\src\\\\components\\\\Exchange\\\\TradeHistory.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useCallback, useMemo } from \"react\";\nimport { ethers } from \"ethers\";\nimport { Link } from \"react-router-dom\";\nimport Tooltip from \"../../components/Tooltip/Tooltip\";\nimport { USD_DECIMALS, MAX_LEVERAGE, BASIS_POINTS_DIVISOR, LIQUIDATION_FEE, formatAmount, getExplorerUrl, formatDateTime, deserialize, getExchangeRateDisplay, bigNumberify } from \"../../Helpers\";\nimport { useTrades, useLiquidationsData } from \"../../Api\";\nimport { getContract } from \"../../Addresses\";\nimport \"./TradeHistory.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst {\n  AddressZero\n} = ethers.constants;\n\nfunction getPositionDisplay(increase, indexToken, isLong, sizeDelta) {\n  const symbol = indexToken ? indexToken.isWrapped ? indexToken.baseSymbol : indexToken.symbol : \"\";\n  return `\n    ${increase ? \"Increase\" : \"Decrease\"} ${symbol} ${isLong ? \"Long\" : \"Short\"}\n    ${increase ? \"+\" : \"-\"}${formatAmount(sizeDelta, USD_DECIMALS, 2, true)} USD`;\n}\n\nfunction getOrderActionTitle(action) {\n  let actionDisplay;\n\n  if (action.startsWith(\"Create\")) {\n    actionDisplay = \"Create\";\n  } else if (action.startsWith(\"Cancel\")) {\n    actionDisplay = \"Cancel\";\n  } else {\n    actionDisplay = \"Update\";\n  }\n\n  return `${actionDisplay} Order`;\n}\n\nfunction renderLiquidationTooltip(liquidationData, label) {\n  const minCollateral = liquidationData.size.mul(BASIS_POINTS_DIVISOR).div(MAX_LEVERAGE);\n  const text = liquidationData.type === \"full\" ? \"This position was liquidated as the max leverage of 100x was exceeded\" : \"Max leverage of 100x was exceeded, the remaining collateral after deducting losses and fees have been sent back to your account\";\n  return /*#__PURE__*/_jsxDEV(Tooltip, {\n    position: \"left-top\",\n    handle: label,\n    renderContent: () => /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [text, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 11\n      }, this), \"Initial collateral: $\", formatAmount(liquidationData.collateral, USD_DECIMALS, 2, true), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 11\n      }, this), \"Min required collateral: $\", formatAmount(minCollateral, USD_DECIMALS, 2, true), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 11\n      }, this), \"Borrow fee: $\", formatAmount(liquidationData.borrowFee, USD_DECIMALS, 2, true), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 11\n      }, this), \"PnL: -$\", formatAmount(liquidationData.loss, USD_DECIMALS, 2, true), liquidationData.type === \"full\" && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\"Liquidation fee: $\", formatAmount(LIQUIDATION_FEE, 30, 2, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 47\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 5\n  }, this);\n}\n\nfunction getLiquidationData(liquidationsDataMap, key, timestamp) {\n  return liquidationsDataMap && liquidationsDataMap[`${key}:${timestamp}`];\n}\n\nexport default function TradeHistory(props) {\n  _s();\n\n  const {\n    account,\n    infoTokens,\n    getTokenInfo,\n    chainId,\n    nativeTokenAddress\n  } = props;\n  const {\n    trades,\n    updateTrades\n  } = useTrades(chainId, account);\n  const liquidationsData = useLiquidationsData(chainId, account);\n  const liquidationsDataMap = useMemo(() => {\n    if (!liquidationsData) {\n      return null;\n    }\n\n    return liquidationsData.reduce((memo, item) => {\n      const liquidationKey = `${item.key}:${item.timestamp}`;\n      memo[liquidationKey] = item;\n      return memo;\n    }, {});\n  }, [liquidationsData]);\n  useEffect(() => {\n    const interval = setInterval(() => {\n      updateTrades(undefined, true);\n    }, 10 * 1000);\n    return () => clearInterval(interval);\n  }, [updateTrades]);\n  const getMsg = useCallback(trade => {\n    const tradeData = trade.data;\n    const params = JSON.parse(tradeData.params);\n    const defaultMsg = \"\";\n\n    if (tradeData.action === \"BuyUSDG\") {\n      const token = getTokenInfo(infoTokens, params.token, true, nativeTokenAddress);\n\n      if (!token) {\n        return defaultMsg;\n      }\n\n      return `Swap ${formatAmount(params.tokenAmount, token.decimals, 4, true)} ${token.symbol} for ${formatAmount(params.usdgAmount, 18, 4, true)} USDG`;\n    }\n\n    if (tradeData.action === \"SellUSDG\") {\n      const token = getTokenInfo(infoTokens, params.token, true, nativeTokenAddress);\n\n      if (!token) {\n        return defaultMsg;\n      }\n\n      return `Swap ${formatAmount(params.usdgAmount, 18, 4, true)} USDG for ${formatAmount(params.tokenAmount, token.decimals, 4, true)} ${token.symbol}`;\n    }\n\n    if (tradeData.action === \"Swap\") {\n      const tokenIn = getTokenInfo(infoTokens, params.tokenIn, true, nativeTokenAddress);\n      const tokenOut = getTokenInfo(infoTokens, params.tokenOut, true, nativeTokenAddress);\n\n      if (!tokenIn || !tokenOut) {\n        return defaultMsg;\n      }\n\n      return `Swap ${formatAmount(params.amountIn, tokenIn.decimals, 4, true)} ${tokenIn.symbol} for ${formatAmount(params.amountOut, tokenOut.decimals, 4, true)} ${tokenOut.symbol}`;\n    }\n\n    if (tradeData.action === \"CreateIncreasePosition\") {\n      const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      if (bigNumberify(params.sizeDelta).eq(0)) {\n        return `Request deposit into ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}`;\n      }\n\n      return `Request increase ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}, +${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)} USD, Acceptable Price: ${params.isLong ? \"<\" : \">\"} ${formatAmount(params.acceptablePrice, USD_DECIMALS, 2, true)} USD`;\n    }\n\n    if (tradeData.action === \"CreateDecreasePosition\") {\n      const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      if (bigNumberify(params.sizeDelta).eq(0)) {\n        return `Request withdrawal from ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}`;\n      }\n\n      return `Request decrease ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}, -${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)} USD, Acceptable Price: ${params.isLong ? \">\" : \"<\"} ${formatAmount(params.acceptablePrice, USD_DECIMALS, 2, true)} USD`;\n    }\n\n    if (tradeData.action === \"CancelIncreasePosition\") {\n      const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      if (bigNumberify(params.sizeDelta).eq(0)) {\n        return /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [\"Could not execute deposit into \", indexToken.symbol, \" \", params.isLong ? \"Long\" : \"Short\"]\n        }, void 0, true);\n      }\n\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [\"Could not increase \", indexToken.symbol, \" \", params.isLong ? \"Long\" : \"Short\", \",\", `+${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)}`, \" USD, Acceptable Price:\\xA0\", params.isLong ? \"<\" : \">\", \"\\xA0\", /*#__PURE__*/_jsxDEV(Tooltip, {\n          position: \"left-top\",\n          handle: `${formatAmount(params.acceptablePrice, USD_DECIMALS, 2, true)} USD`,\n          renderContent: () => /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: \"Try increasing the \\\"Allowed Slippage\\\", under the Settings menu on the top right\"\n          }, void 0, false)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true);\n    }\n\n    if (tradeData.action === \"CancelDecreasePosition\") {\n      const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      if (bigNumberify(params.sizeDelta).eq(0)) {\n        return `Could not execute withdrawal from ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}`;\n      }\n\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [\"Could not decrease \", indexToken.symbol, \" \", params.isLong ? \"Long\" : \"Short\", \",\", `+${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)}`, \" USD, Acceptable Price:\\xA0\", params.isLong ? \">\" : \"<\", \"\\xA0\", /*#__PURE__*/_jsxDEV(Tooltip, {\n          position: \"left-top\",\n          handle: `${formatAmount(params.acceptablePrice, USD_DECIMALS, 2, true)} USD`,\n          renderContent: () => /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: \"Try increasing the \\\"Allowed Slippage\\\", under the Settings menu on the top right\"\n          }, void 0, false)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true);\n    }\n\n    if (tradeData.action === \"IncreasePosition-Long\" || tradeData.action === \"IncreasePosition-Short\") {\n      var _params$flags;\n\n      if ((_params$flags = params.flags) !== null && _params$flags !== void 0 && _params$flags.isOrderExecution) {\n        return;\n      }\n\n      const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      if (bigNumberify(params.sizeDelta).eq(0)) {\n        return `Deposit ${formatAmount(params.collateralDelta, USD_DECIMALS, 2, true)} USD into ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}`;\n      }\n\n      return `Increase ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}, +${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)} USD, ${indexToken.symbol} Price: ${formatAmount(params.price, USD_DECIMALS, 2, true)} USD`;\n    }\n\n    if (tradeData.action === \"DecreasePosition-Long\" || tradeData.action === \"DecreasePosition-Short\") {\n      var _params$flags2, _params$flags3;\n\n      if ((_params$flags2 = params.flags) !== null && _params$flags2 !== void 0 && _params$flags2.isOrderExecution) {\n        return;\n      }\n\n      const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      if (bigNumberify(params.sizeDelta).eq(0)) {\n        return `Withdraw ${formatAmount(params.collateralDelta, USD_DECIMALS, 2, true)} USD from ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}`;\n      }\n\n      const isLiquidation = (_params$flags3 = params.flags) === null || _params$flags3 === void 0 ? void 0 : _params$flags3.isLiquidation;\n      const liquidationData = getLiquidationData(liquidationsDataMap, params.key, tradeData.timestamp);\n\n      if (isLiquidation && liquidationData) {\n        return /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [renderLiquidationTooltip(liquidationData, \"Partial Liquidation\"), \" \", indexToken.symbol, \" \", params.isLong ? \"Long\" : \"Short\", \", -\", formatAmount(params.sizeDelta, USD_DECIMALS, 2, true), \" USD,\", \" \", indexToken.symbol, \"\\xA0 Price: $\", formatAmount(params.price, USD_DECIMALS, 2, true), \" USD\"]\n        }, void 0, true);\n      }\n\n      const actionDisplay = isLiquidation ? \"Partially Liquidated\" : \"Decreased\";\n      return `\n        ${actionDisplay} ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"},\n        -${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)} USD,\n        ${indexToken.symbol} Price: ${formatAmount(params.price, USD_DECIMALS, 2, true)} USD\n      `;\n    }\n\n    if (tradeData.action === \"LiquidatePosition-Long\" || tradeData.action === \"LiquidatePosition-Short\") {\n      const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      const liquidationData = getLiquidationData(liquidationsDataMap, params.key, tradeData.timestamp);\n\n      if (liquidationData) {\n        return /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [renderLiquidationTooltip(liquidationData, \"Liquidated\"), \" \", indexToken.symbol, \" \", params.isLong ? \"Long\" : \"Short\", \", -\", formatAmount(params.size, USD_DECIMALS, 2, true), \" USD,\\xA0\", indexToken.symbol, \" Price: $\", formatAmount(params.markPrice, USD_DECIMALS, 2, true), \" USD\"]\n        }, void 0, true);\n      }\n\n      return `\n        Liquidated ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"},\n        -${formatAmount(params.size, USD_DECIMALS, 2, true)} USD,\n        ${indexToken.symbol} Price: ${formatAmount(params.markPrice, USD_DECIMALS, 2, true)} USD\n      `;\n    }\n\n    if ([\"ExecuteIncreaseOrder\", \"ExecuteDecreaseOrder\"].includes(tradeData.action)) {\n      const order = deserialize(params);\n      const indexToken = getTokenInfo(infoTokens, order.indexToken, true, nativeTokenAddress);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      const longShortDisplay = order.isLong ? \"Long\" : \"Short\";\n      const executionPriceDisplay = formatAmount(order.executionPrice, USD_DECIMALS, 2, true);\n      const sizeDeltaDisplay = `${order.type === \"Increase\" ? \"+\" : \"-\"}${formatAmount(order.sizeDelta, USD_DECIMALS, 2, true)}`;\n      const type = tradeData.action === \"ExecuteIncreaseOrder\" ? \"Increase\" : \"Decrease\";\n      return `\n        Execute Order: ${type} ${indexToken.symbol} ${longShortDisplay}\n        ${sizeDeltaDisplay} USD, Price: ${executionPriceDisplay} USD\n      `;\n    }\n\n    if ([\"CreateIncreaseOrder\", \"CancelIncreaseOrder\", \"UpdateIncreaseOrder\", \"CreateDecreaseOrder\", \"CancelDecreaseOrder\", \"UpdateDecreaseOrder\"].includes(tradeData.action)) {\n      const order = deserialize(params);\n      const indexToken = getTokenInfo(infoTokens, order.indexToken);\n\n      if (!indexToken) {\n        return defaultMsg;\n      }\n\n      const increase = tradeData.action.includes(\"Increase\");\n      const priceDisplay = `${order.triggerAboveThreshold ? \">\" : \"<\"} ${formatAmount(order.triggerPrice, USD_DECIMALS, 2, true)}`;\n      return `\n        ${getOrderActionTitle(tradeData.action)}:\n        ${getPositionDisplay(increase, indexToken, order.isLong, order.sizeDelta)},\n        Price: ${priceDisplay}\n      `;\n    }\n\n    if (tradeData.action === \"ExecuteSwapOrder\") {\n      const order = deserialize(params);\n      const nativeTokenAddress = getContract(chainId, \"NATIVE_TOKEN\");\n      const fromToken = getTokenInfo(infoTokens, order.path[0] === nativeTokenAddress ? AddressZero : order.path[0]);\n      const toToken = getTokenInfo(infoTokens, order.shouldUnwrap ? AddressZero : order.path[order.path.length - 1]);\n\n      if (!fromToken || !toToken) {\n        return defaultMsg;\n      }\n\n      const fromAmountDisplay = formatAmount(order.amountIn, fromToken.decimals, fromToken.isStable ? 2 : 4, true);\n      const toAmountDisplay = formatAmount(order.amountOut, toToken.decimals, toToken.isStable ? 2 : 4, true);\n      return `\n        Execute Order: Swap ${fromAmountDisplay} ${fromToken.symbol} for ${toAmountDisplay} ${toToken.symbol}\n      `;\n    }\n\n    if ([\"CreateSwapOrder\", \"UpdateSwapOrder\", \"CancelSwapOrder\"].includes(tradeData.action)) {\n      const order = deserialize(params);\n      const nativeTokenAddress = getContract(chainId, \"NATIVE_TOKEN\");\n      const fromToken = getTokenInfo(infoTokens, order.path[0] === nativeTokenAddress ? AddressZero : order.path[0]);\n      const toToken = getTokenInfo(infoTokens, order.shouldUnwrap ? AddressZero : order.path[order.path.length - 1]);\n\n      if (!fromToken || !toToken) {\n        return defaultMsg;\n      }\n\n      const amountInDisplay = fromToken ? formatAmount(order.amountIn, fromToken.decimals, fromToken.isStable ? 2 : 4, true) : \"\";\n      const minOutDisplay = toToken ? formatAmount(order.minOut, toToken.decimals, toToken.isStable ? 2 : 4, true) : \"\";\n      return `\n        ${getOrderActionTitle(tradeData.action)}:\n        Swap ${amountInDisplay} ${(fromToken === null || fromToken === void 0 ? void 0 : fromToken.symbol) || \"\"} for ${minOutDisplay} ${(toToken === null || toToken === void 0 ? void 0 : toToken.symbol) || \"\"},\n        Price: ${getExchangeRateDisplay(order.triggerRatio, fromToken, toToken)}`;\n    }\n  }, [getTokenInfo, infoTokens, nativeTokenAddress, chainId, liquidationsDataMap]);\n  const tradesWithMessages = useMemo(() => {\n    if (!trades) {\n      return [];\n    }\n\n    return trades.map(trade => ({\n      msg: getMsg(trade),\n      ...trade\n    })).filter(trade => trade.msg);\n  }, [trades, getMsg]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"TradeHistory\",\n    children: [tradesWithMessages.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Exchange-empty-positions-list-note App-card\",\n      children: \"No trades yet\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 430,\n      columnNumber: 9\n    }, this), tradesWithMessages.length > 0 && tradesWithMessages.map((trade, index) => {\n      const tradeData = trade.data;\n      const txUrl = getExplorerUrl(chainId) + \"tx/\" + tradeData.txnHash;\n      let msg = getMsg(trade);\n\n      if (!msg) {\n        return null;\n      }\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"TradeHistory-row App-box App-box-border\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"muted TradeHistory-time\",\n            children: [formatDateTime(tradeData.timestamp), (!account || account.length === 0) && /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\" \", \"(\", /*#__PURE__*/_jsxDEV(Link, {\n                to: `/actions/${tradeData.account}`,\n                children: tradeData.account\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 451,\n                columnNumber: 24\n              }, this), \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 449,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 446,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n            className: \"plain\",\n            href: txUrl,\n            target: \"_blank\",\n            rel: \"noopener noreferrer\",\n            children: msg\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 455,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 445,\n          columnNumber: 15\n        }, this)\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 13\n      }, this);\n    })]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 428,\n    columnNumber: 5\n  }, this);\n}\n\n_s(TradeHistory, \"XDHs/hm8zjyOnLS4t2mTDfqjr60=\", false, function () {\n  return [useTrades, useLiquidationsData];\n});\n\n_c = TradeHistory;\n\nvar _c;\n\n$RefreshReg$(_c, \"TradeHistory\");","map":{"version":3,"names":["React","useEffect","useCallback","useMemo","ethers","Link","Tooltip","USD_DECIMALS","MAX_LEVERAGE","BASIS_POINTS_DIVISOR","LIQUIDATION_FEE","formatAmount","getExplorerUrl","formatDateTime","deserialize","getExchangeRateDisplay","bigNumberify","useTrades","useLiquidationsData","getContract","AddressZero","constants","getPositionDisplay","increase","indexToken","isLong","sizeDelta","symbol","isWrapped","baseSymbol","getOrderActionTitle","action","actionDisplay","startsWith","renderLiquidationTooltip","liquidationData","label","minCollateral","size","mul","div","text","type","collateral","borrowFee","loss","getLiquidationData","liquidationsDataMap","key","timestamp","TradeHistory","props","account","infoTokens","getTokenInfo","chainId","nativeTokenAddress","trades","updateTrades","liquidationsData","reduce","memo","item","liquidationKey","interval","setInterval","undefined","clearInterval","getMsg","trade","tradeData","data","params","JSON","parse","defaultMsg","token","tokenAmount","decimals","usdgAmount","tokenIn","tokenOut","amountIn","amountOut","eq","acceptablePrice","flags","isOrderExecution","collateralDelta","price","isLiquidation","markPrice","includes","order","longShortDisplay","executionPriceDisplay","executionPrice","sizeDeltaDisplay","priceDisplay","triggerAboveThreshold","triggerPrice","fromToken","path","toToken","shouldUnwrap","length","fromAmountDisplay","isStable","toAmountDisplay","amountInDisplay","minOutDisplay","minOut","triggerRatio","tradesWithMessages","map","msg","filter","index","txUrl","txnHash"],"sources":["C:/Users/rober/Documents/swaps-client/src/components/Exchange/TradeHistory.js"],"sourcesContent":["import React, { useEffect, useCallback, useMemo } from \"react\";\nimport { ethers } from \"ethers\";\nimport { Link } from \"react-router-dom\";\nimport Tooltip from \"../../components/Tooltip/Tooltip\";\n\nimport {\n  USD_DECIMALS,\n  MAX_LEVERAGE,\n  BASIS_POINTS_DIVISOR,\n  LIQUIDATION_FEE,\n  formatAmount,\n  getExplorerUrl,\n  formatDateTime,\n  deserialize,\n  getExchangeRateDisplay,\n  bigNumberify,\n} from \"../../Helpers\";\nimport { useTrades, useLiquidationsData } from \"../../Api\";\nimport { getContract } from \"../../Addresses\";\n\nimport \"./TradeHistory.css\";\n\nconst { AddressZero } = ethers.constants;\n\nfunction getPositionDisplay(increase, indexToken, isLong, sizeDelta) {\n  const symbol = indexToken ? (indexToken.isWrapped ? indexToken.baseSymbol : indexToken.symbol) : \"\";\n  return `\n    ${increase ? \"Increase\" : \"Decrease\"} ${symbol} ${isLong ? \"Long\" : \"Short\"}\n    ${increase ? \"+\" : \"-\"}${formatAmount(sizeDelta, USD_DECIMALS, 2, true)} USD`;\n}\n\nfunction getOrderActionTitle(action) {\n  let actionDisplay;\n\n  if (action.startsWith(\"Create\")) {\n    actionDisplay = \"Create\";\n  } else if (action.startsWith(\"Cancel\")) {\n    actionDisplay = \"Cancel\";\n  } else {\n    actionDisplay = \"Update\";\n  }\n\n  return `${actionDisplay} Order`;\n}\n\nfunction renderLiquidationTooltip(liquidationData, label) {\n  const minCollateral = liquidationData.size.mul(BASIS_POINTS_DIVISOR).div(MAX_LEVERAGE);\n  const text =\n    liquidationData.type === \"full\"\n      ? \"This position was liquidated as the max leverage of 100x was exceeded\"\n      : \"Max leverage of 100x was exceeded, the remaining collateral after deducting losses and fees have been sent back to your account\";\n  return (\n    <Tooltip\n      position=\"left-top\"\n      handle={label}\n      renderContent={() => (\n        <>\n          {text}\n          <br />\n          <br />\n          Initial collateral: ${formatAmount(liquidationData.collateral, USD_DECIMALS, 2, true)}\n          <br />\n          Min required collateral: ${formatAmount(minCollateral, USD_DECIMALS, 2, true)}\n          <br />\n          Borrow fee: ${formatAmount(liquidationData.borrowFee, USD_DECIMALS, 2, true)}\n          <br />\n          PnL: -${formatAmount(liquidationData.loss, USD_DECIMALS, 2, true)}\n          {liquidationData.type === \"full\" && <div>Liquidation fee: ${formatAmount(LIQUIDATION_FEE, 30, 2, true)}</div>}\n        </>\n      )}\n    />\n  );\n}\n\nfunction getLiquidationData(liquidationsDataMap, key, timestamp) {\n  return liquidationsDataMap && liquidationsDataMap[`${key}:${timestamp}`];\n}\n\nexport default function TradeHistory(props) {\n  const { account, infoTokens, getTokenInfo, chainId, nativeTokenAddress } = props;\n  const { trades, updateTrades } = useTrades(chainId, account);\n\n  const liquidationsData = useLiquidationsData(chainId, account);\n  const liquidationsDataMap = useMemo(() => {\n    if (!liquidationsData) {\n      return null;\n    }\n    return liquidationsData.reduce((memo, item) => {\n      const liquidationKey = `${item.key}:${item.timestamp}`;\n      memo[liquidationKey] = item;\n      return memo;\n    }, {});\n  }, [liquidationsData]);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      updateTrades(undefined, true);\n    }, 10 * 1000);\n    return () => clearInterval(interval);\n  }, [updateTrades]);\n\n  const getMsg = useCallback(\n    (trade) => {\n      const tradeData = trade.data;\n      const params = JSON.parse(tradeData.params);\n      const defaultMsg = \"\";\n\n      if (tradeData.action === \"BuyUSDG\") {\n        const token = getTokenInfo(infoTokens, params.token, true, nativeTokenAddress);\n        if (!token) {\n          return defaultMsg;\n        }\n        return `Swap ${formatAmount(params.tokenAmount, token.decimals, 4, true)} ${token.symbol} for ${formatAmount(\n          params.usdgAmount,\n          18,\n          4,\n          true\n        )} USDG`;\n      }\n\n      if (tradeData.action === \"SellUSDG\") {\n        const token = getTokenInfo(infoTokens, params.token, true, nativeTokenAddress);\n        if (!token) {\n          return defaultMsg;\n        }\n        return `Swap ${formatAmount(params.usdgAmount, 18, 4, true)} USDG for ${formatAmount(\n          params.tokenAmount,\n          token.decimals,\n          4,\n          true\n        )} ${token.symbol}`;\n      }\n\n      if (tradeData.action === \"Swap\") {\n        const tokenIn = getTokenInfo(infoTokens, params.tokenIn, true, nativeTokenAddress);\n        const tokenOut = getTokenInfo(infoTokens, params.tokenOut, true, nativeTokenAddress);\n        if (!tokenIn || !tokenOut) {\n          return defaultMsg;\n        }\n        return `Swap ${formatAmount(params.amountIn, tokenIn.decimals, 4, true)} ${tokenIn.symbol} for ${formatAmount(\n          params.amountOut,\n          tokenOut.decimals,\n          4,\n          true\n        )} ${tokenOut.symbol}`;\n      }\n\n      if (tradeData.action === \"CreateIncreasePosition\") {\n        const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n\n        if (bigNumberify(params.sizeDelta).eq(0)) {\n          return `Request deposit into ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}`;\n        }\n\n        return `Request increase ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}, +${formatAmount(\n          params.sizeDelta,\n          USD_DECIMALS,\n          2,\n          true\n        )} USD, Acceptable Price: ${params.isLong ? \"<\" : \">\"} ${formatAmount(\n          params.acceptablePrice,\n          USD_DECIMALS,\n          2,\n          true\n        )} USD`;\n      }\n\n      if (tradeData.action === \"CreateDecreasePosition\") {\n        const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n\n        if (bigNumberify(params.sizeDelta).eq(0)) {\n          return `Request withdrawal from ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}`;\n        }\n\n        return `Request decrease ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}, -${formatAmount(\n          params.sizeDelta,\n          USD_DECIMALS,\n          2,\n          true\n        )} USD, Acceptable Price: ${params.isLong ? \">\" : \"<\"} ${formatAmount(\n          params.acceptablePrice,\n          USD_DECIMALS,\n          2,\n          true\n        )} USD`;\n      }\n\n      if (tradeData.action === \"CancelIncreasePosition\") {\n        const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n\n        if (bigNumberify(params.sizeDelta).eq(0)) {\n          return (\n            <>\n              Could not execute deposit into {indexToken.symbol} {params.isLong ? \"Long\" : \"Short\"}\n            </>\n          );\n        }\n\n        return (\n          <>\n            Could not increase {indexToken.symbol} {params.isLong ? \"Long\" : \"Short\"},\n            {`+${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)}`} USD, Acceptable Price:&nbsp;\n            {params.isLong ? \"<\" : \">\"}&nbsp;\n            <Tooltip\n              position=\"left-top\"\n              handle={`${formatAmount(params.acceptablePrice, USD_DECIMALS, 2, true)} USD`}\n              renderContent={() => <>Try increasing the \"Allowed Slippage\", under the Settings menu on the top right</>}\n            />\n          </>\n        );\n      }\n\n      if (tradeData.action === \"CancelDecreasePosition\") {\n        const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n\n        if (bigNumberify(params.sizeDelta).eq(0)) {\n          return `Could not execute withdrawal from ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}`;\n        }\n\n        return (\n          <>\n            Could not decrease {indexToken.symbol} {params.isLong ? \"Long\" : \"Short\"},\n            {`+${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)}`} USD, Acceptable Price:&nbsp;\n            {params.isLong ? \">\" : \"<\"}&nbsp;\n            <Tooltip\n              position=\"left-top\"\n              handle={`${formatAmount(params.acceptablePrice, USD_DECIMALS, 2, true)} USD`}\n              renderContent={() => <>Try increasing the \"Allowed Slippage\", under the Settings menu on the top right</>}\n            />\n          </>\n        );\n      }\n\n      if (tradeData.action === \"IncreasePosition-Long\" || tradeData.action === \"IncreasePosition-Short\") {\n        if (params.flags?.isOrderExecution) {\n          return;\n        }\n\n        const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n        if (bigNumberify(params.sizeDelta).eq(0)) {\n          return `Deposit ${formatAmount(params.collateralDelta, USD_DECIMALS, 2, true)} USD into ${\n            indexToken.symbol\n          } ${params.isLong ? \"Long\" : \"Short\"}`;\n        }\n        return `Increase ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"}, +${formatAmount(\n          params.sizeDelta,\n          USD_DECIMALS,\n          2,\n          true\n        )} USD, ${indexToken.symbol} Price: ${formatAmount(params.price, USD_DECIMALS, 2, true)} USD`;\n      }\n\n      if (tradeData.action === \"DecreasePosition-Long\" || tradeData.action === \"DecreasePosition-Short\") {\n        if (params.flags?.isOrderExecution) {\n          return;\n        }\n\n        const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n        if (bigNumberify(params.sizeDelta).eq(0)) {\n          return `Withdraw ${formatAmount(params.collateralDelta, USD_DECIMALS, 2, true)} USD from ${\n            indexToken.symbol\n          } ${params.isLong ? \"Long\" : \"Short\"}`;\n        }\n        const isLiquidation = params.flags?.isLiquidation;\n        const liquidationData = getLiquidationData(liquidationsDataMap, params.key, tradeData.timestamp);\n\n        if (isLiquidation && liquidationData) {\n          return (\n            <>\n              {renderLiquidationTooltip(liquidationData, \"Partial Liquidation\")} {indexToken.symbol}{\" \"}\n              {params.isLong ? \"Long\" : \"Short\"}, -{formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)} USD,{\" \"}\n              {indexToken.symbol}&nbsp; Price: ${formatAmount(params.price, USD_DECIMALS, 2, true)} USD\n            </>\n          );\n        }\n        const actionDisplay = isLiquidation ? \"Partially Liquidated\" : \"Decreased\";\n        return `\n        ${actionDisplay} ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"},\n        -${formatAmount(params.sizeDelta, USD_DECIMALS, 2, true)} USD,\n        ${indexToken.symbol} Price: ${formatAmount(params.price, USD_DECIMALS, 2, true)} USD\n      `;\n      }\n\n      if (tradeData.action === \"LiquidatePosition-Long\" || tradeData.action === \"LiquidatePosition-Short\") {\n        const indexToken = getTokenInfo(infoTokens, params.indexToken, true, nativeTokenAddress);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n        const liquidationData = getLiquidationData(liquidationsDataMap, params.key, tradeData.timestamp);\n        if (liquidationData) {\n          return (\n            <>\n              {renderLiquidationTooltip(liquidationData, \"Liquidated\")} {indexToken.symbol}{\" \"}\n              {params.isLong ? \"Long\" : \"Short\"}, -{formatAmount(params.size, USD_DECIMALS, 2, true)} USD,&nbsp;\n              {indexToken.symbol} Price: ${formatAmount(params.markPrice, USD_DECIMALS, 2, true)} USD\n            </>\n          );\n        }\n        return `\n        Liquidated ${indexToken.symbol} ${params.isLong ? \"Long\" : \"Short\"},\n        -${formatAmount(params.size, USD_DECIMALS, 2, true)} USD,\n        ${indexToken.symbol} Price: ${formatAmount(params.markPrice, USD_DECIMALS, 2, true)} USD\n      `;\n      }\n\n      if ([\"ExecuteIncreaseOrder\", \"ExecuteDecreaseOrder\"].includes(tradeData.action)) {\n        const order = deserialize(params);\n        const indexToken = getTokenInfo(infoTokens, order.indexToken, true, nativeTokenAddress);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n        const longShortDisplay = order.isLong ? \"Long\" : \"Short\";\n        const executionPriceDisplay = formatAmount(order.executionPrice, USD_DECIMALS, 2, true);\n        const sizeDeltaDisplay = `${order.type === \"Increase\" ? \"+\" : \"-\"}${formatAmount(\n          order.sizeDelta,\n          USD_DECIMALS,\n          2,\n          true\n        )}`;\n        const type = tradeData.action === \"ExecuteIncreaseOrder\" ? \"Increase\" : \"Decrease\";\n\n        return `\n        Execute Order: ${type} ${indexToken.symbol} ${longShortDisplay}\n        ${sizeDeltaDisplay} USD, Price: ${executionPriceDisplay} USD\n      `;\n      }\n\n      if (\n        [\n          \"CreateIncreaseOrder\",\n          \"CancelIncreaseOrder\",\n          \"UpdateIncreaseOrder\",\n          \"CreateDecreaseOrder\",\n          \"CancelDecreaseOrder\",\n          \"UpdateDecreaseOrder\",\n        ].includes(tradeData.action)\n      ) {\n        const order = deserialize(params);\n        const indexToken = getTokenInfo(infoTokens, order.indexToken);\n        if (!indexToken) {\n          return defaultMsg;\n        }\n        const increase = tradeData.action.includes(\"Increase\");\n        const priceDisplay = `${order.triggerAboveThreshold ? \">\" : \"<\"} ${formatAmount(\n          order.triggerPrice,\n          USD_DECIMALS,\n          2,\n          true\n        )}`;\n        return `\n        ${getOrderActionTitle(tradeData.action)}:\n        ${getPositionDisplay(increase, indexToken, order.isLong, order.sizeDelta)},\n        Price: ${priceDisplay}\n      `;\n      }\n\n      if (tradeData.action === \"ExecuteSwapOrder\") {\n        const order = deserialize(params);\n        const nativeTokenAddress = getContract(chainId, \"NATIVE_TOKEN\");\n        const fromToken = getTokenInfo(infoTokens, order.path[0] === nativeTokenAddress ? AddressZero : order.path[0]);\n        const toToken = getTokenInfo(infoTokens, order.shouldUnwrap ? AddressZero : order.path[order.path.length - 1]);\n        if (!fromToken || !toToken) {\n          return defaultMsg;\n        }\n        const fromAmountDisplay = formatAmount(order.amountIn, fromToken.decimals, fromToken.isStable ? 2 : 4, true);\n        const toAmountDisplay = formatAmount(order.amountOut, toToken.decimals, toToken.isStable ? 2 : 4, true);\n        return `\n        Execute Order: Swap ${fromAmountDisplay} ${fromToken.symbol} for ${toAmountDisplay} ${toToken.symbol}\n      `;\n      }\n\n      if ([\"CreateSwapOrder\", \"UpdateSwapOrder\", \"CancelSwapOrder\"].includes(tradeData.action)) {\n        const order = deserialize(params);\n        const nativeTokenAddress = getContract(chainId, \"NATIVE_TOKEN\");\n        const fromToken = getTokenInfo(infoTokens, order.path[0] === nativeTokenAddress ? AddressZero : order.path[0]);\n        const toToken = getTokenInfo(infoTokens, order.shouldUnwrap ? AddressZero : order.path[order.path.length - 1]);\n        if (!fromToken || !toToken) {\n          return defaultMsg;\n        }\n        const amountInDisplay = fromToken\n          ? formatAmount(order.amountIn, fromToken.decimals, fromToken.isStable ? 2 : 4, true)\n          : \"\";\n        const minOutDisplay = toToken\n          ? formatAmount(order.minOut, toToken.decimals, toToken.isStable ? 2 : 4, true)\n          : \"\";\n\n        return `\n        ${getOrderActionTitle(tradeData.action)}:\n        Swap ${amountInDisplay} ${fromToken?.symbol || \"\"} for ${minOutDisplay} ${toToken?.symbol || \"\"},\n        Price: ${getExchangeRateDisplay(order.triggerRatio, fromToken, toToken)}`;\n      }\n    },\n    [getTokenInfo, infoTokens, nativeTokenAddress, chainId, liquidationsDataMap]\n  );\n\n  const tradesWithMessages = useMemo(() => {\n    if (!trades) {\n      return [];\n    }\n\n    return trades\n      .map((trade) => ({\n        msg: getMsg(trade),\n        ...trade,\n      }))\n      .filter((trade) => trade.msg);\n  }, [trades, getMsg]);\n\n  return (\n    <div className=\"TradeHistory\">\n      {tradesWithMessages.length === 0 && (\n        <div className=\"Exchange-empty-positions-list-note App-card\">No trades yet</div>\n      )}\n      {tradesWithMessages.length > 0 &&\n        tradesWithMessages.map((trade, index) => {\n          const tradeData = trade.data;\n          const txUrl = getExplorerUrl(chainId) + \"tx/\" + tradeData.txnHash;\n\n          let msg = getMsg(trade);\n\n          if (!msg) {\n            return null;\n          }\n\n          return (\n            <div className=\"TradeHistory-row App-box App-box-border\" key={index}>\n              <div>\n                <div className=\"muted TradeHistory-time\">\n                  {formatDateTime(tradeData.timestamp)}\n                  {(!account || account.length === 0) && (\n                    <span>\n                      {\" \"}\n                      (<Link to={`/actions/${tradeData.account}`}>{tradeData.account}</Link>)\n                    </span>\n                  )}\n                </div>\n                <a className=\"plain\" href={txUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                  {msg}\n                </a>\n              </div>\n            </div>\n          );\n        })}\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}